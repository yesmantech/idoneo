import{s as n}from"./index-Z19V86or.js";async function l(e){const{status:r,search:t,limit:a=50,offset:i=0}=e;let o=n.from("bandi").select(`
            *,
            ente:enti(id, name, slug),
            category:bandi_categories(id, name, slug)
        `,{count:"exact"});r&&r!=="all"&&(o=o.eq("status",r)),t&&(o=o.or(`title.ilike.%${t}%,slug.ilike.%${t}%`)),o=o.order("created_at",{ascending:!1}).range(i,i+a-1);const{data:c,error:s,count:d}=await o;if(s)throw console.error("Error fetching admin bandi:",s),s;return{data:c||[],count:d||0}}async function f(e){const{data:r,error:t}=await n.from("bandi").select(`
            *,
            ente:enti(*),
            category:bandi_categories(*),
            updates:bandi_updates(*),
            documents:bandi_documents(*)
        `).eq("id",e).single();return t?(console.error("Error fetching bando:",t),null):r}async function g(e){const{data:{user:r}}=await n.auth.getUser(),{data:t,error:a}=await n.from("bandi").insert({...e,status:e.status||"draft",created_by:r==null?void 0:r.id}).select().single();if(a)throw console.error("Error creating bando:",a),a;return t}async function b(e,r){const{data:{user:t}}=await n.auth.getUser(),{data:a,error:i}=await n.from("bandi").update({...r,updated_at:new Date().toISOString(),updated_by:t==null?void 0:t.id}).eq("id",e).select().single();if(i)throw console.error("Error updating bando:",i),i;return a}async function w(e){const{error:r}=await n.from("bandi").delete().eq("id",e);if(r)throw console.error("Error deleting bando:",r),r;return!0}async function h(e){const{data:{user:r}}=await n.auth.getUser(),{data:t,error:a}=await n.from("bandi").update({status:"published",published_at:new Date().toISOString(),published_by:r==null?void 0:r.id}).eq("id",e).select().single();if(a)throw console.error("Error publishing bando:",a),a;return t}async function p(e){const{data:r,error:t}=await n.from("bandi").update({status:"closed",closed_at:new Date().toISOString()}).eq("id",e).select().single();if(t)throw console.error("Error closing bando:",t),t;return r}async function m(){const{data:e,error:r}=await n.from("enti").select("*").order("name");return r?(console.error("Error fetching enti:",r),[]):e||[]}async function y(e){const{data:r,error:t}=await n.from("enti").insert(e).select().single();if(t)throw console.error("Error creating ente:",t),t;return r}async function E(e,r){const{data:t,error:a}=await n.from("enti").update(r).eq("id",e).select().single();if(a)throw console.error("Error updating ente:",a),a;return t}async function _(e){const{error:r}=await n.from("enti").delete().eq("id",e);if(r)throw console.error("Error deleting ente:",r),r;return!0}async function S(){const{data:e,error:r}=await n.from("bandi_categories").select("*").order("sort_order");return r?(console.error("Error fetching categories:",r),[]):e||[]}async function q(e){const{data:r,error:t}=await n.from("bandi_categories").insert(e).select().single();if(t)throw console.error("Error creating category:",t),t;return r}async function k(e,r){const{data:t,error:a}=await n.from("bandi_categories").update(r).eq("id",e).select().single();if(a)throw console.error("Error updating category:",a),a;return t}async function B(e,r){const{error:t}=await n.from("bandi").update({status:r,updated_at:new Date().toISOString(),published_at:new Date().toISOString()}).in("id",e);if(t)throw console.error("Error bulk updating status:",t),t}async function I(e){const{error:r}=await n.from("bandi").delete().in("id",e);if(r)throw console.error("Error bulk deleting:",r),r}async function D(){const{data:e,error:r}=await n.functions.invoke("import-bandi");if(r)throw console.error("Error running import agent:",r),r;return e}export{B as a,I as b,p as c,w as d,m as e,l as f,S as g,f as h,g as i,k as j,q as k,_ as l,E as m,y as n,h as p,D as r,b as u};
