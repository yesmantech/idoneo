import{j as e}from"./framer-BdaCTGm4.js";import{r as x,u as w,b as S}from"./router-ClfHAwMg.js";import{u as z,s as p}from"./index-DBMi1b3R.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";import"./icons-DIoLbN6D.js";function C({subjectName:i,totalQuestions:o,completedQuestions:s,onClick:n}){const a=Math.round(s/o*100)||0,c=a>=80?"bg-emerald-500":a>=50?"bg-blue-500":a>=20?"bg-amber-500":"bg-slate-300";return e.jsxs("div",{onClick:n,className:`bg-white rounded-xl border border-slate-200 p-4 transition-all ${n?"cursor-pointer hover:border-slate-300 hover:shadow-sm":""}`,children:[e.jsxs("div",{className:"flex justify-between items-end mb-3",children:[e.jsx("h4",{className:"font-bold text-slate-800 line-clamp-2",title:i,children:i}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-bold text-slate-900",children:[a,"%"]}),e.jsx("div",{className:"text-[10px] text-slate-500 font-medium uppercase tracking-wide",children:"Completato"})]})]}),e.jsx("div",{className:"h-2.5 w-full bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${c} transition-all duration-1000 ease-out`,style:{width:`${a}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400 flex justify-between",children:[e.jsxs("span",{children:[s," apprese"]}),e.jsxs("span",{children:["/ ",o," totali"]})]})]})}function E(i){const{user:o}=z(),[s,n]=x.useState({}),[a,c]=x.useState(!0);return x.useEffect(()=>{if(!i||!o){c(!1);return}(async()=>{c(!0);try{const{data:r,error:b}=await p.from("questions").select("id, subject_id").eq("quiz_id",i).eq("is_archived",!1);if(b)throw b;const u={};r==null||r.forEach(t=>{t.subject_id&&(u[t.subject_id]=(u[t.subject_id]||0)+1)});const{data:h,error:g}=await p.from("quiz_attempts").select("answers").eq("quiz_id",i).eq("user_id",o.id);if(g)throw g;const j=new Set;h==null||h.forEach(t=>{const d=t.answers;Array.isArray(d)&&d.forEach(f=>{f.isCorrect&&f.questionId&&j.add(f.questionId)})});const v=new Map;r==null||r.forEach(t=>{t.subject_id&&v.set(t.id,t.subject_id)});const m={};j.forEach(t=>{const d=v.get(t);d&&(m[d]=(m[d]||0)+1)});const l={};Object.keys(u).forEach(t=>{const d=u[t]||0,f=m[t]||0,N=d>0?Math.round(f/d*100):0;l[t]={subjectId:t,total:d,completed:f,percentage:N}}),n(l)}catch(r){console.error("Error fetching subject progress:",r)}finally{c(!1)}})()},[i,o]),{progress:s,loading:a}}function q({category:i,role:o,contestSlug:s,contestId:n}){const a=w(),[c,y]=x.useState([]),[r,b]=x.useState(n),{progress:u}=E(r),[h,g]=x.useState(!0);x.useEffect(()=>{(async()=>{let l=n;if(!l){const{data:t}=await p.from("quizzes").select("id").eq("slug",s).single();t&&(l=t.id,b(t.id))}if(l){const{data:t}=await p.from("subjects").select("*").eq("quiz_id",l).eq("is_archived",!1).order("name");t&&y(t)}g(!1)})()},[s,n]);const j=()=>{a(`/quiz/${s}/official`)},v=()=>{a(`/concorsi/${i}/${o}/${s}/custom`)};return h?e.jsx("div",{className:"py-12 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-cyan"})}):e.jsxs("div",{className:"space-y-12",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("h2",{className:"text-2xl md:text-4xl font-bold text-text-primary",children:"Scegli la modalitÃ "}),e.jsx("p",{className:"text-lg text-text-secondary max-w-2xl mx-auto",children:"Simula l'esame ufficiale con i tempi e i pesi reali, oppure costruisci una prova personalizzata per rinforzare le tue lacune."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("button",{onClick:j,className:"group relative bg-white rounded-card p-8 text-left shadow-soft hover:shadow-card hover:scale-[1.02] transition-all duration-300 ease-ios flex flex-col h-full",children:[e.jsx("div",{className:"w-14 h-14 rounded-squircle bg-brand-cyan/10 flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition-transform",children:"ðŸ†"}),e.jsx("h3",{className:"text-2xl font-bold text-text-primary mb-3",children:"Simulazione Ufficiale"}),e.jsx("p",{className:"text-text-secondary mb-6 leading-relaxed",children:"Replica fedelmente la prova d'esame. Algoritmo di estrazione ufficiale, timer reale e calcolo del punteggio ministeriale."}),e.jsx("div",{className:"mt-auto inline-flex items-center gap-2 px-5 py-2.5 bg-brand-cyan text-white font-semibold text-sm rounded-pill hover:bg-brand-cyan/90 transition-colors",children:"Avvia Simulazione â†’"})]}),e.jsxs("button",{onClick:v,className:"group relative bg-white rounded-card p-8 text-left shadow-soft hover:shadow-card hover:scale-[1.02] transition-all duration-300 ease-ios flex flex-col h-full",children:[e.jsx("div",{className:"w-14 h-14 rounded-squircle bg-brand-blue/10 flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition-transform",children:"ðŸ§©"}),e.jsx("h3",{className:"text-2xl font-bold text-text-primary mb-3",children:"Prova Personalizzata"}),e.jsx("p",{className:"text-text-secondary mb-6 leading-relaxed",children:"Configura la tua esercitazione. Scegli le materie, il numero di domande e il tempo a disposizione per un allenamento mirato."}),e.jsx("div",{className:"mt-auto inline-flex items-center gap-2 px-5 py-2.5 bg-canvas-light text-text-primary font-semibold text-sm rounded-pill hover:bg-text-tertiary/20 transition-colors",children:"Configura Prova â†’"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-text-primary",children:"I tuoi progressi per materia"}),e.jsx("span",{className:"text-text-secondary text-sm font-medium hidden sm:block",children:"Aggiornato in tempo reale"})]}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:c.map(m=>{const l=u[m.id]||{total:0,completed:0};return l.total===0?null:e.jsx(C,{subjectName:m.name,totalQuestions:l.total,completedQuestions:l.completed,onClick:()=>a(`/concorsi/${i}/${o}/${s}/custom?subject=${m.id}`)},m.id)})}):e.jsx("div",{className:"bg-white rounded-card shadow-soft p-8 text-center text-text-tertiary",children:"Nessuna materia configurata per questo concorso."})]})]})}function L(){const{category:i,role:o,contestSlug:s}=S(),n=w(),[a,c]=x.useState("Caricamento...");return x.useEffect(()=>{(async()=>{const{data:r}=await p.from("quizzes").select("title, role:roles(title)").eq("slug",s).single();r&&c(`Allenati per ${r.title} `)})()},[s]),e.jsxs("div",{className:"min-h-screen bg-canvas-light text-text-primary pb-20",children:[e.jsx("div",{className:"bg-white shadow-soft sticky top-0 z-10",children:e.jsxs("div",{className:"container mx-auto px-5 md:px-6 h-16 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>n(-1),className:"flex items-center gap-2 text-text-secondary hover:text-brand-cyan transition-colors duration-300",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"text-sm font-semibold hidden md:block",children:"Torna al concorso"})]}),e.jsx("div",{className:"font-bold text-text-primary truncate max-w-[200px] md:max-w-md",children:a}),e.jsx("div",{className:"w-8"})," "]})}),e.jsx("main",{className:"container mx-auto px-5 md:px-6 py-8 max-w-4xl",children:e.jsx(q,{category:i||"",role:o||"",contestSlug:s||""})})]})}export{L as default};
