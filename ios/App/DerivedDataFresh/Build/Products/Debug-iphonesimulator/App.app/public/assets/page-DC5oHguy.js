import{j as e,A as C,m as y}from"./framer-CcO5Kjcw.js";import{u as L,r as u,L as T}from"./router-ClfHAwMg.js";import{s as _}from"./index-Z19V86or.js";import{T as M}from"./TierSLoader-CVYPZXYz.js";import{S as Q}from"./SEOHead-B7u-rzTH.js";import{l as D,ar as I,x as P,z,a as B,I as O,y as U,m as F,X as H}from"./icons-Dvxa2Qho.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";const S=async(t={})=>{try{let r=_.from("quizzes").select(`
                id, slug, title, description, year, is_official,
                role:roles!inner (
                    id, slug, title, available_positions,
                    category:categories!inner (
                        id, slug, title
                    )
                )
            `,{count:"exact"}).eq("is_archived",!1);t.search&&(r=r.ilike("title",`%${t.search}%`)),t.categorySlug&&(r=r.eq("role.category.slug",t.categorySlug)),t.year&&(r=r.eq("year",t.year)),t.isOfficial!==void 0&&(r=r.eq("is_official",t.isOfficial));const d=t.limit||20,n=t.offset||0;r=r.range(n,n+d-1).order("year",{ascending:!1}).order("title");const{data:f,error:c,count:s}=await r;if(c)throw console.error("Supabase searchQuizzes error:",c),c;return{data:(f||[]).map(l=>{var g,m,b,p,x,o,h,v,w,j;return{id:l.id,slug:l.slug,title:l.title,description:l.description,year:l.year,is_official:!!l.is_official,available_seats:(g=l.role)==null?void 0:g.available_positions,role:{id:((m=l.role)==null?void 0:m.id)||"",slug:((b=l.role)==null?void 0:b.slug)||"",title:((p=l.role)==null?void 0:p.title)||"",category:{id:((o=(x=l.role)==null?void 0:x.category)==null?void 0:o.id)||"",slug:((v=(h=l.role)==null?void 0:h.category)==null?void 0:v.slug)||"",title:((j=(w=l.role)==null?void 0:w.category)==null?void 0:j.title)||""}}}}),count:s||0}}catch(r){throw console.error("searchQuizzes implementation error:",r),r}},W=async()=>{try{const{data:t,error:r}=await _.from("categories").select("id, title, slug").eq("is_archived",!1).order("title");return r?(console.error("Error fetching categories:",r),[]):t||[]}catch(t){return console.error("fetchAllCategories implementation error:",t),[]}};function te(){const t=L(),[r,d]=u.useState([]),[n,f]=u.useState([]),[c,s]=u.useState(!0),[l,g]=u.useState(!1),[m,b]=u.useState(null),[p,x]=u.useState(!1),[o,h]=u.useState({search:"",categorySlug:void 0,year:void 0,isOfficial:void 0,limit:20,offset:0}),[v,w]=u.useState(0);u.useEffect(()=>{j()},[]),u.useEffect(()=>{c||k(o)},[o.categorySlug,o.year,o.isOfficial]);const j=async()=>{s(!0),b(null);try{const[a,i]=await Promise.all([S(o),W()]);d(a.data),w(a.count),f(i)}catch(a){console.error("Error loading concorsi:",a),b(a instanceof Error?a.message:String(a))}finally{s(!1)}},k=async a=>{a.offset===0?(s(!0),b(null)):g(!0);try{const i=await S(a);a.offset===0?d(i.data):d(A=>[...A,...i.data]),w(i.count)}catch(i){console.error("Error loading concorsi:",i),b(i instanceof Error?i.message:String(i))}finally{s(!1),g(!1)}},$=a=>{a.preventDefault(),k({...o,offset:0})},E=()=>{if(!l&&r.length<v){const a=(o.offset||0)+(o.limit||20);h(i=>({...i,offset:a}))}},R=a=>{h(i=>({...i,categorySlug:i.categorySlug===a?void 0:a,offset:0}))},N=[o.categorySlug,o.year,o.isOfficial].filter(Boolean).length;return e.jsxs("div",{className:"min-h-screen bg-[var(--background)] pb-24 relative overflow-hidden",children:[e.jsx(Q,{title:"Ricerca Avanzata Concorsi | Idoneo",description:"Trova il tuo concorso ideale tra centinaia di simulatori ufficiali e quiz commentati."}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 h-[500px] pointer-events-none overflow-hidden",children:[e.jsx("div",{className:"absolute -top-24 -left-24 w-96 h-96 bg-brand-blue/10 rounded-full blur-[100px] animate-pulse"}),e.jsx("div",{className:"absolute top-48 -right-24 w-96 h-96 bg-brand-cyan/10 rounded-full blur-[100px] animate-pulse duration-5000"})]}),e.jsxs("header",{className:"sticky top-0 z-40 bg-[var(--background)]/80 backdrop-blur-xl border-b border-[var(--card-border)] pt-safe",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 h-16 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t(-1),className:"w-10 h-10 flex items-center justify-center rounded-2xl bg-white dark:bg-slate-800 shadow-sm border border-[var(--card-border)] text-slate-600 dark:text-slate-300 hover:bg-slate-50 transition-all",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-black text-[var(--foreground)] tracking-tight",children:"Ricerca Concorsi"}),e.jsxs("p",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest leading-none",children:[v," quiz disponibili"]})]}),e.jsxs("button",{onClick:()=>x(!0),className:`w-10 h-10 flex items-center justify-center rounded-2xl transition-all border relative ${N>0?"bg-brand-blue text-white border-brand-blue":"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border-[var(--card-border)] shadow-sm"}`,children:[e.jsx(I,{className:"w-5 h-5"}),N>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-rose-500 text-white text-[10px] font-black rounded-full border-2 border-[var(--background)] flex items-center justify-center",children:N})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 pb-4 space-y-4",children:[e.jsxs("form",{onSubmit:$,className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-5 flex items-center pointer-events-none",children:e.jsx(P,{className:"w-5 h-5 text-slate-400 group-focus-within:text-brand-blue transition-colors"})}),e.jsx("input",{type:"text",placeholder:"Cerca concorso...",value:o.search,onChange:a=>h(i=>({...i,search:a.target.value})),className:`w-full h-[52px] pl-14 pr-5 bg-[var(--card)] 
                                       text-[15px] font-medium text-[var(--foreground)] placeholder:text-slate-400/70
                                       shadow-soft border border-[var(--card-border)] rounded-[26px]
                                       focus:border-brand-blue/30 focus:shadow-lg focus:shadow-brand-blue/5 
                                       outline-none transition-all duration-200`})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide -mx-4 px-4 snap-x",children:[e.jsx("button",{onClick:()=>h(a=>({...a,categorySlug:void 0,offset:0})),className:`flex-shrink-0 px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap transition-all border snap-start ${o.categorySlug?"bg-white dark:bg-slate-800 text-slate-500 border-slate-200 dark:border-slate-700":"bg-brand-blue text-white border-brand-blue shadow-lg shadow-brand-blue/20"}`,children:"Tutti"}),n.map(a=>e.jsx("button",{onClick:()=>R(a.slug),className:`flex-shrink-0 px-4 py-2 rounded-xl text-xs font-bold whitespace-nowrap transition-all border snap-start ${o.categorySlug===a.slug?"bg-brand-blue text-white border-brand-blue shadow-lg shadow-brand-blue/20":"bg-white dark:bg-slate-800 text-slate-500 border-slate-200 dark:border-slate-700"}`,children:a.title},a.id))]})]})]}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 pt-6",children:[c?e.jsx("div",{className:"py-20 flex flex-col items-center",children:e.jsx(M,{message:"Ricerca in corso..."})}):m?e.jsxs("div",{className:"py-20 text-center space-y-4",children:[e.jsx("div",{className:"text-5xl",children:"ðŸ˜­"}),e.jsx("h2",{className:"text-xl font-bold text-[var(--foreground)]",children:m||"Si Ã¨ verificato un errore"}),e.jsx("button",{onClick:j,className:"px-6 py-3 bg-brand-blue text-white rounded-2xl font-bold",children:"Riprova"})]}):r.length===0?e.jsxs("div",{className:"py-20 text-center space-y-4",children:[e.jsx("div",{className:"text-5xl opacity-40",children:"ðŸ”"}),e.jsx("h2",{className:"text-xl font-bold text-slate-400",children:"Nessun risultato trovato"}),e.jsx("button",{onClick:()=>h({...o,search:"",categorySlug:void 0,offset:0}),className:"text-brand-blue font-bold",children:"Reset filtri"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.jsx(C,{mode:"popLayout",children:r.map((a,i)=>e.jsx(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:Math.min(i*.05,.4)},layout:!0,children:e.jsx(X,{quiz:a})},a.id))})}),!c&&r.length<v&&e.jsx("button",{onClick:E,disabled:l,className:"w-full mt-8 py-4 bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-800 rounded-[28px] font-bold text-slate-600 dark:text-slate-300 shadow-sm hover:shadow-md transition-all flex items-center justify-center gap-2 group",children:l?"Caricamento...":e.jsxs(e.Fragment,{children:["Mostra altri",e.jsx(z,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})})]}),e.jsx(G,{isOpen:p,onClose:()=>x(!1),filters:o,setFilters:h,categories:n})]})}function X({quiz:t}){var n,f,c,s,l,g,m,b;const d=(p=>{if(!p)return"from-brand-blue to-brand-cyan";const x=p.toLowerCase();return x.includes("forze-armate")||x.includes("militari")||x.includes("polizia")?"from-blue-500 to-indigo-600":x.includes("sanita")?"from-rose-500 to-pink-600":x.includes("amministrativi")?"from-brand-purple to-indigo-700":x.includes("enti-locali")?"from-brand-orange to-orange-700":"from-brand-blue to-brand-cyan"})((f=(n=t.role)==null?void 0:n.category)==null?void 0:f.slug);return e.jsxs(T,{to:`/concorsi/${((s=(c=t.role)==null?void 0:c.category)==null?void 0:s.slug)||"unknown"}/${((l=t.role)==null?void 0:l.slug)||"unknown"}`,className:"group block bg-[var(--card)] rounded-[32px] border border-[var(--card-border)] overflow-hidden hover:shadow-[0_20px_40px_-15px_rgba(0,0,0,0.1)] transition-all duration-300",children:[e.jsxs("div",{className:"p-5 flex gap-4",children:[e.jsx("div",{className:`w-14 h-14 rounded-2xl bg-gradient-to-br ${d} flex items-center justify-center shrink-0 shadow-lg shadow-black/5`,children:e.jsx(B,{className:"w-6 h-6 text-white",strokeWidth:1.5})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[10px] font-black text-brand-blue uppercase tracking-widest",children:((m=(g=t.role)==null?void 0:g.category)==null?void 0:m.title)||"Concorso"}),t.is_official&&e.jsxs("div",{className:"flex items-center gap-1 bg-emerald-500/10 text-emerald-600 px-1.5 py-0.5 rounded-full text-[9px] font-bold",children:[e.jsx(O,{className:"w-2.5 h-2.5"}),"Ufficiale"]})]}),e.jsx("h3",{className:"text-[16px] font-black text-[var(--foreground)] leading-[1.2] line-clamp-2 group-hover:text-brand-blue transition-colors mb-2",children:t.title}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-slate-100 dark:bg-slate-800 border border-slate-200/50 dark:border-slate-700/50 text-slate-500",children:[e.jsx(U,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[11px] font-bold",children:t.year})]}),t.available_seats&&e.jsxs("div",{className:"flex items-center gap-1 px-2.5 py-1 rounded-full bg-brand-blue/5 border border-brand-blue/10 text-brand-blue",children:[e.jsx(F,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[11px] font-bold",children:t.available_seats})]})]})]})]}),e.jsxs("div",{className:"px-5 py-3 bg-slate-50 dark:bg-white/5 border-t border-[var(--card-border)] flex items-center justify-between",children:[e.jsx("span",{className:"text-[12px] font-medium text-slate-500 truncate pr-4",children:((b=t.role)==null?void 0:b.title)||"Ruolo non specificato"}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-white dark:bg-slate-800 flex items-center justify-center text-slate-400 group-hover:text-brand-blue shadow-sm transition-all group-hover:translate-x-1",children:e.jsx(z,{className:"w-4 h-4"})})]})]})}function G({isOpen:t,onClose:r,filters:d,setFilters:n,categories:f}){const c=[2025,2024,2023,2022,2021];return t?e.jsx(C,{children:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-end justify-center px-4 pb-4 focus:outline-none",children:[e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,className:"absolute inset-0 bg-black/40 backdrop-blur-sm"}),e.jsx(y.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"relative w-full max-w-lg bg-[var(--background)] rounded-[40px] shadow-2xl overflow-hidden border border-[var(--card-border)]",children:e.jsxs("div",{className:"p-8 pb-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h2",{className:"text-2xl font-black text-[var(--foreground)] tracking-tight",children:"Filtri Avanzati"}),e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:e.jsx(H,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4",children:"Categoria"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>n(s=>({...s,categorySlug:void 0,offset:0})),className:`px-4 py-2 rounded-2xl text-xs font-bold transition-all border ${d.categorySlug?"bg-white dark:bg-slate-800 text-slate-500 border-slate-100 dark:border-slate-800":"bg-brand-blue text-white border-brand-blue shadow-lg shadow-brand-blue/20"}`,children:"Tutti"}),f.map(s=>e.jsx("button",{onClick:()=>n(l=>({...l,categorySlug:s.slug,offset:0})),className:`px-4 py-2 rounded-2xl text-xs font-bold transition-all border ${d.categorySlug===s.slug?"bg-brand-blue text-white border-brand-blue shadow-lg shadow-brand-blue/20":"bg-white dark:bg-slate-800 text-slate-500 border-slate-100 dark:border-slate-800"}`,children:s.title},s.id))]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4",children:"Anno di pubblicazione"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>n(s=>({...s,year:void 0,offset:0})),className:`px-4 py-2 rounded-2xl text-xs font-bold transition-all border ${d.year?"bg-white dark:bg-slate-800 text-slate-500 border-slate-100 dark:border-slate-800":"bg-brand-blue text-white border-brand-blue shadow-lg shadow-brand-blue/20"}`,children:"Tutti"}),c.map(s=>e.jsx("button",{onClick:()=>n(l=>({...l,year:s,offset:0})),className:`px-4 py-2 rounded-2xl text-xs font-bold transition-all border ${d.year===s?"bg-brand-blue text-white border-brand-blue shadow-lg shadow-brand-blue/20":"bg-white dark:bg-slate-800 text-slate-500 border-slate-100 dark:border-slate-800"}`,children:s},s))]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-3xl bg-slate-50 dark:bg-white/5 border border-[var(--card-border)]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-emerald-500/10 text-emerald-600 flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-black text-[var(--foreground)] tracking-tight",children:"Solo Ufficiali"}),e.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Bandi Ministeriali"})]})]}),e.jsx("button",{onClick:()=>n(s=>({...s,isOfficial:s.isOfficial===!0?void 0:!0,offset:0})),className:`w-12 h-7 rounded-full transition-all relative ${d.isOfficial===!0?"bg-emerald-500":"bg-slate-200 dark:bg-slate-700"}`,children:e.jsx(y.div,{animate:{x:d.isOfficial===!0?20:4},className:"absolute top-1 left-0 w-5 h-5 bg-white rounded-full shadow-sm"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-10",children:[e.jsx("button",{onClick:()=>{n({search:"",categorySlug:void 0,offset:0}),r()},className:"py-4 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-[24px] font-black text-sm hover:bg-slate-200 transition-all",children:"Reset"}),e.jsx("button",{onClick:r,className:"py-4 bg-gradient-to-r from-brand-blue to-brand-cyan text-white rounded-[24px] font-black text-sm shadow-xl shadow-brand-blue/20 hover:scale-[1.02] active:scale-[0.98] transition-all",children:"Applica"})]})]})})]})}):null}export{te as default};
