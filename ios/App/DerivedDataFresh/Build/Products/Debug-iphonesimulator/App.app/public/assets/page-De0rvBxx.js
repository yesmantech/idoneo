import{j as e}from"./framer-CcO5Kjcw.js";import{b as I,a as q,u as E,r as m,L as O}from"./router-ClfHAwMg.js";import{s as v}from"./index-Z19V86or.js";import{k as y,X as _,l as D,j as P}from"./icons-Dvxa2Qho.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";function F(r){return r?r.replace(/[.,:;()[\]]/g,"").trim().toLowerCase():null}function X(){const{quizId:r}=I(),[k]=q(),j=k.get("subject"),w=E(),[C,f]=m.useState(!0),[i,h]=m.useState(null),[o,S]=m.useState([]),[a,N]=m.useState(0),[p,b]=m.useState(!1),[g,L]=m.useState(!1);m.useEffect(()=>{(async()=>{if(!r){h("Quiz non specificato"),f(!1);return}try{const{data:{user:s}}=await v.auth.getUser();if(!s){w("/login");return}const{data:n}=await v.from("quiz_attempts").select("id, answers, created_at").eq("user_id",s.id).eq("quiz_id",r).order("created_at",{ascending:!1});if(!(n!=null&&n.length)){h("Nessun tentativo trovato"),f(!1);return}const c=new Map;n.forEach(x=>{Array.isArray(x.answers)&&x.answers.forEach(t=>{if(!t.isCorrect&&!t.isSkipped&&t.selectedOption){if(j&&t.subjectId!==j)return;c.has(t.questionId)||c.set(t.questionId,{questionId:t.questionId,text:t.text,subjectName:t.subjectName||"Generale",subjectId:t.subjectId,selectedOption:t.selectedOption,correctOption:t.correctOption,explanation:t.explanation,options:t.options||{a:"",b:"",c:"",d:""},attemptDate:x.created_at})}})});const u=Array.from(c.values());u.length===0&&h("Nessun errore da ripassare! ðŸŽ‰"),S(u),f(!1)}catch(s){console.error("Review page error:",s),h(s.message),f(!1)}})()},[r,w,j]);const l=o[a],A=()=>{b(!1),a<o.length-1&&N(a+1)},B=()=>{b(!1),a>0&&N(a-1)};if(C)return e.jsx("div",{className:"min-h-screen bg-[#F5F5F7] flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-[#00B1FF] border-t-transparent rounded-full animate-spin"})});if(i||o.length===0)return e.jsx("div",{className:"min-h-screen bg-[#F5F5F7] flex flex-col items-center justify-center p-4",children:e.jsxs("div",{className:`${i!=null&&i.includes("ðŸŽ‰")?"bg-emerald-50 text-emerald-600":"bg-red-50 text-red-600"} p-6 rounded-2xl max-w-sm text-center`,children:[i!=null&&i.includes("ðŸŽ‰")?e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-emerald-100 rounded-full flex items-center justify-center",children:e.jsx(y,{className:"w-8 h-8 text-emerald-600"})}):e.jsx(R,{className:"w-8 h-8 mx-auto mb-2"}),e.jsx("p",{className:"font-medium text-lg",children:i||"Nessun errore trovato"}),e.jsx("button",{onClick:()=>w(-1),className:"mt-4 px-6 py-2 bg-white rounded-xl font-bold text-sm shadow-sm",children:"Torna indietro"})]})});const $=l?F(l.correctOption):null,z=l?F(l.selectedOption):null;return e.jsxs("div",{className:"min-h-screen bg-[#F5F5F7] flex flex-col",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-white border-b border-slate-100",children:e.jsxs("div",{className:"h-14 px-4 flex items-center justify-between max-w-3xl mx-auto",children:[e.jsx(O,{to:`/profile/stats/${r}`,className:"w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 hover:bg-slate-200 transition-colors",children:e.jsx(_,{className:"w-5 h-5 text-slate-600"})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-bold text-slate-900 text-sm",children:"Ripasso Errori"}),e.jsxs("span",{className:"text-[10px] text-slate-400 font-semibold uppercase tracking-wider",children:["Domanda ",a+1,"/",o.length]})]}),e.jsx("div",{className:"w-10"})]})}),e.jsxs("main",{className:"flex-1 px-5 py-6 max-w-3xl mx-auto w-full pb-48",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("span",{className:"text-[12px] font-semibold text-slate-400 uppercase tracking-wider",children:[a+1," / ",o.length," â€¢ ",l.subjectName]})}),e.jsx("h2",{className:"text-[20px] font-bold text-slate-900 leading-[1.4] mb-8",children:l.text}),e.jsx("div",{className:"space-y-3",children:["a","b","c","d"].map(d=>{const s=l.options[d];if(!s)return null;const n=d===$,c=d===z;let u="bg-white border-slate-200",x="bg-slate-100 text-slate-500",t="text-slate-700";return c&&(u="bg-red-50 border-red-500",x="bg-red-500 text-white",t="text-red-700"),p&&n&&(u="bg-emerald-50 border-emerald-500",x="bg-emerald-500 text-white",t="text-emerald-700"),e.jsxs("div",{className:`w-full p-4 rounded-2xl border-2 flex items-start gap-4 text-left transition-all duration-200 ${u}`,children:[e.jsx("span",{className:`w-8 h-8 rounded-lg flex items-center justify-center text-[13px] font-bold flex-shrink-0 ${x}`,children:d.toUpperCase()}),e.jsx("span",{className:`text-[15px] leading-relaxed flex-1 ${t}`,children:s}),p&&n&&e.jsx(y,{className:"w-5 h-5 text-emerald-500 flex-shrink-0 mt-0.5"})]},d)})}),p&&l.explanation&&e.jsxs("div",{className:"mt-6 bg-white rounded-2xl p-5 border border-[#00B1FF]/20 animate-in slide-in-from-top-2",children:[e.jsx("h4",{className:"text-[12px] font-bold text-[#00B1FF] uppercase tracking-wider mb-2",children:"Spiegazione"}),e.jsx("p",{className:"text-[14px] text-slate-600 leading-relaxed",children:l.explanation})]}),!p&&e.jsx("button",{onClick:()=>b(!0),className:"w-full mt-8 py-4 rounded-xl font-bold text-white bg-[#00B1FF] shadow-lg shadow-blue-500/20 active:scale-[0.98] transition-all",children:"Mostra Risposta Corretta"})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white pb-safe z-40",children:[e.jsx("div",{className:"relative flex justify-center",children:e.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2",children:e.jsxs("div",{className:"relative w-28 h-8",children:[e.jsx("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 112 32",fill:"none",style:{filter:"drop-shadow(0 -2px 8px rgba(0,0,0,0.1))"},children:e.jsx("path",{d:"M10 32 L18 8 C20 3 24 0 30 0 L82 0 C88 0 92 3 94 8 L102 32 Z",fill:"white"})}),e.jsx("button",{onClick:()=>L(!g),className:"absolute left-1/2 -translate-x-1/2 top-2 w-16 h-5 rounded-md bg-gradient-to-b from-[#00B1FF] to-[#0095dd] flex items-center justify-center active:scale-95 transition-transform",style:{boxShadow:"0 2px 4px rgba(0,177,255,0.4), inset 0 1px 0 rgba(255,255,255,0.3)"},children:e.jsx("svg",{width:"14",height:"8",viewBox:"0 0 14 8",fill:"none",className:`text-white transition-transform duration-200 ${g?"rotate-180":""}`,children:e.jsx("path",{d:"M1.5 6.5L7 1.5L12.5 6.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})})}),e.jsx("div",{className:"h-px bg-slate-100"}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${g?"max-h-60":"max-h-14"}`,children:e.jsx("div",{className:"px-4 py-3 border-b border-slate-50",children:e.jsx("div",{className:`flex gap-2 max-w-3xl mx-auto ${g?"flex-wrap justify-center":"overflow-x-auto scrollbar-hide"}`,children:o.map((d,s)=>{const n=s===a;let c="bg-slate-200 text-slate-400";return n&&(c="bg-white text-[#00B1FF] border-2 border-[#00B1FF] shadow-sm"),e.jsx("button",{onClick:()=>{N(s),b(!1)},className:`w-9 h-9 rounded-xl flex-shrink-0 font-semibold text-[13px] transition-all flex items-center justify-center ${c}`,children:s+1},s)})})})}),e.jsxs("div",{className:"px-4 py-3 flex gap-3 max-w-3xl mx-auto",children:[e.jsxs("button",{onClick:B,disabled:a===0,className:`flex-1 py-3.5 rounded-xl font-semibold text-[15px] flex items-center justify-center gap-2 transition-all ${a===0?"bg-slate-100 text-slate-300":"bg-slate-100 text-slate-600 hover:bg-slate-200 active:scale-[0.98]"}`,children:[e.jsx(D,{className:"w-5 h-5"}),"Precedente"]}),e.jsxs("button",{onClick:A,disabled:a===o.length-1,className:`flex-1 py-3.5 rounded-xl font-semibold text-[15px] flex items-center justify-center gap-2 transition-all ${a===o.length-1?"bg-slate-100 text-slate-300":"bg-slate-100 text-slate-600 hover:bg-slate-200 active:scale-[0.98]"}`,children:["Successiva",e.jsx(P,{className:"w-5 h-5"})]})]})]})]})}function R({className:r}){return e.jsxs("svg",{className:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}export{X as default};
