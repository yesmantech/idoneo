import{s as r}from"./index-BcNl-kiB.js";async function E(n={}){const{search:a,categories:t,regions:i,province:o,status:l,educationLevel:d,minSeats:u,maxSeats:g,deadline_within_days:f,contractType:c,salaryMin:m,isRemote:h,sortBy:w="deadline",offset:_=0,limit:p=20}=n;let e=r.from("bandi").select(`
            *,
            ente:enti(*),
            category:bandi_categories(*)
        `,{count:"exact"}).eq("status","published");if(a){const s=`%${a}%`;e=e.or(`title.ilike.${s},short_description.ilike.${s},description.ilike.${s}`)}if(t!=null&&t.length&&(e=e.in("category_id",t)),i!=null&&i.length&&(e=e.in("region",i)),o&&(e=e.ilike("province",`%${o}%`)),l==="open"?e=e.gte("deadline",new Date().toISOString()):l==="closed"&&(e=e.lt("deadline",new Date().toISOString())),f){const s=new Date;s.setDate(s.getDate()+f),e=e.lte("deadline",s.toISOString()).gte("deadline",new Date().toISOString())}switch(d!=null&&d.length&&(e=e.overlaps("education_level",d)),u&&(e=e.gte("seats_total",u)),g&&(e=e.lte("seats_total",g)),c!=null&&c.length&&(e=e.in("contract_type",c)),m&&(e=e.gte("salary_max",m)),h&&(e=e.eq("is_remote",!0)),w){case"deadline":e=e.order("deadline",{ascending:!0});break;case"newest":e=e.order("published_at",{ascending:!1});break;case"seats":e=e.order("seats_total",{ascending:!1});break;default:e=e.order("deadline",{ascending:!0})}e=e.range(_,_+p-1);const{data:v,error:b,count:y}=await e;if(b)return console.error("Error fetching bandi:",b),{data:[],count:0};const S=new Date;return{data:(v||[]).map(s=>({...s,days_remaining:Math.max(0,Math.ceil((new Date(s.deadline).getTime()-S.getTime())/(1e3*60*60*24)))})),count:y||0}}async function q(n){const{data:a,error:t}=await r.from("bandi").select(`
            *,
            ente:enti(*),
            category:bandi_categories(*),
            updates:bandi_updates(*),
            documents:bandi_documents(*)
        `).eq("slug",n).eq("status","published").single();if(t||!a)return console.error("Error fetching bando:",t),null;const i=new Date;return{...a,days_remaining:Math.max(0,Math.ceil((new Date(a.deadline).getTime()-i.getTime())/(1e3*60*60*24)))}}async function I(n=7,a=10){const t=new Date,i=new Date(t.getTime()+n*24*60*60*1e3),{data:o,error:l}=await r.from("bandi").select(`
            *,
            ente:enti(*),
            category:bandi_categories(*)
        `).eq("status","published").gte("deadline",t.toISOString()).lte("deadline",i.toISOString()).order("deadline",{ascending:!0}).limit(a);return l?(console.error("Error fetching closing soon:",l),[]):(o||[]).map(d=>({...d,days_remaining:Math.max(0,Math.ceil((new Date(d.deadline).getTime()-t.getTime())/(1e3*60*60*24)))}))}async function M(){const{data:{user:n}}=await r.auth.getUser();if(!n)return[];const{data:a,error:t}=await r.from("user_bandi_saves").select(`
            bando:bandi(
                *,
                ente:enti(*),
                category:bandi_categories(*)
            )
        `).eq("user_id",n.id).order("saved_at",{ascending:!1});if(t)return console.error("Error fetching saved bandi:",t),[];const i=new Date;return(a||[]).map(o=>o.bando).filter(o=>!!o).map(o=>({...o,is_saved:!0,days_remaining:Math.max(0,Math.ceil((new Date(o.deadline).getTime()-i.getTime())/(1e3*60*60*24)))}))}async function B(n){const{data:{user:a}}=await r.auth.getUser();if(!a)return!1;const{error:t}=await r.from("user_bandi_saves").insert({user_id:a.id,bando_id:n});return t?(console.error("Error saving bando:",t),!1):!0}async function C(n){const{data:{user:a}}=await r.auth.getUser();if(!a)return!1;const{error:t}=await r.from("user_bandi_saves").delete().eq("user_id",a.id).eq("bando_id",n);return t?(console.error("Error unsaving bando:",t),!1):!0}async function O(n){const{data:{user:a}}=await r.auth.getUser();if(!a)return!1;const{data:t,error:i}=await r.from("user_bandi_saves").select("bando_id").eq("user_id",a.id).eq("bando_id",n).maybeSingle();return!i&&t!==null}async function x(){const{data:n,error:a}=await r.from("bandi_categories").select("*").eq("is_active",!0).order("sort_order");return a?(console.error("Error fetching categories:",a),[]):n||[]}const A=["Abruzzo","Basilicata","Calabria","Campania","Emilia-Romagna","Friuli-Venezia Giulia","Lazio","Liguria","Lombardia","Marche","Molise","Piemonte","Puglia","Sardegna","Sicilia","Toscana","Trentino-Alto Adige","Umbria","Valle d'Aosta","Veneto"],L=[{value:"diploma",label:"Diploma"},{value:"laurea_triennale",label:"Laurea Triennale"},{value:"laurea_magistrale",label:"Laurea Magistrale"},{value:"dottorato",label:"Dottorato"}],U=[{value:"tempo_indeterminato",label:"Tempo Indeterminato"},{value:"tempo_determinato",label:"Tempo Determinato"},{value:"formazione_lavoro",label:"Formazione e Lavoro"}];export{U as C,L as E,A as I,M as a,x as b,E as c,I as d,q as f,O as i,B as s,C as u};
