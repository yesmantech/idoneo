import{j as e,m as D,A as se}from"./framer-BdaCTGm4.js";import{r as x,u as ae,L as ye,b as Ne}from"./router-ClfHAwMg.js";import{T as ke}from"./TierSLoader-BJdwavnO.js";import{s as q}from"./index-DBMi1b3R.js";import{a as we,c as Ce,b as Se,g as ze}from"./statsService-Bi-BA9r_.js";import{R as le,m as X,E as Y,w as I,a3 as ne,O as Q,X as W,I as J,T as $e,aA as Fe,af as _e,b as Te,s as K,Z as qe,aB as De,j as te,y as ie,aC as Ie,N as Me,q as Ae,l as Be}from"./icons-DIoLbN6D.js";import{A as Pe}from"./AttemptCard-CI0gYZ4p.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";function Re({totalTests:t,bestScore:u,avgScore:h,accuracy:n,maxPossibleScore:d=100,scoreTrend:i,accuracyTrend:p,readiness:a,onOpenInfo:g}){const[r,o]=x.useState(null),[s,b]=x.useState(!1),c={tests:{title:"Simulazioni fatte",description:"Indica il numero totale di simulazioni d'esame che hai completato per questo concorso.",icon:e.jsx(le,{className:"w-6 h-6"}),color:"text-brand-purple bg-brand-purple/10"},best:{title:"Miglior Risultato",description:"Il punteggio piÃ¹ alto che hai ottenuto in una singola simulazione, rapportato al punteggio massimo possibile.",icon:e.jsx(X,{className:"w-6 h-6"}),color:"text-brand-orange bg-brand-orange/10"},avg:{title:"Punti su 100",description:"La tua media dei voti normalizzata su una scala da 0 a 100, per darti un'idea chiara del tuo livello medio.",icon:e.jsx(Y,{className:"w-6 h-6"}),color:"text-brand-blue bg-brand-blue/10"},accuracy:{title:"Risposte corrette",description:"La percentuale media di risposte esatte che dai durante i test. PiÃ¹ Ã¨ alta, piÃ¹ sei preciso.",icon:e.jsx(I,{className:"w-6 h-6"}),color:"text-semantic-success bg-semantic-success/10"}};return e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Z,{icon:e.jsx(le,{className:"w-5 h-5 text-brand-purple"}),iconBg:"bg-brand-purple/10",badgeColor:"bg-brand-purple/10 text-brand-purple",label:"Test fatti",value:t.toString(),subLabel:"Simulazioni fatte",onInfo:()=>o(c.tests)}),e.jsx(Z,{icon:e.jsx(X,{className:"w-5 h-5 text-brand-orange"}),iconBg:"bg-brand-orange/10",badgeColor:"bg-brand-orange/10 text-brand-orange",label:"Miglior voto",value:`${u.toFixed(0)}/${d}`,subLabel:"Miglior Risultato",onInfo:()=>o(c.best)}),e.jsx(Z,{icon:e.jsx(Y,{className:"w-5 h-5 text-brand-blue"}),iconBg:"bg-brand-blue/10",badgeColor:"bg-brand-blue/10 text-brand-blue",label:"Media voto",value:h.toFixed(1),subLabel:"Punti su 100",onInfo:()=>o(c.avg)}),e.jsx(Z,{icon:e.jsx(I,{className:"w-5 h-5 text-semantic-success"}),iconBg:"bg-semantic-success/10",badgeColor:"bg-semantic-success/10 text-semantic-success",label:"Accuratezza",value:`${n.toFixed(0)}%`,subLabel:"Risposte corrette",onInfo:()=>o(c.accuracy)})]}),a&&e.jsxs("div",{onClick:()=>b(!0),className:"group relative bg-[var(--card)] p-6 rounded-[32px] shadow-soft flex items-center justify-between overflow-hidden border border-[var(--card-border)] cursor-pointer hover:border-[#00B1FF]/30 transition-all",children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-gradient-to-bl from-[#00B1FF] to-emerald-500 opacity-[0.05] rounded-bl-[100px] pointer-events-none"}),e.jsxs("div",{className:"flex-1 pr-4 z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`px-2.5 py-0.5 rounded-full text-[10px] font-black uppercase tracking-wider ${a.level==="high"?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400":a.level==="medium"?"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400":"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400"}`,children:a.label}),e.jsx("div",{className:"w-4 h-4 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400",children:e.jsx(ne,{className:"w-2.5 h-2.5"})})]}),e.jsx("h3",{className:"text-xl font-black text-[var(--foreground)] mb-1 leading-tight",children:a.level==="high"?"Sei pronto!":a.level==="medium"?"A buon punto":"Sei all'inizio"}),e.jsx("p",{className:"text-[14px] text-slate-500 dark:text-slate-400 leading-snug",children:a.level==="high"?"Ottima costanza. Sei pronto per la prova ufficiale.":a.level==="medium"?"Continua cosÃ¬, manca poco per l'eccellenza.":"Serve piÃ¹ allenamento. Non mollare!"})]}),e.jsxs("div",{className:"relative w-20 h-20 flex-shrink-0 flex items-center justify-center z-10",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"40",cy:"40",r:"32",stroke:"currentColor",strokeWidth:"6",fill:"transparent",className:"text-slate-100 dark:text-slate-800"}),e.jsx(D.circle,{initial:{strokeDasharray:200,strokeDashoffset:200},animate:{strokeDashoffset:200-(a.score!==void 0?a.score:a.level==="high"?92:a.level==="medium"?65:35)/100*200},transition:{duration:1.5,ease:"easeOut"},cx:"40",cy:"40",r:"32",stroke:a.level==="high"?"#10B981":a.level==="medium"?"#F59E0B":"#EF4444",strokeWidth:"6",strokeLinecap:"round",fill:"transparent"})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:a.score!==void 0?e.jsx("span",{className:`text-lg font-black ${a.level==="high"?"text-emerald-600":a.level==="medium"?"text-amber-600":"text-red-600"}`,children:Math.round(a.score)}):e.jsx(e.Fragment,{children:a.level==="high"?e.jsx(X,{className:"w-6 h-6 text-emerald-600 dark:text-emerald-400"}):a.level==="medium"?e.jsx(Q,{className:"w-6 h-6 text-amber-600 dark:text-amber-400"}):e.jsx(I,{className:"w-6 h-6 text-red-600 dark:text-red-400"})})})]})]}),e.jsx(se,{children:r&&e.jsxs("div",{className:"fixed inset-0 z-[110] flex items-center justify-center p-6",children:[e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>o(null),className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm"}),e.jsxs(D.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},className:"relative bg-[var(--card)] border border-[var(--card-border)] rounded-[32px] p-8 max-w-xs w-full shadow-2xl text-center overflow-y-auto max-h-[90vh] custom-scrollbar",children:[e.jsx("button",{onClick:()=>o(null),className:"absolute top-4 right-4 p-2 bg-slate-100 dark:bg-slate-800 rounded-full text-[var(--foreground)] opacity-40 hover:opacity-100 transition-colors",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("div",{className:`w-16 h-16 rounded-[22px] ${r.color} flex items-center justify-center mx-auto mb-5`,children:r.icon}),e.jsx("h3",{className:"text-xl font-black text-[var(--foreground)] mb-2",children:r.title}),e.jsx("p",{className:"text-[var(--foreground)] opacity-50 text-sm font-medium leading-relaxed",children:r.description}),e.jsx("button",{onClick:()=>o(null),className:"w-full mt-8 py-3 bg-[var(--foreground)] text-[var(--background)] rounded-2xl font-bold hover:opacity-90 transition-opacity",children:"Ho capito"})]})]})}),e.jsx(se,{children:s&&a&&e.jsxs("div",{className:"fixed inset-0 z-[110] flex items-center justify-center p-6 px-8",children:[e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>b(!1),className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs(D.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},className:"relative bg-white dark:bg-[var(--card)] border border-transparent dark:border-[var(--card-border)] rounded-[32px] p-6 max-w-sm w-full shadow-2xl overflow-y-auto max-h-[90vh] custom-scrollbar",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-[#00B1FF] to-emerald-500 opacity-[0.1] rounded-bl-[100px] pointer-events-none"}),e.jsx("button",{onClick:()=>b(!1),className:"absolute top-4 right-4 p-2 bg-slate-100 dark:bg-slate-800 rounded-full text-slate-500 dark:text-slate-400 opacity-70 hover:opacity-100 transition-colors z-50",children:e.jsx(W,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:"text-xl font-black text-slate-900 dark:text-[var(--foreground)] mb-2",children:"Livello di Preparazione"}),e.jsx("p",{className:"text-[14px] text-slate-500 dark:text-slate-400 leading-relaxed mb-6",children:"Il nostro algoritmo analizza le tue ultime simulazioni per calcolare quanto sei pronto per l'esame ufficiale."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-3 rounded-2xl flex items-center gap-3 border ${a.level==="high"?"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800":"bg-slate-50 dark:bg-slate-800/50 border-slate-100 dark:border-slate-700"}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-100 dark:bg-emerald-900/50 flex items-center justify-center flex-shrink-0",children:e.jsx(X,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[14px] font-bold text-slate-900 dark:text-slate-200",children:"Pronto"}),e.jsx("p",{className:"text-[12px] text-slate-500 dark:text-slate-400",children:"Media superiore a 90/100."})]}),a.level==="high"&&e.jsx(J,{className:"w-5 h-5 text-emerald-500 ml-auto"})]}),e.jsxs("div",{className:`p-3 rounded-2xl flex items-center gap-3 border ${a.level==="medium"?"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800":"bg-slate-50 dark:bg-slate-800/50 border-slate-100 dark:border-slate-700"}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-100 dark:bg-amber-900/50 flex items-center justify-center flex-shrink-0",children:e.jsx(Q,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[14px] font-bold text-slate-900 dark:text-slate-200",children:"A buon punto"}),e.jsx("p",{className:"text-[12px] text-slate-500 dark:text-slate-400",children:"Media tra 70/100 e 90/100."})]}),a.level==="medium"&&e.jsx(J,{className:"w-5 h-5 text-amber-500 ml-auto"})]}),e.jsxs("div",{className:`p-3 rounded-2xl flex items-center gap-3 border ${a.level==="low"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-slate-50 dark:bg-slate-800/50 border-slate-100 dark:border-slate-700"}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-100 dark:bg-red-900/50 flex items-center justify-center flex-shrink-0",children:e.jsx($e,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[14px] font-bold text-slate-900 dark:text-slate-200",children:"Da migliorare"}),e.jsx("p",{className:"text-[12px] text-slate-500 dark:text-slate-400",children:"Media inferiore a 70/100."})]}),a.level==="low"&&e.jsx(J,{className:"w-5 h-5 text-red-500 ml-auto"})]})]}),a.breakdown&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-slate-100 dark:border-slate-800 space-y-4",children:[e.jsx("h4",{className:"text-xs font-black text-slate-400 uppercase tracking-wider mb-2",children:"Analisi Dettagliata"}),[{label:"Accuratezza",value:a.breakdown.accuracy,color:"bg-emerald-500"},{label:"Volume (Risposte Corrette)",value:a.breakdown.volume,color:"bg-blue-500"},{label:"Copertura Banca Dati",value:a.breakdown.coverage,color:"bg-purple-500"},{label:"Costanza (Reliability)",value:a.breakdown.reliability,color:"bg-amber-500"}].map(v=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:v.label}),e.jsxs("span",{className:"text-slate-900 dark:text-slate-100",children:[Math.round(v.value),"%"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden",children:e.jsx(D.div,{initial:{width:0},animate:{width:`${v.value}%`},className:`h-full ${v.color}`})})]},v.label))]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-slate-100 dark:border-slate-800",children:e.jsxs("p",{className:"text-[12px] text-slate-400 text-center",children:["Il calcolo si attiva dopo almeno ",e.jsx("span",{className:"font-bold text-slate-600 dark:text-slate-300",children:"3 simulazioni"})," completate."]})}),e.jsxs("a",{href:"/come-funziona/punteggi",className:"mt-4 flex items-center justify-between p-3 rounded-xl bg-gradient-to-r from-[#00B1FF]/10 to-emerald-500/10 hover:from-[#00B1FF]/20 hover:to-emerald-500/20 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[#00B1FF]/20 flex items-center justify-center",children:e.jsx(Y,{className:"w-4 h-4 text-[#00B1FF]"})}),e.jsx("span",{className:"text-[13px] font-bold text-slate-700 dark:text-slate-200",children:"Scopri come calcoliamo i punteggi"})]}),e.jsx("svg",{className:"w-4 h-4 text-slate-400 group-hover:translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsx("button",{onClick:()=>b(!1),className:"w-full mt-4 py-3 bg-slate-900 dark:bg-[var(--foreground)] text-white dark:text-[var(--background)] rounded-xl font-bold hover:opacity-90 transition-opacity",children:"Chiaro!"})]})]})]})})]})}function Z({icon:t,iconBg:u,badgeColor:h,label:n,value:d,subLabel:i,onInfo:p}){return e.jsxs("div",{onClick:p,className:"bg-[var(--card)] p-4 rounded-[24px] shadow-soft border border-[var(--card-border)] hover:shadow-card transition-all duration-300 group flex flex-col justify-between h-[150px] relative overflow-hidden cursor-pointer active:scale-95",children:[e.jsx("div",{className:"flex justify-between items-start z-10 relative",children:e.jsx("div",{className:`w-10 h-10 rounded-[14px] flex items-center justify-center ${u} transition-transform group-hover:scale-110 duration-300`,children:t})}),e.jsxs("div",{className:"z-10 relative",children:[e.jsx("div",{className:"text-[32px] font-black text-[var(--foreground)] leading-none tracking-tight mb-1",children:d}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-[11px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-wide",children:i}),e.jsx("button",{onClick:a=>{a.stopPropagation(),p()},className:"p-1.5 rounded-full bg-slate-50 dark:bg-slate-800 text-[var(--foreground)] opacity-20 hover:opacity-100 hover:text-brand-blue hover:bg-brand-blue/5 transition-all",children:e.jsx(ne,{className:"w-3.5 h-3.5"})})]})]})]})}function Le({data:t}){if(t.length<3)return e.jsx(Oe,{data:t});const u=300,h=u/2,n=u/2-40,d=t.length,i=(r,o)=>{const s=Math.PI*2*o/d-Math.PI/2,b=h+n*(r/100)*Math.cos(s),c=h+n*(r/100)*Math.sin(s);return{x:b,y:c}},p=t.map((r,o)=>{const{x:s,y:b}=i(r.accuracy,o);return`${s},${b}`}).join(" "),a=t.map((r,o)=>{const{x:s,y:b}=i(100,o),c=Math.PI*2*o/d-Math.PI/2,v=h+(n+20)*Math.cos(c),M=h+(n+20)*Math.sin(c);return{x:s,y:b,lx:v,ly:M,label:r.subject}}),g=[20,40,60,80,100];return e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("svg",{width:u,height:u,className:"overflow-visible",children:[g.map(r=>{const o=t.map((s,b)=>{const{x:c,y:v}=i(r,b);return`${c},${v}`}).join(" ");return e.jsx("polygon",{points:o,fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"text-slate-100 dark:text-slate-800"},r)}),a.map((r,o)=>e.jsxs("g",{children:[e.jsx("line",{x1:h,y1:h,x2:r.x,y2:r.y,stroke:"currentColor",strokeWidth:"1.5",className:"text-slate-100 dark:text-slate-800"}),e.jsx("text",{x:r.lx,y:r.ly,textAnchor:"middle",dominantBaseline:"middle",className:"text-[10px] fill-[var(--foreground)] opacity-40 font-bold uppercase tracking-wider",children:r.label.substring(0,15)})]},o)),e.jsx("polygon",{points:p,fill:"rgba(6, 214, 211, 0.2)",stroke:"#06D6D3",strokeWidth:"3",strokeLinejoin:"round"}),t.map((r,o)=>{const{x:s,y:b}=i(r.accuracy,o);return e.jsx("circle",{cx:s,cy:b,r:"5",fill:"#06D6D3",stroke:"var(--card)",strokeWidth:"3"},o)})]})})}function Oe({data:t}){return e.jsxs("div",{className:"space-y-4 w-full",children:[t.map(u=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-bold text-[var(--foreground)] opacity-60",children:u.subject}),e.jsxs("span",{className:"text-sm font-bold text-[var(--foreground)]",children:[u.accuracy.toFixed(0),"%"]})]}),e.jsx("div",{className:"h-2 w-full bg-slate-100 dark:bg-slate-800 rounded-pill overflow-hidden",children:e.jsx("div",{className:`h-full rounded-pill transition-all duration-500 ${u.accuracy>=70?"bg-emerald-500":u.accuracy>=50?"bg-amber-500":"bg-rose-500"}`,style:{width:`${u.accuracy}%`}})})]},u.subject)),t.length===0&&e.jsx("p",{className:"text-slate-400 text-sm text-center",children:"Nessun dato materia."})]})}function Ge({attempts:t,quizId:u,onRepeatTest:h}){ae();const[n,d]=x.useState("all"),[i,p]=x.useState("all"),[a,g]=x.useState(!1),r=x.useMemo(()=>t.filter(s=>{if(n!=="all"&&(n==="official"&&s.mode!=="official"||n==="custom"&&s.mode!=="custom"))return!1;if(i!=="all"){const b=s.total_questions>0?s.correct/s.total_questions*100:0;let c="fail";if(b>=60?c="pass":b>=50&&(c="near"),i!==c)return!1}return!0}),[t,n,i]);if(t.length===0)return e.jsxs("div",{className:"text-center py-12 text-[var(--foreground)] opacity-40",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ“"}),"Nessuna attivitÃ  recente."]});const o=n!=="all"||i!=="all";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>g(!a),className:"flex items-center gap-2 text-xs font-bold text-[var(--foreground)] opacity-50 hover:opacity-100 transition-opacity",children:["Filtri",o&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#00B1FF]"}),a?e.jsx(Fe,{className:"w-4 h-4"}):e.jsx(_e,{className:"w-4 h-4"})]}),a&&e.jsxs("div",{className:"flex flex-wrap gap-4 pb-2 p-4 bg-[var(--card)] rounded-2xl border border-[var(--card-border)] shadow-sm",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase mr-2 self-center",children:"Tipo:"}),[{value:"all",label:"Tutti"},{value:"official",label:"Esame"},{value:"custom",label:"Personalizzata"}].map(s=>e.jsx("button",{onClick:()=>d(s.value),className:`px-3 py-1 text-xs font-bold rounded-full transition-all ${n===s.value?"bg-[#00B1FF] text-white":"bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:s.label},s.value))]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase mr-2 self-center",children:"Risultato:"}),[{value:"all",label:"Tutti"},{value:"pass",label:"Idoneo"},{value:"near",label:"Quasi"},{value:"fail",label:"Non idoneo"}].map(s=>e.jsx("button",{onClick:()=>p(s.value),className:`px-3 py-1 text-xs font-bold rounded-full transition-all ${i===s.value?"bg-slate-900 dark:bg-slate-700 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:s.label},s.value))]})]}),o&&e.jsxs("p",{className:"text-xs text-[var(--foreground)] opacity-40",children:[r.length," risultat",r.length===1?"o":"i"," trovat",r.length===1?"o":"i"]}),e.jsx("div",{className:"space-y-3",children:r.map(s=>e.jsx(Pe,{attempt:s},s.id))}),r.length===0&&e.jsxs("div",{className:"text-center py-12 text-[var(--foreground)] opacity-40",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ”"}),"Nessun tentativo corrisponde ai filtri selezionati."]})]})}const ee={score:{label:"Punteggio",unit:"pt",color:"#06D6D3"},accuracy:{label:"Accuratezza",unit:"%",color:"#22C55E"},responseTime:{label:"Tempo medio",unit:"s",color:"#F59E0B"}};function Ee({data:t,defaultMetric:u="score",defaultTimeRange:h="all"}){var L,V;const[n,d]=x.useState(u),[i,p]=x.useState(h),[a,g]=x.useState(null),r=x.useMemo(()=>{if(i==="all")return t;const l=new Date,N=i==="7d"?7:30,_=new Date(l.getTime()-N*24*60*60*1e3);return t.filter(O=>O.fullDate>=_)},[t,i]),o=l=>{switch(n){case"score":return l.score;case"accuracy":return l.accuracy;case"responseTime":return(l.responseTime||0)/1e3;default:return l.score}};if(r.length<2)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center",children:[e.jsx("div",{className:"flex gap-1",children:["score","accuracy"].map(l=>e.jsx("button",{onClick:()=>d(l),className:`px-3 py-1.5 text-xs font-bold rounded-pill transition-all ${n===l?"bg-brand-cyan text-white":"bg-slate-100 dark:bg-slate-800 text-text-secondary dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:ee[l].label},l))}),e.jsx("div",{className:"flex gap-1",children:["7d","30d","all"].map(l=>e.jsx("button",{onClick:()=>p(l),className:`px-3 py-1.5 text-xs font-bold rounded-pill transition-all ${i===l?"bg-[var(--foreground)] text-[var(--background)]":"bg-slate-100 dark:bg-slate-800 text-text-secondary dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:l==="all"?"Tutto":l},l))})]}),e.jsx("div",{className:"h-48 flex items-center justify-center text-slate-400 italic text-sm",children:"Non ci sono abbastanza dati per questo periodo."})]});const s=600,b=200,c=30,v=r.map(o),M=Math.max(...v,10),f=Math.min(...v,0),z=M-f||1,k=l=>c+l/(r.length-1)*(s-c*2),R=l=>b-c-(l-f)/z*(b-c*2),H=r.map((l,N)=>{const _=k(N),O=R(o(l));return`${N===0?"M":"L"} ${_} ${O}`}).join(" "),E=`${H} L ${s-c} ${b-c} L ${c} ${b-c} Z`,A=ee[n];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center",children:[e.jsx("div",{className:"flex gap-1",children:["score","accuracy"].map(l=>e.jsx("button",{onClick:()=>d(l),className:`px-3 py-1.5 text-xs font-bold rounded-pill transition-all ${n===l?"bg-brand-cyan text-white":"bg-slate-100 dark:bg-slate-800 text-text-secondary dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:ee[l].label},l))}),e.jsx("div",{className:"flex gap-1",children:["7d","30d","all"].map(l=>e.jsx("button",{onClick:()=>p(l),className:`px-3 py-1.5 text-xs font-bold rounded-pill transition-all ${i===l?"bg-[var(--foreground)] text-[var(--background)]":"bg-slate-100 dark:bg-slate-800 text-text-secondary dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:l==="all"?"Tutto":l},l))})]}),e.jsxs("div",{className:"w-full overflow-hidden relative",children:[e.jsxs("svg",{viewBox:`0 0 ${s} ${b}`,className:"w-full h-auto",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${n}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:A.color,stopOpacity:"0.2"}),e.jsx("stop",{offset:"100%",stopColor:A.color,stopOpacity:"0"})]})}),[0,.5,1].map(l=>{const N=f+z*l,_=R(N);return e.jsxs("g",{children:[e.jsx("line",{x1:c,y1:_,x2:s-c,y2:_,stroke:"currentColor",className:"text-slate-200 dark:text-slate-800",strokeWidth:"1.5",strokeDasharray:"4"}),e.jsx("text",{x:c-8,y:_+4,textAnchor:"end",className:"text-[10px] fill-[var(--foreground)] opacity-40 font-medium",children:N.toFixed(0)})]},l)}),e.jsx("path",{d:E,fill:`url(#gradient-${n})`}),e.jsx("path",{d:H,fill:"none",stroke:A.color,strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),r.map((l,N)=>e.jsx("g",{children:e.jsx("circle",{cx:k(N),cy:R(o(l)),r:a===N?8:5,fill:"var(--card)",stroke:A.color,strokeWidth:"3",className:"cursor-pointer transition-all",onMouseEnter:()=>g(N),onMouseLeave:()=>g(null)})},N))]}),a!==null&&r[a]&&e.jsxs("div",{className:"absolute bg-[var(--card)] rounded-xl shadow-lg border border-[var(--card-border)] p-3 z-10 pointer-events-none transition-colors",style:{left:`${k(a)/s*100}%`,top:`${R(o(r[a]))/b*100-20}%`,transform:"translateX(-50%)"},children:[e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-40 mb-1",children:r[a].date}),e.jsxs("p",{className:"text-sm font-bold text-[var(--foreground)]",children:[o(r[a]).toFixed(1)," ",A.unit]}),r[a].id&&e.jsx(ye,{to:`/quiz/results/${r[a].id}`,className:"text-[10px] font-bold text-brand-cyan hover:underline pointer-events-auto",children:"Vedi dettagli â†’"})]})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-text-tertiary font-medium px-2",children:[e.jsx("span",{children:(L=r[0])==null?void 0:L.date}),e.jsx("span",{children:(V=r[r.length-1])==null?void 0:V.date})]})]})}const Qe={review:{icon:De,gradient:"from-amber-500 to-orange-500",bgGlow:"bg-gradient-to-br from-amber-500/10 to-orange-500/10",iconBg:"bg-gradient-to-br from-amber-500 to-orange-500",accentColor:"text-amber-600 dark:text-amber-400",borderHover:"hover:border-amber-300 dark:hover:border-amber-600"},practice:{icon:I,gradient:"from-rose-500 to-pink-500",bgGlow:"bg-gradient-to-br from-rose-500/10 to-pink-500/10",iconBg:"bg-gradient-to-br from-rose-500 to-pink-500",accentColor:"text-rose-600 dark:text-rose-400",borderHover:"hover:border-rose-300 dark:hover:border-rose-600"},simulation:{icon:qe,gradient:"from-[#00B1FF] to-cyan-400",bgGlow:"bg-gradient-to-br from-[#00B1FF]/10 to-cyan-400/10",iconBg:"bg-gradient-to-br from-[#00B1FF] to-cyan-400",accentColor:"text-[#00B1FF]",borderHover:"hover:border-cyan-300 dark:hover:border-cyan-600"},goal:{icon:K,gradient:"from-emerald-500 to-green-500",bgGlow:"bg-gradient-to-br from-emerald-500/10 to-green-500/10",iconBg:"bg-gradient-to-br from-emerald-500 to-green-500",accentColor:"text-emerald-600 dark:text-emerald-400",borderHover:"hover:border-emerald-300 dark:hover:border-emerald-600"}};function We({recommendations:t,onSetGoal:u}){const h=ae();if(t.length===0)return null;const n=d=>{d.type==="goal"&&u?u():d.actionUrl&&h(d.actionUrl)};return e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative bg-[var(--card)] rounded-[32px] shadow-soft p-6 border border-[var(--card-border)] transition-colors overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-48 h-48 bg-gradient-to-bl from-[#00B1FF]/5 to-emerald-500/5 rounded-bl-[100px] pointer-events-none"}),e.jsxs("div",{className:"flex items-center justify-between mb-6 relative z-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-[var(--foreground)]",children:"Cosa fare adesso"}),e.jsx("p",{className:"text-[13px] text-slate-500 dark:text-slate-400 mt-0.5",children:"Suggerimenti personalizzati per te"})]}),e.jsx(D.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0,repeatDelay:3},className:"w-14 h-14 rounded-[18px] bg-gradient-to-br from-[#00B1FF] to-emerald-500 flex items-center justify-center shadow-lg",children:e.jsx(Te,{className:"w-7 h-7 text-white"})})]}),e.jsx("div",{className:"space-y-3 relative z-10",children:t.map((d,i)=>{const p=Qe[d.type],a=p.icon;return e.jsxs(D.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:i*.1},onClick:()=>n(d),className:`w-full flex items-center gap-4 p-4 rounded-[20px] bg-white dark:bg-slate-800/50 border border-slate-100 dark:border-slate-700/50 ${p.borderHover} hover:shadow-md active:scale-[0.98] transition-all text-left group relative overflow-hidden`,children:[e.jsx("div",{className:`absolute inset-0 ${p.bgGlow} opacity-0 group-hover:opacity-100 transition-opacity`}),e.jsx("div",{className:`relative w-12 h-12 rounded-2xl ${p.iconBg} flex items-center justify-center flex-shrink-0 shadow-md`,children:e.jsx(a,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0 relative z-10",children:[e.jsx("p",{className:"text-[15px] font-bold text-slate-900 dark:text-slate-100 leading-tight",children:d.title}),e.jsx("p",{className:"text-[13px] text-slate-500 dark:text-slate-400 mt-0.5 line-clamp-1",children:d.description})]}),e.jsx("div",{className:"relative z-10 w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center group-hover:bg-slate-200 dark:group-hover:bg-slate-600 transition-colors flex-shrink-0",children:e.jsx(te,{className:"w-4 h-4 text-slate-500 dark:text-slate-400 group-hover:translate-x-0.5 transition-transform"})})]},d.id)})}),e.jsx("div",{className:"mt-5 pt-4 border-t border-slate-100 dark:border-slate-800 relative z-10",children:e.jsx("p",{className:"text-[12px] text-slate-400 dark:text-slate-500 text-center",children:"ðŸ’¡ Completa queste azioni per migliorare il tuo punteggio"})})]})}const He={score:{label:"Punteggio",unit:"punti",icon:I},accuracy:{label:"Accuratezza",unit:"%",icon:Q},attempts:{label:"Simulazioni",unit:"",icon:K}};function Ve({goal:t,onCreateGoal:u,onDeleteGoal:h}){if(!t)return e.jsxs("div",{className:"bg-[var(--card)] rounded-card shadow-soft p-6 border border-[var(--card-border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--foreground)]",children:"Il tuo obiettivo"}),e.jsx("div",{className:"w-10 h-10 rounded-squircle bg-brand-cyan/10 flex items-center justify-center",children:e.jsx(K,{className:"w-5 h-5 text-brand-cyan"})})]}),e.jsxs("div",{className:"text-center py-8 bg-slate-50 dark:bg-slate-900/50 rounded-2xl border border-dashed border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-[var(--card)] shadow-sm flex items-center justify-center mx-auto mb-3",children:e.jsx(I,{className:"w-6 h-6 text-[var(--foreground)] opacity-30"})}),e.jsx("p",{className:"text-sm font-medium text-[var(--foreground)] opacity-50 mb-4",children:"Imposta un obiettivo per rimanere motivato"}),e.jsx("button",{onClick:u,className:"px-6 py-2.5 bg-brand-cyan text-white font-bold text-sm rounded-pill hover:bg-brand-cyan/90 active:scale-95 transition-all shadow-sm",children:"Imposta obiettivo"})]})]});const n=He[t.goal_type],d=n.icon,i=Math.min(t.current_value/t.target_value*100,100),p=t.deadline?Math.max(0,Math.ceil((new Date(t.deadline).getTime()-Date.now())/(1e3*60*60*24))):null,a={active:{label:"In corso",color:"text-brand-cyan bg-brand-cyan/10"},achieved:{label:"Raggiunto! ðŸŽ‰",color:"text-emerald-500 bg-emerald-500/10"},failed:{label:"Non raggiunto",color:"text-rose-500 bg-rose-500/10"},expired:{label:"Scaduto",color:"text-[var(--foreground)] opacity-40 bg-slate-100 dark:bg-slate-800"}},g=i>=100?"achieved":p!==null&&p<=3&&i<80?"at-risk":i>=60?"on-track":"behind",r={achieved:"Obiettivo raggiunto!","on-track":"Sei sulla buona strada",behind:"Devi accelerare","at-risk":"Obiettivo a rischio"};return e.jsxs("div",{className:"bg-[var(--card)] rounded-card shadow-soft p-6 border border-[var(--card-border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--foreground)]",children:"Il tuo obiettivo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2.5 py-1 rounded-pill text-[10px] font-bold uppercase tracking-wide ${a[t.status].color}`,children:a[t.status].label}),h&&t.status==="active"&&e.jsx("button",{onClick:()=>h(t.id),className:"p-1.5 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:e.jsx(W,{className:"w-4 h-4 text-[var(--foreground)] opacity-40"})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-brand-cyan/10 flex items-center justify-center",children:e.jsx(d,{className:"w-6 h-6 text-brand-cyan"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--foreground)] opacity-50",children:n.label}),e.jsxs("p",{className:"text-2xl font-black text-[var(--foreground)]",children:[t.current_value.toFixed(0),e.jsxs("span",{className:"opacity-30",children:["/",t.target_value.toFixed(0)]}),e.jsx("span",{className:"text-sm font-bold opacity-30 ml-1",children:n.unit})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"h-3 bg-slate-100 dark:bg-slate-800 rounded-pill overflow-hidden",children:e.jsx("div",{className:`h-full rounded-pill transition-all duration-500 ${i>=100?"bg-emerald-500":g==="at-risk"?"bg-rose-500":g==="behind"?"bg-amber-500":"bg-brand-cyan"}`,style:{width:`${i}%`}})})}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:`font-bold ${g==="achieved"?"text-emerald-500":g==="at-risk"?"text-rose-500":g==="behind"?"text-amber-500":"text-[var(--foreground)] opacity-50"}`,children:r[g]}),p!==null&&e.jsxs("span",{className:"text-[var(--foreground)] opacity-30 flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),p===0?"Scade oggi":`${p} giorni rimasti`]})]})]})}function Ue({subject:t,quizId:u,onClose:h,onPractice:n,onReviewErrors:d}){if(!t)return null;const i=t.trend==="improving"?Q:t.trend==="declining"?Ie:Me,p=t.trend==="improving"?"text-emerald-500":t.trend==="declining"?"text-rose-500":"text-[var(--foreground)] opacity-30",g={good:{label:"Buono",color:"bg-emerald-500",bgColor:"bg-emerald-500/10",textColor:"text-emerald-500"},warning:{label:"Da migliorare",color:"bg-amber-500",bgColor:"bg-amber-500/10",textColor:"text-amber-500"},critical:{label:"Critico",color:"bg-rose-500",bgColor:"bg-rose-500/10",textColor:"text-rose-500"}}[t.status],r=t.totalQuestions-t.correctAnswers,o=()=>{n?n(t.subjectId):window.location.href=`/quiz/${u}/practice?subject=${t.subjectId}`},s=()=>{d?d(t.subjectId):window.location.href=`/quiz/${u}/review?subject=${t.subjectId}`};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:h}),e.jsxs("div",{className:"relative bg-[var(--card)] w-full max-w-lg rounded-t-3xl sm:rounded-3xl shadow-2xl max-h-[85vh] overflow-auto animate-in slide-in-from-bottom-4 duration-300 border-t sm:border border-[var(--card-border)]",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2 sm:hidden",children:e.jsx("div",{className:"w-10 h-1 bg-slate-200 dark:bg-slate-700 rounded-full"})}),e.jsxs("div",{className:"sticky top-0 bg-[var(--card)] px-6 py-4 border-b border-[var(--card-border)] flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${g.color}`}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-[var(--foreground)]",children:t.subjectName}),e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-40",children:"Analisi dettagliata"})]})]}),e.jsx("button",{onClick:h,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(W,{className:"w-5 h-5 text-[var(--foreground)] opacity-40"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-2xl p-4 border border-slate-100 dark:border-slate-800",children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest mb-1",children:"Accuratezza"}),e.jsxs("p",{className:`text-3xl font-black ${g.textColor}`,children:[t.accuracy.toFixed(0),"%"]}),e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-xs font-bold ${p}`,children:[e.jsx(i,{className:"w-3 h-3"}),e.jsx("span",{children:t.trend==="improving"?"In miglioramento":t.trend==="declining"?"In calo":"Stabile"})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-2xl p-4 border border-slate-100 dark:border-slate-800",children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest mb-1",children:"Domande"}),e.jsx("p",{className:"text-3xl font-black text-[var(--foreground)]",children:t.totalQuestions}),e.jsxs("p",{className:"text-xs text-[var(--foreground)] opacity-40 mt-1",children:[t.correctAnswers," corrette Â· ",r," sbagliate"]})]})]}),e.jsxs("div",{className:`${g.bgColor} rounded-2xl p-4 flex items-center gap-3 border border-current opacity-90`,children:[e.jsx("div",{className:`w-10 h-10 rounded-xl ${g.color} flex items-center justify-center shadow-lg shadow-current/10`,children:e.jsx("span",{className:"text-white text-lg",children:t.status==="good"?"âœ“":t.status==="warning"?"!":"âœ—"})}),e.jsxs("div",{children:[e.jsxs("p",{className:`text-sm font-bold ${g.textColor}`,children:["Stato: ",g.label]}),e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-50",children:t.status==="good"?"Ottimo lavoro! Continua cosÃ¬.":t.status==="warning"?"Qualche errore di troppo. Ripassa questa materia.":"Attenzione! Questa materia richiede studio intensivo."})]})]}),t.avgResponseTimeMs&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-2xl p-4 border border-slate-100 dark:border-slate-800",children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest mb-1",children:"Tempo medio per risposta"}),e.jsxs("p",{className:"text-2xl font-black text-[var(--foreground)]",children:[(t.avgResponseTimeMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest",children:"Azioni consigliate"}),r>0&&e.jsxs("button",{onClick:s,className:"w-full flex items-center gap-4 p-4 rounded-2xl border border-amber-100 dark:border-amber-900/30 bg-amber-50 dark:bg-amber-900/10 hover:bg-amber-100/50 dark:hover:bg-amber-900/20 transition-all text-left group",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 flex items-center justify-center flex-shrink-0",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-bold text-[var(--foreground)]",children:["Ripassa ",r," errori"]}),e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-40",children:"Rivedi le domande sbagliate"})]}),e.jsx(te,{className:"w-5 h-5 text-[var(--foreground)] opacity-20 group-hover:opacity-100 group-hover:translate-x-0.5 transition-all"})]}),e.jsxs("button",{onClick:o,className:"w-full flex items-center gap-4 p-4 rounded-2xl border border-brand-cyan/20 bg-brand-cyan/5 dark:bg-brand-cyan/10 hover:bg-brand-cyan/10 dark:hover:bg-brand-cyan/20 transition-all text-left group",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-brand-cyan/20 text-brand-cyan flex items-center justify-center flex-shrink-0",children:e.jsx(I,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-bold text-[var(--foreground)]",children:"Esercitati su questa materia"}),e.jsxs("p",{className:"text-xs text-[var(--foreground)] opacity-40",children:["Quiz focalizzato solo su ",t.subjectName]})]}),e.jsx(te,{className:"w-5 h-5 text-[var(--foreground)] opacity-20 group-hover:opacity-100 group-hover:translate-x-0.5 transition-all"})]})]})]})]})]})}const oe=[{value:"score",label:"Punteggio",description:"Raggiungi un punteggio target",icon:I,unit:"punti",placeholder:"75",min:0,max:100},{value:"accuracy",label:"Accuratezza",description:"Mantieni una percentuale di risposte corrette",icon:Q,unit:"%",placeholder:"80",min:0,max:100},{value:"attempts",label:"Simulazioni",description:"Completa un numero di simulazioni",icon:K,unit:"test",placeholder:"10",min:1,max:100}];function Xe({isOpen:t,quizId:u,onClose:h,onSubmit:n}){const[d,i]=x.useState("score"),[p,a]=x.useState(""),[g,r]=x.useState(""),[o,s]=x.useState(!1),[b,c]=x.useState(""),v=oe.find(f=>f.value===d),M=async f=>{f.preventDefault(),c("");const z=parseFloat(p);if(isNaN(z)||z<v.min||z>v.max){c(`Inserisci un valore tra ${v.min} e ${v.max}`);return}s(!0);try{await n({goal_type:d,target_value:z,deadline:g||null}),h()}catch{c("Errore nel salvare l'obiettivo. Riprova.")}finally{s(!1)}};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:h}),e.jsxs("div",{className:"relative bg-[var(--card)] w-full max-w-md rounded-3xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200 border border-[var(--card-border)]",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-[var(--card-border)] flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-[var(--foreground)]",children:"Nuovo obiettivo"}),e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-50 mt-0.5",children:"Imposta un traguardo per restare motivato"})]}),e.jsx("button",{onClick:h,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(W,{className:"w-5 h-5 text-[var(--foreground)] opacity-40"})})]}),e.jsxs("form",{onSubmit:M,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest block mb-3",children:"Tipo di obiettivo"}),e.jsx("div",{className:"space-y-2",children:oe.map(f=>{const z=f.icon,k=d===f.value;return e.jsxs("button",{type:"button",onClick:()=>{i(f.value),a("")},className:`w-full flex items-center gap-4 p-4 rounded-2xl border transition-all ${k?"border-brand-cyan bg-brand-cyan/5 dark:bg-brand-cyan/10":"border-slate-100 dark:border-slate-800 hover:border-slate-200 dark:hover:border-slate-700 bg-[var(--card)]"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${k?"bg-brand-cyan text-white":"bg-slate-100 dark:bg-slate-800 text-[var(--foreground)] opacity-40"}`,children:e.jsx(z,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:`text-sm font-bold ${k?"text-brand-cyan":"text-[var(--foreground)]"}`,children:f.label}),e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-50",children:f.description})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${k?"border-brand-cyan":"border-slate-200 dark:border-slate-700"}`,children:k&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-brand-cyan"})})]},f.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest block mb-2",children:"Valore target"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:p,onChange:f=>a(f.target.value),placeholder:v.placeholder,min:v.min,max:v.max,className:"w-full px-4 py-3 pr-16 rounded-xl border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 focus:border-brand-cyan dark:focus:border-brand-cyan focus:ring-2 focus:ring-brand-cyan/20 outline-none text-[var(--foreground)] font-bold text-lg transition-all",required:!0}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-[var(--foreground)] opacity-40 font-bold",children:v.unit})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest block mb-2",children:"Scadenza (opzionale)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-[var(--foreground)] opacity-40"}),e.jsx("input",{type:"date",value:g,onChange:f=>r(f.target.value),min:new Date().toISOString().split("T")[0],className:"w-full pl-12 pr-4 py-3 rounded-xl border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 focus:border-brand-cyan dark:focus:border-brand-cyan focus:ring-2 focus:ring-brand-cyan/20 outline-none text-[var(--foreground)] font-medium transition-all"})]})]}),b&&e.jsx("p",{className:"text-sm text-semantic-error bg-semantic-error/10 px-4 py-2 rounded-xl",children:b}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:h,className:"flex-1 py-3 px-4 rounded-xl border border-slate-200 dark:border-slate-800 font-bold text-[var(--foreground)] opacity-60 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:"Annulla"}),e.jsx("button",{type:"submit",disabled:o||!p,className:"flex-1 py-3 px-4 rounded-xl bg-brand-cyan text-white font-bold hover:bg-brand-cyan/90 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:o?"Salvataggio...":"Salva obiettivo"})]})]})]})]}):null}function lt(){const{quizId:t}=Ne(),u=ae(),[h,n]=x.useState(!0),[d,i]=x.useState([]),[p,a]=x.useState(!1),[g,r]=x.useState(!1),[o,s]=x.useState(null),[b,c]=x.useState(null),[v,M]=x.useState(null),[f,z]=x.useState({totalTests:0,avgScore:0,avgAccuracy:0,bestScore:0,maxPossibleScore:100}),[k,R]=x.useState([]),[H,E]=x.useState(null),[A,L]=x.useState(!1),[V,l]=x.useState(null),[N,_]=x.useState([]),[O,ce]=x.useState([]),[de,xe]=x.useState([]),[ue,me]=x.useState("Statistiche Corso");x.useEffect(()=>{t&&be()},[t]);const be=async()=>{n(!0);const{data:{user:m}}=await q.auth.getUser();if(!m){u("/login");return}try{const[C,$,S]=await Promise.all([q.from("quizzes").select("title, total_questions, points_correct, rule_id").eq("id",t).single(),q.from("quiz_attempts").select("*, quiz:quizzes(title), mode").eq("user_id",m.id).eq("quiz_id",t).order("created_at",{ascending:!1}),q.from("test_goals").select("*").eq("user_id",m.id).eq("quiz_id",t).eq("status","active").maybeSingle()]),y=C.data,B=$.data,G=$.error,U=S.data;let F=0;if(y){if(me(y.title),y.rule_id){const{data:w}=await q.from("simulation_rules").select("total_questions, points_correct").eq("id",y.rule_id).single();w&&w.total_questions&&w.points_correct&&(F=w.total_questions*w.points_correct)}F===0&&y.total_questions&&y.points_correct&&(F=y.total_questions*y.points_correct)}if(!(y!=null&&y.rule_id)&&B&&B.length>0){const w=Math.max(...B.map(P=>P.total_questions||0));if(w>0){const P=(y==null?void 0:y.points_correct)||1;F=w*P}}if(F===0&&(F=100),G)console.error(G);else if(B){const{data:w}=await q.from("concorso_leaderboard").select("score, volume_factor, accuracy_weighted, recency_score, coverage_score, reliability").eq("user_id",m.id).eq("quiz_id",t).maybeSingle();pe(B,F,w)}U&&E(U)}catch(C){console.error("Error loading stats:",C)}finally{n(!1)}},pe=(m,C,$)=>{i(m);const S=m.length,y=m.reduce((j,T)=>j+(T.score||0),0),B=m.reduce((j,T)=>Math.max(j,T.score||0),0);let G=0;const U=m.reduce((j,T)=>T.total_questions?(G++,j+(T.correct||0)/T.total_questions):j,0),F=S?y/S:0,w=G?U/G*100:0;if(z({totalTests:S,avgScore:F,avgAccuracy:w,bestScore:B,maxPossibleScore:C}),S>=3){const j=we(m,7);s(j.scoreTrend),c(j.accuracyTrend)}if(S>=1){const j=Ce(F,w,S,$);M(j)}const P=Se(m);_(P);const fe=P.map(j=>({subject:j.subjectName,accuracy:j.accuracy,total:j.totalQuestions}));ce(fe);const ve=ze(m,P,t||"");R(ve);const je=[...m].reverse().map(j=>{const T=j.total_questions>0?j.correct/j.total_questions*100:0;return{id:j.id,date:new Date(j.created_at).toLocaleDateString(),fullDate:new Date(j.created_at),score:j.score||0,accuracy:T}});xe(je)},re=()=>{L(!0)},he=async m=>{const{data:{user:C}}=await q.auth.getUser();if(!C)return;const{data:$,error:S}=await q.from("test_goals").insert({user_id:C.id,quiz_id:t,goal_type:m.goal_type,target_value:m.target_value,deadline:m.deadline,status:"active"}).select().single();!S&&$&&(E($),L(!1))},ge=async m=>{const{error:C}=await q.from("test_goals").delete().eq("id",m);C||E(null)};return h?e.jsx(ke,{message:"Analisi performance in corso..."}):e.jsxs("div",{className:"min-h-screen bg-[var(--background)] text-text-primary pb-24 relative overflow-hidden transition-colors duration-300",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 px-4 md:px-8 pt-safe",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 py-4",children:[e.jsx("button",{onClick:()=>u("/profile"),className:"p-3 bg-white dark:bg-slate-800/50 rounded-full shadow-soft hover:shadow-card hover:scale-105 transition-all text-slate-400 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white border border-transparent hover:border-slate-100 dark:hover:border-slate-700",children:e.jsx(Be,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h1",{className:"text-xl font-black text-text-primary leading-tight line-clamp-1",children:ue}),e.jsx("p",{className:"text-[10px] font-bold text-text-tertiary uppercase tracking-wider mt-0.5",children:"Statistiche Dettagliate"})]}),e.jsx("div",{className:"w-12"})," "]}),e.jsx(Re,{totalTests:f.totalTests,bestScore:f.bestScore,avgScore:f.avgScore,accuracy:f.avgAccuracy,maxPossibleScore:f.maxPossibleScore,scoreTrend:o,accuracyTrend:b,readiness:v,onOpenInfo:()=>a(!0)}),k.length>0&&e.jsx(We,{recommendations:k,onSetGoal:re}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-5 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[var(--card)] p-6 rounded-card shadow-soft flex flex-col items-center",children:[e.jsx("h3",{className:"text-lg font-bold text-text-primary mb-6 w-full",children:"Performance per Materia"}),e.jsx(Le,{data:O}),e.jsxs("div",{className:"mt-8 w-full",children:[e.jsx("h4",{className:"text-[10px] font-bold text-text-tertiary uppercase tracking-widest mb-3",children:"Dettaglio Materie"}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto pr-2 scrollbar-thin",children:O.map((m,C)=>{const $=m.accuracy>=70?"good":m.accuracy>=50?"warning":"critical",S=$==="good"?"bg-semantic-success":$==="warning"?"bg-brand-orange":"bg-semantic-error",y=N[C];return e.jsxs("button",{onClick:()=>y&&l(y),className:"w-full flex justify-between items-center text-sm border-b border-canvas-light dark:border-slate-800 pb-2 group cursor-pointer hover:bg-canvas-light/50 dark:hover:bg-slate-800/50 -mx-2 px-2 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${S}`}),e.jsx("span",{className:"font-bold text-text-secondary dark:text-slate-400 truncate max-w-[120px]",title:m.subject,children:m.subject})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-text-tertiary",children:["(",m.total,")"]}),e.jsxs("span",{className:`font-black ${m.accuracy>70?"text-semantic-success":m.accuracy>50?"text-brand-orange":"text-semantic-error"}`,children:[m.accuracy.toFixed(0),"%"]})]})]},m.subject)})})]})]}),e.jsx(Ve,{goal:H,onCreateGoal:re,onDeleteGoal:ge})]}),e.jsxs("div",{className:"lg:col-span-7 space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-[var(--card)] p-6 rounded-card shadow-soft",children:[e.jsx("h3",{className:"text-lg font-bold text-text-primary mb-4",children:"Andamento nel Tempo"}),e.jsx(Ee,{data:de})]}),e.jsxs("div",{className:"bg-white dark:bg-[var(--card)] p-6 rounded-card shadow-soft",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-text-primary",children:"Cronologia Tentativi"}),e.jsx("span",{className:"text-[10px] font-bold bg-canvas-light dark:bg-slate-800 text-text-tertiary px-3 py-1.5 rounded-pill uppercase tracking-wider",children:"Ultimi 50"})]}),e.jsx(Ge,{attempts:d,quizId:t})]})]})]})]}),e.jsx(Ue,{subject:V,quizId:t||"",onClose:()=>l(null)}),e.jsx(Xe,{isOpen:A,quizId:t||"",onClose:()=>L(!1),onSubmit:he})]})}export{lt as default};
