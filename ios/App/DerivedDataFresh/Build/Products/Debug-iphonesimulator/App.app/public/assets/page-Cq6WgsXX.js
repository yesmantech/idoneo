import{j as e,A as B,m as k}from"./framer-CcO5Kjcw.js";import{u as S,r as d,R as D}from"./router-ClfHAwMg.js";import{l as $,u as F,s as b,a as A}from"./index-Z19V86or.js";import{T as I}from"./TierSLoader-CVYPZXYz.js";import{a0 as L,aF as M,r as T,m as C,Z as y,F as U,X as w,j as O,as as H,at as X,a7 as G,G as Q,V as q,e as V,a as W,w as Z,aN as J,Q as R,aO as K,q as Y,aD as ee,aP as ae,y as te,aQ as se,S as re,aJ as le,b as ie,aR as ne,x as E,h as oe,k as P,aS as ce,ap as de}from"./icons-Dvxa2Qho.js";import{b as _}from"./badgeService-_zsnpv-k.js";import{u as me,R as xe}from"./ReferralModal-BEU2Q4bo.js";import{S as ue}from"./SEOHead-B7u-rzTH.js";import{x as he}from"./xpService-BVUCU30F.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";function pe({user:a,profile:t,xp:r=0}){const c=S(),[l,m]=d.useState(null),o=(t==null?void 0:t.nickname)||"Utente",i=t==null?void 0:t.avatar_url,n={xp:{title:"XP Totali",description:"Punti esperienza accumulati rispondendo alle domande. PiÃ¹ XP hai, piÃ¹ sali nelle classifiche globali!",icon:e.jsx(C,{className:"w-5 h-5 text-amber-500",fill:"currentColor"}),color:"bg-amber-50 text-amber-500"},score:{title:"Energia",description:"L'energia necessaria per affrontare i quiz. Come utente Premium, la tua energia Ã¨ infinita!",icon:e.jsx(y,{className:"w-5 h-5 text-emerald-500",fill:"currentColor"}),color:"bg-emerald-50 text-emerald-500"}},p=x=>{x.preventDefault(),x.stopPropagation(),navigator.share?navigator.share({title:"Idoneo",text:"Mettiti alla prova con i quiz di Idoneo!",url:window.location.origin}).catch(console.error):alert("Condivisione in arrivo!")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full bg-[var(--card)] rounded-[32px] shadow-sm border border-[var(--card-border)] overflow-hidden transition-colors duration-300",children:[e.jsxs("div",{className:"relative px-6 pt-6 pb-5 flex flex-col items-center",children:[e.jsx("div",{className:"absolute top-5 left-5",children:e.jsx("button",{onClick:p,className:"w-9 h-9 rounded-full bg-slate-100/80 dark:bg-slate-700/80 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-all flex items-center justify-center backdrop-blur-sm",children:e.jsx(L,{className:"w-4 h-4"})})}),e.jsxs("div",{className:"absolute top-5 right-5 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{Object.keys(localStorage).forEach(x=>{(x.startsWith("idoneo_onboarding_")||x==="idoneo_welcome_shown")&&localStorage.removeItem(x)}),window.location.href="/"},className:"w-9 h-9 rounded-full bg-slate-100/80 dark:bg-slate-700/80 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-all flex items-center justify-center backdrop-blur-sm group",title:"Ricomincia il Tour",children:e.jsx(M,{className:"w-4 h-4 group-hover:-rotate-180 transition-transform duration-500"})}),e.jsx("button",{onClick:()=>c("/profile/settings"),"data-onboarding":"profile-settings",className:"w-9 h-9 rounded-full bg-slate-100/80 dark:bg-slate-700/80 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-all flex items-center justify-center backdrop-blur-sm",children:e.jsx(T,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx("div",{className:"w-20 h-20 rounded-[20px] bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-600 shadow-inner relative overflow-hidden ring-[3px] ring-[var(--card)]",children:i?e.jsx("img",{src:i,alt:o,className:"w-full h-full object-cover"}):e.jsx("span",{className:"w-full h-full flex items-center justify-center text-4xl",children:"ðŸ‘¤"})}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 p-0.5 bg-[var(--card)] rounded-full",children:e.jsx("div",{className:"w-3.5 h-3.5 bg-emerald-500 rounded-full ring-2 ring-[var(--card)]"})})]}),e.jsx("h1",{className:"text-xl font-black text-[var(--foreground)] tracking-tight text-center",children:o}),e.jsx("p",{className:"text-[13px] text-[var(--foreground)] opacity-50 font-medium text-center truncate w-full px-8",children:a==null?void 0:a.email})]}),e.jsx("div",{className:"mx-4 mb-4 -mt-1",children:e.jsx("div",{className:"bg-gradient-to-br from-[var(--card)] via-slate-50 dark:via-slate-700 to-[var(--card)] rounded-2xl p-4 border border-[var(--card-border)] shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex flex-col items-center cursor-pointer active:scale-95 transition-transform",onClick:()=>m(n.xp),children:[e.jsx("div",{className:"w-11 h-11 rounded-2xl bg-gradient-to-br from-amber-100 to-amber-50 dark:from-amber-800/50 dark:to-amber-900/30 flex items-center justify-center mb-1.5 ring-1 ring-amber-200/50 dark:ring-amber-700/50",children:e.jsx(C,{className:"w-5 h-5 text-amber-500",fill:"currentColor"})}),e.jsx("span",{className:"text-xl font-black text-[var(--foreground)] tracking-tight",children:r}),e.jsx("span",{className:"text-[9px] font-bold text-amber-500 uppercase tracking-wider",children:"XP"})]}),e.jsx("div",{className:"w-px h-14 bg-gradient-to-b from-transparent via-slate-300 dark:via-slate-600 to-transparent"}),e.jsxs("div",{className:"flex-1 flex flex-col items-center cursor-pointer active:scale-95 transition-transform",onClick:()=>m(n.score),children:[e.jsx("div",{className:"w-11 h-11 rounded-2xl bg-gradient-to-br from-emerald-100 to-emerald-50 dark:from-emerald-800/50 dark:to-emerald-900/30 flex items-center justify-center mb-1.5 ring-1 ring-emerald-200/50 dark:ring-emerald-700/50 relative",children:e.jsx(y,{className:"w-5 h-5 text-emerald-500",fill:"currentColor"})}),e.jsx("span",{className:"text-2xl font-black text-[var(--foreground)] tracking-tight leading-none mb-1",children:"âˆž"}),e.jsx("span",{className:"text-[9px] font-bold text-emerald-500 uppercase tracking-wider",children:"Energia"})]}),e.jsx("div",{className:"w-px h-14 bg-gradient-to-b from-transparent via-slate-300 dark:via-slate-600 to-transparent"}),e.jsxs("div",{className:"flex-1 flex flex-col items-center cursor-pointer active:scale-95 transition-transform",onClick:x=>{x.preventDefault(),x.stopPropagation();const h=new CustomEvent("streak_updated",{detail:{streak:(t==null?void 0:t.streak_current)||1,isMilestone:!0}});window.dispatchEvent(h)},children:[e.jsx("div",{className:"w-11 h-11 rounded-2xl bg-gradient-to-br from-red-100 to-red-50 dark:from-red-800/50 dark:to-red-900/30 flex items-center justify-center mb-1.5 ring-1 ring-red-200/50 dark:ring-red-700/50",children:e.jsx(U,{className:"w-5 h-5 text-red-500",fill:"currentColor"})}),e.jsx("span",{className:"text-xl font-black text-[var(--foreground)] tracking-tight",children:(t==null?void 0:t.streak_current)||0}),e.jsx("span",{className:"text-[9px] font-bold text-red-500 uppercase tracking-wider",children:"Streak"})]})]})})})]}),e.jsx(B,{children:l&&e.jsxs("div",{className:"fixed inset-0 z-[110] flex items-center justify-center p-6",children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>m(null),className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md"}),e.jsxs(k.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},className:"relative bg-white dark:bg-slate-800 rounded-[32px] p-8 max-w-xs w-full shadow-2xl text-center overflow-y-auto max-h-[90vh] custom-scrollbar border border-slate-100 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>m(null),className:"absolute top-4 right-4 p-2 bg-slate-100 dark:bg-slate-700 rounded-full text-slate-400 dark:text-slate-300 hover:text-slate-600 dark:hover:text-white transition-colors",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsx("div",{className:`w-16 h-16 rounded-2xl ${l.color} flex items-center justify-center mx-auto mb-5`,children:D.cloneElement(l.icon,{className:"w-8 h-8"})}),e.jsx("h3",{className:"text-xl font-black text-slate-900 dark:text-white mb-2",children:l.title}),e.jsx("p",{className:"text-slate-500 dark:text-slate-300 text-[14px] font-medium leading-relaxed mb-6",children:l.description}),e.jsx("button",{onClick:()=>m(null),className:"w-full py-3.5 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-2xl font-bold hover:bg-slate-800 dark:hover:bg-slate-100 transition-colors text-[14px]",children:"Ho capito"})]})]})})]})}function ge({title:a,category:t,progress:r,onClick:c}){const m=(o=>{const i=(o||"").toLowerCase();return i.includes("sanitÃ ")||i.includes("infermier")||i.includes("medic")?H:i.includes("finanza")||i.includes("banca")||i.includes("econom")?X:i.includes("amministra")||i.includes("comun")||i.includes("regione")?G:i.includes("giustizia")||i.includes("magistrat")?Q:i.includes("scuola")||i.includes("docent")?q:i.includes("patente")||i.includes("guida")?V:W})(t||a);return e.jsxs("button",{onClick:c,className:"w-full bg-white dark:bg-[#1e2330] rounded-[24px] shadow-sm border border-slate-100 dark:border-slate-800 p-5 flex items-center gap-5 active:scale-[0.98] transition-all hover:shadow-md text-left group",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-[#E0F2FE] dark:bg-[#141820] flex-shrink-0 border border-transparent dark:border-sky-500/20",children:e.jsx(m,{className:"w-5 h-5 text-[#00B1FF] dark:text-sky-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex justify-between mb-2",children:e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white truncate pr-2 text-[15px]",children:a})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"flex-1 h-1.5 bg-slate-100 dark:bg-[#2a3040] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#00B1FF] rounded-full",style:{width:`${r}%`}})})})]}),e.jsx(O,{className:"w-5 h-5 text-slate-300 dark:text-slate-500 flex-shrink-0 group-hover:text-[#00B1FF] transition-colors"})]})}function fe({userId:a}){const t=S(),[r,c]=d.useState([]),[l,m]=d.useState(!0);return d.useEffect(()=>{async function o(){try{const i=await $.getUserActiveQuizzes(a);c(i)}catch(i){console.error(i)}finally{m(!1)}}a&&o()},[a]),l?e.jsx("div",{className:"py-8 text-center text-slate-400 animate-pulse",children:"Caricamento corsi..."}):r.length===0?e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-[var(--card)] rounded-[32px] border border-slate-100/60 dark:border-slate-800 mb-8 shadow-sm transition-colors",children:[e.jsx("div",{className:"text-4xl mb-4",children:"â˜ï¸"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-medium mb-8",children:"Non hai ancora iniziato nessun corso."}),e.jsx("button",{onClick:()=>t("/"),className:"text-white bg-[#00B1FF] px-8 py-3.5 rounded-2xl font-bold hover:shadow-lg hover:scale-105 transition-all",children:"Inizia ora!"})]}):e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsx("div",{className:"flex items-center justify-between px-1",children:e.jsx("h3",{className:"text-lg font-bold text-[var(--foreground)]",children:"La tua Dashboard"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(o=>e.jsx(ge,{quizId:o.id,title:o.title,category:o.category,progress:o.accuracy||0,onClick:()=>t(`/profile/stats/${o.id}`)},o.id))}),e.jsx("div",{className:"md:hidden",children:e.jsx("button",{onClick:()=>t("/"),className:"w-full py-4 rounded-[32px] border-2 border-dashed border-slate-200 dark:border-slate-700 text-slate-400 dark:text-slate-500 font-bold hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-600 dark:hover:text-slate-300 transition-colors",children:"+ Aggiungi corsi"})})]})}function z(){const{user:a,profile:t}=F(),[r,c]=d.useState([]),[l,m]=d.useState(null),[o,i]=d.useState(!0),[n,p]=d.useState(null),[x,h]=d.useState(!1),g=(t==null?void 0:t.role)==="admin";d.useEffect(()=>{a!=null&&a.id&&v()},[a==null?void 0:a.id]);const v=async()=>{if(!(a!=null&&a.id)){console.warn("BadgesBlock: No user ID found");return}i(!0),console.log("BadgesBlock: Fetching badges for",a.id);try{await _.checkAndAwardBadges(a.id),console.log("BadgesBlock: checkAndAwardBadges completed");const s=await _.getUserBadges(a.id);if(console.log("BadgesBlock: User ID:",a.id),console.log("BadgesBlock: Earned badges raw:",s),c(s),g){const{data:u}=await b.from("profiles").select("total_xp, current_streak, referral_count").eq("id",a.id).single();p(u)}}catch(s){console.error("BadgesBlock: Error fetching badges:",s)}finally{i(!1)}},f=[{id:"primo_passo",name:"Primo Passo",icon:e.jsx(Z,{className:"w-8 h-8"}),unlocked:r.includes("primo_passo"),description:"Benvenuto a bordo! Hai iniziato il tuo percorso verso il successo.",requirement:"Hai completato la tua prima simulazione su Idoneo.",color:"from-blue-400 to-cyan-400"},{id:"secchione",name:"Secchione",icon:e.jsx(q,{className:"w-8 h-8"}),unlocked:r.includes("secchione"),description:"La perfezione fatta persona. Non hai sbagliato neanche una virgola!",requirement:"Hai ottenuto il 100% in una simulazione ufficiale (min. 10 domande).",color:"from-amber-400 to-orange-500"},{id:"veterano",name:"Veterano",icon:e.jsx(J,{className:"w-8 h-8"}),unlocked:r.includes("veterano"),description:"La tua esperienza Ã¨ un esempio per tutti. Conosci i quiz a memoria!",requirement:"Rispondi correttamente a 1.000 quiz (Raggiungi 1.000 XP).",color:"from-slate-700 to-slate-900"},{id:"social",name:"Social-ONE",icon:e.jsx(R,{className:"w-8 h-8"}),unlocked:r.includes("social"),description:"Studiare in compagnia Ã¨ meglio! Sei un vero leader della community.",requirement:"Invita con successo 5 amici a iscriversi su Idoneo.",color:"from-pink-400 to-rose-500"},{id:"inarrestabile",name:"Inarrestabile",icon:e.jsx(y,{className:"w-8 h-8"}),unlocked:r.includes("inarrestabile"),description:"Niente puÃ² fermare la tua voglia di imparare. Sei un treno!",requirement:"Mantieni una streak di studio per 30 giorni consecutivi.",color:"from-yellow-400 to-amber-500"},{id:"cecchino",name:"Cecchino",icon:e.jsx(K,{className:"w-8 h-8"}),unlocked:r.includes("cecchino"),description:"Ogni colpo va a segno. La tua precisione Ã¨ chirurgica.",requirement:"Completa 10 simulazioni di fila con un'accuratezza superiore al 90%.",color:"from-red-500 to-maroon-700"},{id:"fulmine",name:"Fulmine",icon:e.jsx(y,{className:"w-8 h-8"}),unlocked:r.includes("fulmine"),description:"VelocitÃ  e precisione. Hai finito il test prima ancora di iniziarlo!",requirement:"Completa 5 simulazioni in meno della metÃ  del tempo con un punteggio > 80%.",color:"from-cyan-400 to-blue-600"},{id:"enciclopedia",name:"Enciclopedia",icon:e.jsx(Y,{className:"w-8 h-8"}),unlocked:r.includes("enciclopedia"),description:"La tua conoscenza non ha confini. Hai esplorato ogni angolo del sapere.",requirement:"Completa almeno un quiz in tutte le categorie disponibili.",color:"from-emerald-400 to-teal-600"},{id:"nottambulo",name:"Nottambulo",icon:e.jsx(ee,{className:"w-8 h-8"}),unlocked:r.includes("nottambulo"),description:"Il successo non dorme mai. Le tue ore piccole porteranno grandi risultati.",requirement:"Completa 5 simulazioni tra l'una e le cinque del mattino.",color:"from-indigo-600 to-purple-900"},{id:"hub_master",name:"Master Hub",icon:e.jsx(ae,{className:"w-8 h-8"}),unlocked:r.includes("hub_master"),description:"Sei il re del territorio. Nessun concorso ha segreti per te.",requirement:"Partecipa a simulazioni per 5 concorsi diversi.",color:"from-orange-500 to-red-600"},{id:"costanza",name:"Costanza",icon:e.jsx(te,{className:"w-8 h-8"}),unlocked:r.includes("costanza"),description:"Il segreto del successo Ã¨ la regolaritÃ . Continua cosÃ¬!",requirement:"Completa almeno una simulazione al giorno per 7 giorni di fila.",color:"from-slate-300 to-slate-500"},{id:"maratona",name:"Maratoneta",icon:e.jsx(C,{className:"w-8 h-8"}),unlocked:r.includes("maratona"),description:"Due settimane di dedizione! Sei sulla strada giusta per il successo.",requirement:"Mantieni una streak di studio per 14 giorni consecutivi.",color:"from-yellow-400 to-amber-500"},{id:"diamante",name:"Diamante",icon:e.jsx(se,{className:"w-8 h-8"}),unlocked:r.includes("diamante"),description:"Due mesi di costanza! Sei un vero campione di dedizione.",requirement:"Mantieni una streak di studio per 60 giorni consecutivi.",color:"from-blue-400 to-indigo-600"},{id:"immortale",name:"Immortale",icon:e.jsx(re,{className:"w-8 h-8"}),unlocked:r.includes("immortale"),description:"Leggendario! 100 giorni di studio senza sosta. Sei imbattibile.",requirement:"Mantieni una streak di studio per 100 giorni consecutivi.",color:"from-pink-400 via-purple-500 to-cyan-400"},{id:"leggenda",name:"Leggenda",icon:e.jsx(le,{className:"w-8 h-8"}),unlocked:r.includes("leggenda"),description:"Sei tra i migliori aspiranti d'Italia. Continua a scalare la vetta!",requirement:"Raggiungi la Top 10 nella classifica globale (Gold League).",color:"from-purple-400 to-indigo-600"}];return o&&!f.length?null:e.jsxs("div",{className:"mb-10 mt-6 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-amber-500"}),e.jsx("h3",{className:"text-xl font-black text-slate-900 tracking-tight",children:"I tuoi Badge"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g&&e.jsx("button",{onClick:()=>h(!x),className:"text-[10px] font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded-full hover:bg-slate-200 transition-colors",children:"DEBUG"}),e.jsxs("span",{className:"text-xs font-bold text-brand-blue bg-brand-blue/10 px-2 py-1 rounded-full",children:[be(f)," / ",f.length]})]})]}),x&&n&&e.jsxs("div",{className:"mx-2 mb-4 p-4 bg-slate-900 rounded-3xl text-white text-[11px] font-mono leading-relaxed shadow-xl border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-emerald-400 font-bold uppercase tracking-widest text-[9px]",children:"Admin Debug Mode"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>v(),className:"text-blue-400 hover:text-blue-300",children:"REFRESH"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-1",children:[e.jsx("div",{className:"text-slate-400 text-[10px] uppercase",children:"Total XP:"}),e.jsx("div",{className:"text-right font-bold text-brand-green",children:n.total_xp||0}),e.jsx("div",{className:"text-slate-400 text-[10px] uppercase",children:"Streak:"}),e.jsxs("div",{className:"text-right font-bold text-orange-400",children:[n.current_streak||0," giorni"]}),e.jsx("div",{className:"text-slate-400 text-[10px] uppercase",children:"Referrals:"}),e.jsx("div",{className:"text-right font-bold text-pink-400",children:n.referral_count||0}),e.jsx("div",{className:"text-slate-400 text-[10px] uppercase",children:"Badge Count:"}),e.jsx("div",{className:"text-right font-bold text-cyan-400",children:r.length})]}),e.jsxs("div",{className:"mt-3 pt-2 border-t border-white/10 text-[9px] text-slate-500 overflow-x-auto whitespace-nowrap",children:["Earned: ",r.join(", ")]})]}),e.jsx("div",{className:"flex gap-5 overflow-x-auto pb-6 scrollbar-hide snap-x px-2 pt-2",children:f.map(s=>e.jsxs(k.div,{whileTap:{scale:.95},onClick:()=>m(s),className:"flex-none snap-start w-24 flex flex-col items-center gap-3 cursor-pointer",children:[e.jsxs("div",{className:`relative w-20 h-20 flex items-center justify-center rounded-[24px] transition-all duration-300 shadow-sm
                            ${s.unlocked?`bg-gradient-to-br ${s.color} text-white shadow-lg shadow-black/5`:"bg-slate-100/80 text-slate-400 grayscale border border-slate-100"}`,children:[s.unlocked&&e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-[24px] pointer-events-none opacity-50",style:{clipPath:"polygon(0 0, 100% 0, 0 100%)"}}),!s.unlocked&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-white rounded-full p-1 shadow-sm border border-slate-50",children:e.jsx("div",{className:"w-4 h-4 bg-slate-200 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-2.5 h-2.5 text-slate-400",strokeWidth:4})})}),e.jsx("div",{className:"z-10 relative drop-shadow-sm",children:s.icon})]}),e.jsx("span",{className:`text-[10px] font-black text-center leading-tight uppercase tracking-wide
                            ${s.unlocked?"text-slate-800":"text-slate-400"}`,children:s.name})]},s.id))}),e.jsx(B,{children:l&&e.jsxs("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-6",children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>m(null),className:"absolute inset-0 bg-slate-900/60 backdrop-blur-md"}),e.jsxs(k.div,{initial:{scale:.9,opacity:0,y:30},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:30},transition:{type:"spring",damping:25,stiffness:300},className:"relative bg-white rounded-[40px] p-8 max-w-sm w-full shadow-2xl text-center overflow-hidden",children:[e.jsx("div",{className:`absolute -top-20 -right-20 w-40 h-40 bg-gradient-to-br ${l.color} opacity-10 rounded-full blur-3xl`}),e.jsx("div",{className:`absolute -bottom-20 -left-20 w-40 h-40 bg-gradient-to-br ${l.color} opacity-10 rounded-full blur-3xl`}),e.jsx("button",{onClick:()=>m(null),className:"absolute top-6 right-6 p-2 bg-slate-100 hover:bg-slate-200 rounded-full text-slate-400 hover:text-slate-600 transition-colors z-20",children:e.jsx(w,{className:"w-4 h-4"})}),e.jsxs("div",{className:`w-28 h-28 rounded-[32px] bg-gradient-to-br ${l.unlocked?l.color:"from-slate-100 to-slate-200"}
                                flex items-center justify-center mx-auto mb-8 shadow-2xl relative group`,children:[l.unlocked&&e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-[32px] pointer-events-none",style:{clipPath:"polygon(0 0, 100% 0, 0 100%)"}}),e.jsx("div",{className:`${l.unlocked?"text-white":"text-slate-400"} drop-shadow-md scale-125`,children:l.icon})]}),e.jsx("h3",{className:"text-2xl font-black text-slate-900 mb-3 uppercase tracking-tight",children:l.name}),e.jsxs("p",{className:"text-slate-600 text-sm font-bold leading-relaxed mb-6 px-4",children:['"',l.description,'"']}),e.jsxs("div",{className:`p-5 rounded-3xl text-left border mb-8
                                ${l.unlocked?"bg-emerald-50 border-emerald-100/50":"bg-slate-50 border-slate-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center
                                        ${l.unlocked?"bg-emerald-500":"bg-slate-300"}`,children:e.jsx(ne,{className:"w-3 h-3 text-white"})}),e.jsx("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:l.unlocked?"Badge Ottenuto":"Come sbloccare"})]}),e.jsx("p",{className:`text-[13px] font-black leading-snug
                                    ${l.unlocked?"text-emerald-700":"text-slate-600"}`,children:l.requirement})]}),e.jsx("button",{onClick:()=>m(null),className:`w-full py-4 rounded-2xl font-black text-white shadow-lg transition-transform active:scale-95
                                    ${l.unlocked?`bg-gradient-to-r ${l.color} shadow-black/10`:"bg-slate-900 shadow-black/10"}`,children:l.unlocked?"Condividi Traguardo":"Ho capito"})]})]})})]})}function be(a){return a.filter(t=>t.unlocked).length}const N={async searchUsers(a,t){if(!a||a.length<3)return[];const{data:r,error:c}=await b.from("profiles").select("id, nickname, avatar_url, created_at").ilike("nickname",`%${a}%`).neq("id",t).limit(10);return c?(console.error("Search error:",c),[]):r||[]},async sendRequest(a,t){const{data:r}=await b.from("friendships").select("*").or(`and(user_id.eq.${a},friend_id.eq.${t}),and(user_id.eq.${t},friend_id.eq.${a})`).single();if(r)return r.status==="rejected"?{error:"Request previously rejected."}:{error:"Friendship already exists or is pending."};const{error:c}=await b.from("friendships").insert({user_id:a,friend_id:t,status:"pending"});return{error:c}},async acceptRequest(a){const{error:t}=await b.from("friendships").update({status:"accepted"}).eq("id",a);return{error:t}},async removeFriendship(a){const{error:t}=await b.from("friendships").delete().eq("id",a);return{error:t}},async getFriendsAndRequests(a){const{data:t}=await b.from("profiles").select("id, nickname, avatar_url, created_at").eq("referred_by",a).order("created_at",{ascending:!1}),r=(t||[]).map(n=>({...n,status:"referral"})),{data:c}=await b.from("friendships").select(`
                id,
                status,
                user_id,
                friend_id,
                created_at,
                sender:profiles!user_id(id, nickname, avatar_url),
                receiver:profiles!friend_id(id, nickname, avatar_url)
            `).or(`user_id.eq.${a},friend_id.eq.${a}`),l=[],m=[],o=[];c==null||c.forEach(n=>{const p=n.user_id===a,x=p?n.receiver:n.sender;if(!x)return;const h={id:x.id,nickname:x.nickname,avatar_url:x.avatar_url,created_at:n.created_at,friendship_id:n.id,status:n.status,is_requester:p};n.status==="accepted"?l.push(h):n.status==="pending"&&(p?o.push(h):m.push(h))});const i=new Map;return r.forEach(n=>i.set(n.id,n)),l.forEach(n=>i.set(n.id,n)),{friends:Array.from(i.values()),pendingReceived:m,pendingSent:o}}};function ve({isOpen:a,onClose:t,currentUserId:r,onRequestSent:c}){const[l,m]=d.useState(""),[o,i]=d.useState([]),[n,p]=d.useState(!1),[x,h]=d.useState(!1),[g,v]=d.useState(new Set);if(!a)return null;const f=async u=>{if(u.preventDefault(),!(l.length<3)){h(!0);try{const j=await N.searchUsers(l,r);i(j)}catch(j){console.error(j)}finally{h(!1)}}},s=async u=>{v(j=>new Set(j).add(u)),await N.sendRequest(r,u),c()};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-in fade-in duration-200",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:t}),e.jsxs("div",{className:"relative bg-white w-full max-w-md rounded-3xl shadow-2xl p-6 overflow-hidden animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Aggiungi Amico"}),e.jsx("button",{onClick:t,className:"p-2 bg-slate-100 rounded-full hover:bg-slate-200 transition-colors",children:e.jsx(w,{className:"w-5 h-5 text-slate-500"})})]}),e.jsx("form",{onSubmit:f,className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Cerca per nickname...",value:l,onChange:u=>m(u.target.value),className:"w-full pl-12 pr-4 py-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#00B1FF]/50 transition-all font-medium placeholder:text-slate-400",autoFocus:!0}),e.jsx(E,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"})]})}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-3 min-h-[100px]",children:x?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-slate-400",children:[e.jsx(oe,{className:"w-6 h-6 animate-spin mb-2"}),e.jsx("p",{className:"text-sm",children:"Ricerca in corso..."})]}):o.length>0?o.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl hover:bg-slate-50 transition-colors border border-transparent hover:border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-200 overflow-hidden flex-shrink-0",children:u.avatar_url?e.jsx("img",{src:u.avatar_url,alt:u.nickname,className:"w-full h-full object-cover"}):e.jsx("span",{className:"w-full h-full flex items-center justify-center text-lg",children:"ðŸ‘¤"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900",children:u.nickname}),e.jsx("p",{className:"text-xs text-slate-400",children:"Utente Idoneo"})]})]}),g.has(u.id)?e.jsxs("span",{className:"px-3 py-1.5 bg-emerald-100 text-emerald-600 rounded-lg text-xs font-bold flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"})," Inviata"]}):e.jsx("button",{onClick:()=>s(u.id),className:"p-2 bg-[#00B1FF] rounded-lg text-white shadow-md shadow-blue-500/20 active:scale-95 transition-all",children:e.jsx(ce,{className:"w-4 h-4"})})]},u.id)):l.length>=3?e.jsx("div",{className:"text-center py-8 text-slate-400",children:e.jsx("p",{children:"Nessun utente trovato con questo nome."})}):e.jsx("div",{className:"text-center py-8 text-slate-400",children:e.jsx("p",{children:"Scrivi almeno 3 caratteri per cercare."})})})]})]})}function je({userId:a}){const[t,r]=d.useState([]),[c,l]=d.useState([]),[m,o]=d.useState(!0);me();const[i,n]=d.useState(!1),[p,x]=d.useState(!1),h=()=>{n(!0)},g=async()=>{if(a)try{const{friends:s,pendingReceived:u}=await N.getFriendsAndRequests(a);r(s),l(u)}catch(s){console.error("Error fetching friends:",s)}finally{o(!1)}};d.useEffect(()=>{g()},[a]);const v=async s=>{s&&(await N.acceptRequest(s),g())},f=async s=>{s&&(await N.removeFriendship(s),g())};return e.jsxs("div",{className:"bg-white dark:bg-[var(--card)] rounded-3xl p-6 shadow-sm border border-slate-100 dark:border-slate-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-[var(--foreground)]",children:"I tuoi Amici"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>x(!0),className:"p-2 rounded-full bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",title:"Cerca amici",children:e.jsx(E,{className:"w-4 h-4"})}),t.length>0&&e.jsx("button",{onClick:h,className:"text-sm font-bold text-[#00B1FF] hover:text-[#0099e6] transition-colors",children:"Invita"})]})]}),c.length>0&&e.jsxs("div",{className:"mb-6 bg-amber-50 dark:bg-amber-900/10 rounded-2xl p-4 border border-amber-100 dark:border-amber-900/20",children:[e.jsx("h4",{className:"text-xs font-bold text-amber-600 dark:text-amber-500 uppercase tracking-wider mb-3",children:"Richieste in attesa"}),e.jsx("div",{className:"space-y-3",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-slate-800 p-3 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 overflow-hidden",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,className:"w-full h-full object-cover"}):e.jsx("span",{className:"flex items-center justify-center w-full h-full",children:"ðŸ‘¤"})}),e.jsx("span",{className:"text-sm font-bold text-slate-900 dark:text-slate-100",children:s.nickname})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>v(s.friendship_id),className:"p-1.5 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 rounded-lg hover:bg-emerald-200 dark:hover:bg-emerald-900/50",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>f(s.friendship_id),className:"p-1.5 bg-red-100 dark:bg-red-900/30 text-red-500 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50",children:e.jsx(w,{className:"w-4 h-4"})})]})]},s.id))})]}),m?e.jsx("div",{className:"space-y-3",children:[1,2].map(s=>e.jsxs("div",{className:"flex gap-4 items-center animate-pulse",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-100 dark:bg-slate-800 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-slate-100 dark:bg-slate-800 rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-slate-100 dark:bg-slate-800 rounded w-1/4"})]})]},s))}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-dashed border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[#E0F2FE] dark:bg-blue-900/20 flex items-center justify-center mb-3",children:e.jsx(R,{className:"w-7 h-7 text-[#00B1FF]"})}),e.jsxs("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-4 px-4",children:["Non hai ancora amici. ",e.jsx("br",{}),"Cerca per nickname o invitali!"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>x(!0),className:"px-5 py-2.5 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700 font-bold rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition-all text-sm",children:"Cerca"}),e.jsxs("button",{onClick:h,className:"px-5 py-2.5 bg-[#00B1FF] hover:bg-[#0099e6] active:scale-[0.98] text-white font-bold rounded-xl shadow-lg shadow-blue-500/20 flex items-center gap-2 transition-all text-sm",children:[e.jsx(de,{className:"w-4 h-4"}),"Invita"]})]})]}):e.jsx("div",{className:"space-y-4 max-h-[400px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-slate-200 dark:scrollbar-thumb-slate-700 scrollbar-track-transparent",children:t.map(s=>e.jsxs("div",{className:"flex gap-4 items-center group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex-shrink-0 flex items-center justify-center overflow-hidden border border-slate-100 dark:border-slate-700",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.nickname,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-lg",children:"ðŸ‘¤"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-bold text-slate-900 dark:text-slate-100 leading-tight truncate",children:s.nickname||"Utente"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[s.status==="referral"&&e.jsx("span",{className:"text-[10px] font-bold bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 px-1.5 py-0.5 rounded",children:"INVITATO"}),e.jsxs("p",{className:"text-xs text-slate-400 dark:text-slate-500",children:["Iscritto il ",new Date(s.created_at).toLocaleDateString()]})]})]})]},s.id))}),e.jsx(xe,{isOpen:i,onClose:()=>n(!1)}),e.jsx(ve,{isOpen:p,onClose:()=>x(!1),currentUserId:a,onRequestSent:g})]})}const ke=()=>null;function Ee(){const{user:a,profile:t,loading:r}=F(),c=S(),[l,m]=d.useState(0),{startOnboarding:o,hasCompletedContext:i}=A();return d.useEffect(()=>{if(!r&&!a){c("/login");return}async function n(){if(!a)return;const p=await he.getUserXp(a.id);m(p.totalXp)}n()},[a,r,c]),d.useEffect(()=>{if(!r&&t&&!i("profile")){const n=setTimeout(()=>o("profile"),500);return()=>clearTimeout(n)}},[r,t,i,o]),r||!t?e.jsx(I,{message:"Caricamento profilo..."}):e.jsxs("div",{className:"min-h-screen bg-[var(--background)] pb-24 relative overflow-hidden transition-colors duration-300",children:[e.jsx(ue,{title:`${t.nickname||"Il mio Profilo"} | Idoneo`,description:"Gestisci la tua preparazione, guarda le tue statistiche e sfida i tuoi amici su Idoneo.",url:"/profile"}),e.jsx(ke,{}),e.jsx("div",{className:"pt-safe"}),e.jsx("div",{className:"max-w-6xl mx-auto relative px-4 lg:px-6",children:e.jsxs("div",{className:"lg:grid lg:grid-cols-[360px_1fr] lg:gap-10",children:[e.jsxs("div",{className:"lg:sticky lg:top-8 lg:self-start space-y-6",children:[e.jsx("div",{"data-onboarding":"stats",children:e.jsx(pe,{user:a,profile:t,xp:l})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(z,{})})]}),e.jsxs("div",{className:"space-y-6 mt-6 lg:mt-0",children:[e.jsx(fe,{userId:(a==null?void 0:a.id)||""}),e.jsx(je,{userId:(a==null?void 0:a.id)||""}),e.jsx("div",{className:"lg:hidden",children:e.jsx(z,{})})]})]})})]})}export{Ee as default};
