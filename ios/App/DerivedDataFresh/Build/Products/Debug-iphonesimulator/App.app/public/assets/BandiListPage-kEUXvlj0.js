import{j as e,m as g,A as E}from"./framer-CcO5Kjcw.js";import{r as o,c as _,L as B}from"./router-ClfHAwMg.js";import{b as G,I as H,E as V,C as U,c as L,d as Y,a as K,s as Q,u as W}from"./bandiService-CPkRW1ZN.js";import{B as R,a as A}from"./BandiEmptyState-DYesJ7Na.js";import{x as X,M as z,ax as P,W as q,k as M,X as J,a7 as Z,V as ee,B as te,Y as ae,a2 as se,j as le}from"./icons-Dvxa2Qho.js";import{a as re}from"./BandoSkeleton-DvN1ofUN.js";import{u as ie}from"./index-BcNl-kiB.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";function ne({filters:t,onFiltersChange:i,totalResults:l}){var v,N,j,h;const[d,r]=o.useState(!1),[p,u]=o.useState([]),[a,n]=o.useState(t.search||""),[m,b]=o.useState(t.province||"");o.useEffect(()=>{G().then(u)},[]),o.useEffect(()=>{const c=setTimeout(()=>{(a!==t.search||m!==t.province)&&i({...t,search:a||void 0,province:m||void 0,offset:0})},400);return()=>clearTimeout(c)},[a,m]);const f=[(v=t.categories)==null?void 0:v.length,(N=t.regions)==null?void 0:N.length,t.status!=="all"?1:0,(j=t.educationLevel)==null?void 0:j.length,(h=t.contractType)==null?void 0:h.length,t.isRemote?1:0,t.minSeats,t.salaryMin].reduce((c,k)=>(c||0)+(k||0),0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:c=>{c.preventDefault(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),i({...t,search:a||void 0,province:m||void 0,offset:0})},className:"bg-white dark:bg-slate-900 rounded-2xl shadow-lg shadow-slate-200/50 dark:shadow-black/50 border border-slate-200 dark:border-slate-800 p-2 flex flex-col md:flex-row gap-2 relative z-20",children:[e.jsxs("div",{className:"flex-1 relative group",children:[e.jsx("button",{type:"submit",className:"absolute left-3 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400 group-focus-within:text-brand-blue group-focus-within:bg-brand-blue/10 dark:group-focus-within:bg-brand-blue/20 transition-all hover:bg-brand-blue hover:text-white",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("input",{type:"text",value:a,onChange:c=>n(c.target.value),placeholder:"Cosa cerchi? (es. Amministrativo)",className:"w-full pl-14 pr-4 py-3 bg-transparent border-0 focus:ring-0 text-slate-900 dark:text-white placeholder:text-slate-400 font-medium"})]}),e.jsx("div",{className:"hidden md:block w-px bg-slate-200 dark:bg-slate-700 my-2"}),e.jsxs("div",{className:"flex-1 relative group md:max-w-[30%]",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400 group-focus-within:text-brand-blue group-focus-within:bg-brand-blue/10 dark:group-focus-within:bg-brand-blue/20 transition-all",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("input",{type:"text",value:m,onChange:c=>b(c.target.value),placeholder:"Dove? (CittÃ  o Provincia)",className:"w-full pl-14 pr-4 py-3 bg-transparent border-0 focus:ring-0 text-slate-900 dark:text-white placeholder:text-slate-400 font-medium"})]}),e.jsxs(g.button,{type:"button",whileTap:{scale:.98},onClick:()=>r(!0),className:`
                        md:w-auto w-full px-6 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all
                        ${f>0?"bg-brand-blue text-white shadow-brand-blue/30 shadow-lg":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 hover:bg-slate-200 dark:hover:bg-slate-700"}
                    `,children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Filtri"}),f>0&&e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs",children:f})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-500 dark:text-slate-400",children:l!==void 0?`${l} risultati`:"Caricamento..."}),e.jsx(oe,{value:t.sortBy||"deadline",onChange:c=>i({...t,sortBy:c,offset:0})})]}),e.jsx(E,{children:d&&e.jsx(de,{filters:t,categories:p,onFiltersChange:i,onClose:()=>r(!1)})})]})}function oe({value:t,onChange:i}){const[l,d]=o.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>d(!l),className:"flex items-center gap-1.5 text-sm font-medium text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors",children:["Ordina per: ",e.jsxs("span",{className:"text-slate-900 dark:text-white",children:[t==="deadline"&&"Scadenza",t==="newest"&&"PiÃ¹ recenti",t==="seats"&&"Numero posti",t==="relevance"&&"Rilevanza"]}),e.jsx(q,{className:`w-4 h-4 transition-transform ${l?"rotate-180":""}`})]}),e.jsx(E,{children:l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>d(!1)}),e.jsx(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"absolute right-0 top-full mt-2 w-48 bg-white dark:bg-slate-900 rounded-xl shadow-xl border border-slate-200 dark:border-slate-800 overflow-hidden z-50 origin-top-right",children:[{val:"deadline",label:"In scadenza"},{val:"newest",label:"PiÃ¹ recenti"},{val:"seats",label:"PiÃ¹ posti"}].map(r=>e.jsxs("button",{onClick:()=>{i(r.val),d(!1)},className:`w-full text-left px-4 py-3 text-sm flex items-center justify-between ${t===r.val?"bg-slate-50 dark:bg-slate-800 text-emerald-500 font-medium":"text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[r.label,t===r.val&&e.jsx(M,{className:"w-4 h-4"})]},r.val))})]})})]})}function de({filters:t,categories:i,onFiltersChange:l,onClose:d}){const[r,p]=o.useState(t),u=(a,n)=>{const m=r[a]||[],b=m.includes(n)?m.filter(f=>f!==n):[...m,n];p({...r,[a]:b.length?b:void 0})};return _.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex flex-col md:flex-row",children:[e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:d,className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs(g.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"relative ml-auto w-full md:w-[500px] h-full bg-white dark:bg-slate-950 shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 pt-[max(1.5rem,env(safe-area-inset-top))] border-b border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Filtri Avanzati"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Affina la tua ricerca"})]}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full",children:e.jsx(J,{className:"w-6 h-6 text-slate-400"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 pb-8 space-y-8",children:[e.jsx(w,{title:"Categoria",icon:e.jsx(Z,{className:"w-4 h-4"}),children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(a=>{var n;return e.jsx(T,{label:a.name,icon:a.icon,checked:(n=r.categories)==null?void 0:n.includes(a.id),onChange:()=>u("categories",a.id)},a.id)})})}),e.jsx(w,{title:"Regione",icon:e.jsx(z,{className:"w-4 h-4"}),children:e.jsx("div",{className:"flex flex-wrap gap-2",children:H.map(a=>{var n;return e.jsx(ce,{label:a,active:(n=r.regions)==null?void 0:n.includes(a),onClick:()=>u("regions",a)},a)})})}),e.jsx(w,{title:"Titolo di Studio",icon:e.jsx(ee,{className:"w-4 h-4"}),children:e.jsx("div",{className:"space-y-2",children:V.map(a=>{var n;return e.jsx(T,{label:a.label,checked:(n=r.educationLevel)==null?void 0:n.includes(a.value),onChange:()=>u("educationLevel",a.value)},a.value)})})}),e.jsx(w,{title:"Contratto",icon:e.jsx(te,{className:"w-4 h-4"}),children:e.jsx("div",{className:"space-y-2",children:U.map(a=>{var n;return e.jsx(T,{label:a.label,checked:(n=r.contractType)==null?void 0:n.includes(a.value),onChange:()=>u("contractType",a.value)},a.value)})})}),e.jsx(w,{title:"Altre opzioni",icon:e.jsx(P,{className:"w-4 h-4"}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(xe,{label:"Lavoro da remoto / Smart working",icon:e.jsx(ae,{className:"w-4 h-4 text-emerald-500"}),checked:!!r.isRemote,onChange:()=>p({...r,isRemote:r.isRemote?void 0:!0})}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 block mb-2",children:["Numero posti minimo: ",r.minSeats||0]}),e.jsx("input",{type:"range",min:"0",max:"100",step:"1",value:r.minSeats||0,onChange:a=>p({...r,minSeats:parseInt(a.target.value)||void 0}),className:"w-full accent-emerald-500 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer"})]})]})})]}),e.jsx("div",{className:"p-6 pb-28 border-t border-slate-100 dark:border-slate-800 safe-area-bottom bg-white/50 dark:bg-slate-900/50 backdrop-blur-md",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>{l({sortBy:"deadline",limit:20,offset:0}),d()},className:"flex-1 py-3 text-slate-500 font-medium hover:text-slate-900 dark:hover:text-white transition-colors",children:"Reset"}),e.jsx("button",{onClick:()=>{l({...r,offset:0}),d()},className:"flex-[2] py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-bold rounded-2xl shadow-lg shadow-emerald-500/20 active:scale-[0.98] transition-all",children:"Applica Filtri"})]})})]})]}),document.body)}function w({title:t,icon:i,children:l}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[i,e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:t})]}),l]})}function ce({label:t,active:i,onClick:l}){return e.jsx("button",{onClick:l,className:`px-4 py-2 rounded-xl text-sm font-medium transition-all ${i?"bg-emerald-500 text-white shadow-emerald-500/20 shadow-lg":"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:t})}function T({label:t,icon:i,checked:l,onChange:d}){return e.jsxs("button",{onClick:d,className:`flex items-center gap-3 p-3 rounded-xl border transition-all text-left group ${l?"border-emerald-500 bg-emerald-50 dark:bg-emerald-500/10 text-emerald-700 dark:text-emerald-400":"border-slate-200 dark:border-slate-800 bg-transparent text-slate-600 dark:text-slate-400 hover:border-slate-300 dark:hover:border-slate-700"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center transition-colors ${l?"bg-emerald-500 border-emerald-500 text-white":"border-slate-300 dark:border-slate-600"}`,children:l&&e.jsx(M,{className:"w-3 h-3"})}),i&&e.jsx("span",{className:"text-lg",children:i}),e.jsx("span",{className:"text-sm font-medium",children:t})]})}function xe({label:t,icon:i,checked:l,onChange:d}){return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-slate-50 dark:bg-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i,e.jsx("span",{className:"text-sm font-medium text-slate-900 dark:text-white",children:t})]}),e.jsx("button",{onClick:d,className:`w-12 h-6 rounded-full p-1 transition-colors ${l?"bg-emerald-500":"bg-slate-300 dark:bg-slate-700"}`,children:e.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-sm transition-transform ${l?"translate-x-6":"translate-x-0"}`})})]})}function we(){const{user:t}=ie(),[i,l]=o.useState([]),[d,r]=o.useState([]),[p,u]=o.useState(new Set),[a,n]=o.useState(0),[m,b]=o.useState(!0),[f,v]=o.useState(!1),[N,j]=o.useState(!1),[h,c]=o.useState({status:"open",sortBy:"deadline",limit:20,offset:0});o.useEffect(()=>{k()},[]),o.useEffect(()=>{m||$(h)},[h]);const k=async()=>{b(!0),j(!1);try{const[s,x,y]=await Promise.all([L(h),Y(7,10),t?K():Promise.resolve([])]);l(s.data),n(s.count),r(x),u(new Set(y.map(S=>S.id)))}catch(s){console.error("Error loading bandi:",s),j(!0)}finally{b(!1)}},$=async s=>{s.offset===0?b(!0):v(!0);try{const x=await L(s);s.offset===0?l(x.data):l(y=>[...y,...x.data]),n(x.count)}catch(x){console.error("Error loading bandi:",x),j(!0)}finally{b(!1),v(!1)}},F=o.useCallback(s=>{c(s)},[]),I=o.useCallback(async(s,x)=>{if(!t)return;(x?await Q(s):await W(s))&&u(S=>{const C=new Set(S);return x?C.add(s):C.delete(s),C})},[t]),D=()=>{!f&&i.length<a&&c(s=>({...s,offset:(s.offset||0)+(s.limit||20)}))},O=()=>{c({status:"open",sortBy:"deadline",limit:20,offset:0})};return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 pb-24",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 sticky top-0 z-30 border-b border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Bandi"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{to:"/bandi/alerts",className:"p-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",title:"Gestisci notifiche",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx(B,{to:"/bandi/watchlist",className:"px-3 py-1.5 rounded-xl bg-emerald-500 text-white text-sm font-medium hover:bg-emerald-600 transition-colors",children:"Salvati"})]})]}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx(ne,{filters:h,onFiltersChange:F,totalResults:m?void 0:a})})]}),e.jsx("div",{className:"px-4 py-4 space-y-6",children:m?e.jsx(re,{count:6}):N?e.jsx(R,{type:"error",onRetry:k}):i.length===0?e.jsx(R,{type:"no-results",searchQuery:h.search,onClearFilters:O}):e.jsxs(e.Fragment,{children:[!h.search&&h.offset===0&&d.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:"ðŸ”¥ In scadenza"}),e.jsxs(B,{to:"/bandi?deadline_within_days=7",className:"text-sm text-emerald-500 font-medium flex items-center",children:["Vedi tutti ",e.jsx(le,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide",children:d.slice(0,5).map((s,x)=>e.jsx(g.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:x*.05},children:e.jsx(A,{bando:s,variant:"featured"})},s.id))})]}),e.jsxs("section",{children:[!h.search&&h.offset===0&&d.length>0&&e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3",children:"Tutti i bandi"}),e.jsx("div",{className:"space-y-3",children:e.jsx(E,{mode:"popLayout",children:i.map((s,x)=>e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{delay:Math.min(x*.03,.3)},layout:!0,children:e.jsx(A,{bando:s,isSaved:p.has(s.id),onSaveToggle:I})},s.id))})}),i.length<a&&e.jsx(g.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:D,disabled:f,className:"w-full mt-4 py-3 rounded-2xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 font-medium text-slate-700 dark:text-slate-200",children:f?"Caricamento...":`Carica altri (${a-i.length} rimasti)`})]})]})})]})}export{we as default};
