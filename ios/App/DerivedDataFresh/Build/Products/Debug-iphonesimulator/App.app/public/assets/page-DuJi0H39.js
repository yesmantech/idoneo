import{j as e}from"./framer-CcO5Kjcw.js";import{u as Z,d as ae,r as s,b as se}from"./router-ClfHAwMg.js";import{s as c}from"./index-Z19V86or.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";import"./icons-Dvxa2Qho.js";const X=[{path:"/admin",label:"Dashboard",exactMatch:!0,color:"text-sky-400",borderColor:"border-sky-900",hoverBorder:"hover:border-sky-500"},{path:"/admin/questions",label:"Domande",exactMatch:!1,color:"text-slate-300",borderColor:"border-slate-700",hoverBorder:"hover:border-slate-500"},{path:"/admin/structure",label:"Struttura (Cat/Ruoli)",exactMatch:!1,color:"text-emerald-400",borderColor:"border-emerald-900",hoverBorder:"hover:border-emerald-500"},{path:"/admin/quiz",label:"Concorsi & Materie",exactMatch:!1,color:"text-blue-400",borderColor:"border-blue-900",hoverBorder:"hover:border-blue-500"},{path:"/admin/blog",label:"Blog & News",exactMatch:!1,color:"text-purple-400",borderColor:"border-purple-900",hoverBorder:"hover:border-purple-500"},{path:"/admin/images",label:"Media Library",exactMatch:!1,color:"text-pink-400",borderColor:"border-pink-900",hoverBorder:"hover:border-pink-500"},{path:"/admin/leaderboard",label:"Classifiche",exactMatch:!1,color:"text-amber-400",borderColor:"border-amber-900",hoverBorder:"hover:border-amber-500"},{path:"/admin/users",label:"Utenti",exactMatch:!1,color:"text-indigo-400",borderColor:"border-indigo-900",hoverBorder:"hover:border-indigo-500"},{path:"/admin/rules",label:"Regole Simulazione",exactMatch:!1,color:"text-rose-400",borderColor:"border-rose-900",hoverBorder:"hover:border-rose-500"},{path:"/admin/upload-csv",label:"Import CSV",exactMatch:!1,color:"text-orange-400",borderColor:"border-orange-900",hoverBorder:"hover:border-orange-500"},{path:"/admin/analytics",label:"Analisi & AI",exactMatch:!1,color:"text-cyan-400",borderColor:"border-cyan-900",hoverBorder:"hover:border-cyan-500"}];function k({children:o}){const i=Z(),x=ae(),[u,d]=s.useState(!1);s.useEffect(()=>{(async()=>{const{data:{session:m}}=await c.auth.getSession();m||i("/login")})()},[i]),s.useEffect(()=>{d(!1)},[x.pathname]);const b=a=>{i(a),d(!1)},h=(a,m)=>m?x.pathname===a:x.pathname.startsWith(a);return e.jsxs("div",{className:"min-h-screen bg-slate-950 text-white",children:[u&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-40 lg:hidden backdrop-blur-sm",onClick:()=>d(!1)}),e.jsxs("div",{className:`fixed top-0 left-0 h-full w-72 bg-slate-900 z-50 transform transition-transform duration-300 ease-ios lg:hidden safe-area-inset ${u?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Menu Admin"}),e.jsx("button",{onClick:()=>d(!1),className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-800 transition-colors","aria-label":"Chiudi menu",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("nav",{className:"p-4 space-y-2",children:X.map(a=>e.jsx("button",{onClick:()=>b(a.path),className:`w-full text-left px-4 py-3 rounded-lg text-sm font-medium transition-colors ${h(a.path,a.exactMatch)?"bg-white text-slate-900":`bg-slate-800 ${a.color} hover:bg-slate-700`}`,children:a.label},a.path))})]}),e.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-4 lg:py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 lg:mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>d(!0),className:"w-10 h-10 flex items-center justify-center rounded-lg bg-slate-900 border border-slate-700 hover:border-slate-500 transition-colors lg:hidden","aria-label":"Apri menu",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("h1",{className:"text-xl lg:text-2xl font-semibold",children:"Admin Dashboard"})]}),e.jsx("button",{onClick:()=>i("/"),className:"text-sm text-slate-400 hover:text-white transition-colors",children:"Torna al sito →"})]}),e.jsx("nav",{className:"mb-8 hidden lg:flex flex-wrap gap-2",children:X.map(a=>e.jsx("button",{onClick:()=>b(a.path),className:`px-4 py-2 rounded-md text-sm font-medium border transition-colors ${h(a.path,a.exactMatch)?"bg-white text-slate-900 border-white shadow-sm":`bg-slate-900 ${a.color} ${a.borderColor} ${a.hoverBorder} hover:text-white`}`,children:a.label},a.path))}),o]})]})}const Y="question-images";function ce(){const{id:o}=se(),i=Z(),[x,u]=s.useState(null),[d,b]=s.useState([]),[h,a]=s.useState(!0),[m,S]=s.useState(!1),[N,p]=s.useState(null),[M,E]=s.useState(null),[f,y]=s.useState(""),[_,B]=s.useState(""),[I,q]=s.useState(""),[D,U]=s.useState(""),[z,A]=s.useState(""),[g,O]=s.useState(""),[v,w]=s.useState(""),[$,L]=s.useState(""),[T,P]=s.useState(""),[j,R]=s.useState(null),[W,F]=s.useState(!1),[Q,K]=s.useState(null),[V,G]=s.useState(null);s.useEffect(()=>{(async()=>{a(!0),p(null);try{if(!o)throw new Error("ID mancante");const{data:l,error:n}=await c.from("questions").select("*").eq("id",o).single();if(n||!l)throw new Error("Domanda non trovata");const r=l;if(u(r),r.quiz_id){const{data:C}=await c.from("subjects").select("*").eq("quiz_id",r.quiz_id).order("name",{ascending:!0});b(C||[])}y(r.text??""),B(r.option_a??""),q(r.option_b??""),U(r.option_c??""),A(r.option_d??""),O(r.correct_option??""),w(r.image_url??""),L(r.subject_id??""),P(r.explanation??"")}catch(l){console.error(l),p(l.message||"Errore caricamento.")}finally{a(!1)}})()},[o]);const ee=async()=>{if(x){S(!0),p(null),E(null);try{if(!f.trim())throw new Error("Il testo è obbligatorio.");if(!g)throw new Error("Seleziona l'opzione corretta.");const{data:t,error:l}=await c.from("questions").update({text:f.trim(),option_a:_.trim(),option_b:I.trim(),option_c:D.trim(),option_d:z.trim(),correct_option:g,image_url:v.trim()||null,subject_id:$||null,explanation:T.trim()||null}).eq("id",o).select().single();if(l)throw l;u(t),E("Domanda salvata con successo.")}catch(t){console.error(t),p(t.message||"Errore salvataggio.")}finally{S(!1)}}},te=async()=>{if(!(!j||!o)){F(!0),K(null),G(null);try{const t=j.name.split(".").pop(),n=`${o}_${Date.now()}.${t}`,{error:r}=await c.storage.from(Y).upload(n,j,{upsert:!0});if(r)throw r;const{data:C}=c.storage.from(Y).getPublicUrl(n),H=C.publicUrl,{error:J}=await c.from("questions").update({image_url:H}).eq("id",o);if(J)throw J;w(H),G("Immagine caricata e collegata!"),R(null)}catch(t){console.error(t),K(t.message||"Errore upload.")}finally{F(!1)}}};return h?e.jsx(k,{children:e.jsx("div",{className:"flex items-center justify-center text-slate-400",children:"Caricamento..."})}):x?e.jsx(k,{children:e.jsxs("div",{className:"mx-auto max-w-4xl px-4 py-8",children:[e.jsx("button",{onClick:()=>i("/admin"),className:"text-xs text-slate-400 hover:text-white mb-4",children:"← Torna alla lista"}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"Modifica Domanda"}),e.jsx("span",{className:"text-xs font-mono text-slate-500 bg-slate-900 px-2 py-1 rounded border border-slate-800",children:o})]}),e.jsxs("div",{className:"bg-slate-900/60 border border-slate-800 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Materia"}),e.jsxs("select",{className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-slate-200 outline-none focus:border-sky-500",value:$,onChange:t=>L(t.target.value),children:[e.jsx("option",{value:"",children:"(Nessuna)"}),d.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.code?`(${t.code})`:""]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Testo Domanda"}),e.jsx("textarea",{className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-slate-200 min-h-[100px] outline-none focus:border-sky-500",value:f,onChange:t=>y(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Testo Domanda"}),e.jsx("textarea",{className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-slate-200 min-h-[100px] outline-none focus:border-sky-500",value:f,onChange:t=>y(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Spiegazione (Opzionale)"}),e.jsx("textarea",{className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-slate-200 min-h-[80px] outline-none focus:border-sky-500",value:T,onChange:t=>P(t.target.value),placeholder:"Inserisci la spiegazione della risposta corretta..."})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:["a","b","c","d"].map(t=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-slate-400 mb-1 uppercase",children:["Opzione ",t]}),e.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-slate-200 outline-none focus:border-sky-500",value:t==="a"?_:t==="b"?I:t==="c"?D:z,onChange:l=>{const n=l.target.value;t==="a"?B(n):t==="b"?q(n):t==="c"?U(n):A(n)}})]},t))}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Risposta Corretta"}),e.jsx("div",{className:"flex gap-4",children:["a","b","c","d"].map(t=>e.jsxs("label",{className:`flex items-center gap-2 px-4 py-2 rounded-lg border cursor-pointer transition-all ${g===t?"bg-emerald-900/30 border-emerald-500 text-emerald-400":"bg-slate-950 border-slate-700 text-slate-400"}`,children:[e.jsx("input",{type:"radio",name:"correctOption",value:t,checked:g===t,onChange:()=>O(t),className:"hidden"}),e.jsx("span",{className:"uppercase font-bold",children:t})]},t))})]}),e.jsxs("div",{className:"mb-6 p-4 rounded-xl bg-slate-950/50 border border-slate-800",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-2",children:"Immagine (Opzionale)"}),e.jsxs("div",{className:"flex gap-4 items-end mb-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{placeholder:"URL immagine...",className:"w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-xs text-slate-200 outline-none focus:border-sky-500",value:v,onChange:t=>w(t.target.value)})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"file",accept:"image/*",className:"text-xs text-slate-400 file:mr-2 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-xs file:font-semibold file:bg-slate-800 file:text-slate-200 hover:file:bg-slate-700",onChange:t=>{var l;return R(((l=t.target.files)==null?void 0:l[0])||null)}})}),e.jsx("button",{type:"button",onClick:te,disabled:!j||W,className:"px-3 py-2 bg-slate-800 text-xs text-white rounded-lg hover:bg-slate-700 disabled:opacity-50",children:W?"Caricamento...":"Upload"})]}),Q&&e.jsx("p",{className:"text-xs text-red-400 mb-2",children:Q}),V&&e.jsx("p",{className:"text-xs text-emerald-400 mb-2",children:V}),v&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:v,alt:"Preview",className:"max-h-40 rounded border border-slate-700 object-contain"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-800",children:[e.jsxs("div",{children:[N&&e.jsx("p",{className:"text-sm text-red-400",children:N}),M&&e.jsx("p",{className:"text-sm text-emerald-400",children:M})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>i(-1),className:"px-4 py-2 border border-slate-700 text-slate-300 text-sm rounded-lg hover:bg-slate-800",children:"Annulla"}),e.jsx("button",{onClick:ee,disabled:m,className:"px-6 py-2 bg-emerald-600 text-white text-sm font-semibold rounded-lg hover:bg-emerald-500 shadow-lg shadow-emerald-900/20 disabled:opacity-50",children:m?"Salvataggio...":"Salva Modifiche"})]})]})]})]})}):e.jsx(k,{children:e.jsx("div",{className:"flex items-center justify-center text-red-400",children:N||"Non trovato"})})}export{ce as default};
