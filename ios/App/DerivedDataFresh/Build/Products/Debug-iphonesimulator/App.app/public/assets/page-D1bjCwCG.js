import{j as e}from"./framer-BdaCTGm4.js";import{u as w,r as s}from"./router-ClfHAwMg.js";import{s as d}from"./index-DBMi1b3R.js";import{A as k}from"./AdminLayout-Bws632pn.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";import"./icons-DIoLbN6D.js";const c="question-images";function A(){const f=w(),[o,n]=s.useState(null),[m,u]=s.useState(!1),[p,b]=s.useState([]),[h,x]=s.useState(!0),[l,t]=s.useState(null),g=async()=>{x(!0);try{const{data:a,error:r}=await d.storage.from(c).list("",{limit:100,sortBy:{column:"created_at",order:"desc"}});if(r)throw r;const j=(a||[]).map(i=>{const{data:N}=d.storage.from(c).getPublicUrl(i.name);return{name:i.name,created_at:i.created_at,publicUrl:N.publicUrl}});b(j)}catch(a){console.error(a),t({type:"error",text:"Errore caricamento lista."})}finally{x(!1)}};s.useEffect(()=>{g()},[]);const y=async()=>{if(o){u(!0),t(null);try{const a=`${Date.now()}_${o.name.replace(/\s+/g,"_").toLowerCase()}`,{error:r}=await d.storage.from(c).upload(a,o,{cacheControl:"3600",upsert:!1});if(r)throw r;t({type:"success",text:"Upload completato!"}),n(null),await g()}catch(a){console.error(a),t({type:"error",text:"Errore durante l'upload."})}finally{u(!1)}}},v=a=>{navigator.clipboard.writeText(a),t({type:"success",text:"URL copiato!"}),setTimeout(()=>t(null),2e3)};return e.jsx(k,{children:e.jsxs("div",{className:"mx-auto max-w-5xl px-4 py-8",children:[e.jsx("button",{onClick:()=>f("/admin"),className:"text-xs text-[var(--foreground)] opacity-40 hover:opacity-100 mb-4 transition-all",children:"â† Dashboard"}),e.jsx("h1",{className:"text-2xl font-bold mb-6 text-[var(--foreground)]",children:"Gestione Immagini"}),e.jsxs("div",{className:"bg-[var(--card)] border border-[var(--card-border)] rounded-xl p-6 mb-8 flex flex-col md:flex-row items-end gap-4 shadow-sm",children:[e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--foreground)] opacity-40 mb-2",children:"Nuova Immagine"}),e.jsx("input",{type:"file",accept:"image/*",className:"block w-full text-sm text-[var(--foreground)] opacity-60 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-slate-100 dark:file:bg-slate-800 file:text-[var(--foreground)] hover:file:opacity-80",onChange:a=>{var r;return n(((r=a.target.files)==null?void 0:r[0])||null)}})]}),e.jsx("button",{onClick:y,disabled:!o||m,className:"w-full md:w-auto px-6 py-2 bg-emerald-600 dark:bg-emerald-500 text-white text-sm font-semibold rounded-lg hover:opacity-90 disabled:opacity-50 transition-all shadow-lg shadow-emerald-500/10",children:m?"Caricamento...":"Carica"})]}),l&&e.jsx("div",{className:`mb-6 p-3 rounded-lg border text-sm ${l.type==="error"?"bg-rose-50 dark:bg-rose-500/10 border-rose-100 dark:border-rose-500/20 text-rose-600 dark:text-rose-400":"bg-emerald-50 dark:bg-emerald-500/10 border-emerald-100 dark:border-emerald-500/20 text-emerald-600 dark:text-emerald-400"}`,children:l.text}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:h?e.jsx("p",{className:"text-[var(--foreground)] opacity-40 col-span-full text-center py-8",children:"Caricamento gallery..."}):p.length===0?e.jsx("p",{className:"text-[var(--foreground)] opacity-40 col-span-full text-center py-8",children:"Nessuna immagine nel bucket."}):p.map(a=>e.jsxs("div",{className:"group relative bg-[var(--card)] border border-[var(--card-border)] rounded-xl overflow-hidden hover:border-emerald-500/50 transition-colors",children:[e.jsxs("div",{className:"aspect-square bg-slate-50 dark:bg-slate-950 relative",children:[e.jsx("img",{src:a.publicUrl,alt:a.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:e.jsx("button",{onClick:()=>v(a.publicUrl),className:"px-3 py-1 bg-white dark:bg-slate-200 text-slate-900 text-xs rounded font-medium hover:bg-slate-100",children:"Copia URL"})})]}),e.jsx("div",{className:"p-2",children:e.jsx("p",{className:"text-[10px] text-[var(--foreground)] opacity-40 truncate",title:a.name,children:a.name})})]},a.name))})]})})}export{A as default};
