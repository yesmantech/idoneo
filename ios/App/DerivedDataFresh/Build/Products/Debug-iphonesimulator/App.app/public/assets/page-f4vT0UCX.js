import{j as e}from"./framer-CcO5Kjcw.js";import{b as E,u as z,r as c,L as j}from"./router-ClfHAwMg.js";import{e as D,g as T,h as I,i as B,u as L,d as P}from"./adminBandiService-DeXwNcbQ.js";import{C as A,I as R,E as O}from"./bandiService-BZw1T8K1.js";import{h as k,R as q,am as F,a6 as M,ai as U}from"./icons-Dvxa2Qho.js";import"./react-vendor-B--z-fyW.js";import"./index-Z19V86or.js";import"./supabase-CIvuJI4W.js";function W(){var v;const{id:r}=E(),u=z(),o=!r||r==="nuovo",[f,x]=c.useState(!o),[b,g]=c.useState(!1),[N,_]=c.useState([]),[w,y]=c.useState([]),[t,h]=c.useState({title:"",deadline:new Date(Date.now()+720*60*60*1e3).toISOString().split("T")[0],status:"draft"});c.useEffect(()=>{C()},[r]);const C=async()=>{var n,m;const[a,d]=await Promise.all([D(),T()]);if(_(a),y(d),!o&&r){x(!0);const l=await I(r);l&&h({title:l.title,slug:l.slug,ente_id:l.ente_id||null,category_id:l.category_id||null,seats_total:l.seats_total||null,seats_reserved:l.seats_reserved||null,contract_type:l.contract_type||null,salary_range:l.salary_range||null,education_level:l.education_level||[],age_min:l.age_min||null,age_max:l.age_max||null,region:l.region||null,province:l.province||null,city:l.city||null,is_remote:l.is_remote||!1,publication_date:l.publication_date||null,deadline:((n=l.deadline)==null?void 0:n.split("T")[0])||"",exam_date:((m=l.exam_date)==null?void 0:m.split("T")[0])||null,application_url:l.application_url||null,application_method:l.application_method||null,description:l.description||null,short_description:l.short_description||null,exam_stages:l.exam_stages||[],status:l.status,is_featured:l.is_featured||!1,source_urls:l.source_urls||[],tags:l.tags||[]}),x(!1)}},s=(a,d)=>{h(n=>({...n,[a]:d}))},p=async a=>{if(a.preventDefault(),!t.title||!t.deadline){alert("Titolo e scadenza sono obbligatori");return}g(!0);try{if(o){const d=await B(t);u(`/admin/bandi/${d.id}`)}else r&&await L(r,t);alert("Salvato con successo!")}catch(d){console.error("Error saving:",d),alert("Errore durante il salvataggio")}finally{g(!1)}},S=async()=>{if(r&&confirm("Sei sicuro di voler eliminare questo bando?"))try{await P(r),u("/admin/bandi")}catch{alert("Errore durante l'eliminazione")}};return f?e.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 flex items-center justify-center",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-emerald-500"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950",children:[e.jsx("div",{className:"bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(j,{to:"/admin/bandi",className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg",children:e.jsx(q,{className:"w-5 h-5 text-slate-600 dark:text-slate-300"})}),e.jsx("h1",{className:"text-xl font-bold text-slate-900 dark:text-white",children:o?"Nuovo Bando":"Modifica Bando"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!o&&t.slug&&e.jsxs(j,{to:`/bandi/${t.slug}`,target:"_blank",className:"flex items-center gap-2 px-3 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg",children:[e.jsx(F,{className:"w-4 h-4"}),"Anteprima"]}),!o&&e.jsxs("button",{onClick:S,className:"flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-lg",children:[e.jsx(M,{className:"w-4 h-4"}),"Elimina"]}),e.jsxs("button",{onClick:p,disabled:b,className:"flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-lg font-medium hover:bg-emerald-600 disabled:opacity-50",children:[b?e.jsx(k,{className:"w-4 h-4 animate-spin"}):e.jsx(U,{className:"w-4 h-4"}),"Salva"]})]})]})}),e.jsx("div",{className:"max-w-5xl mx-auto px-4 py-6",children:e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsx(i,{title:"Informazioni Base",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Titolo *"}),e.jsx("input",{type:"text",value:t.title,onChange:a=>s("title",a.target.value),required:!0,className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800",placeholder:"Es: Concorso 100 Allievi Agenti Polizia di Stato"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Ente"}),e.jsxs("select",{value:t.ente_id||"",onChange:a=>s("ente_id",a.target.value||null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"",children:"Seleziona ente..."}),N.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Categoria"}),e.jsxs("select",{value:t.category_id||"",onChange:a=>s("category_id",a.target.value||null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"",children:"Seleziona categoria..."}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Stato"}),e.jsxs("select",{value:t.status,onChange:a=>s("status",a.target.value),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"draft",children:"Bozza"}),e.jsx("option",{value:"review",children:"In Revisione"}),e.jsx("option",{value:"published",children:"Pubblicato"}),e.jsx("option",{value:"closed",children:"Chiuso"}),e.jsx("option",{value:"suspended",children:"Sospeso"})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.is_featured||!1,onChange:a=>s("is_featured",a.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"In evidenza"})]})})]})}),e.jsx(i,{title:"Date",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Data Pubblicazione"}),e.jsx("input",{type:"date",value:t.publication_date||"",onChange:a=>s("publication_date",a.target.value||null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Scadenza *"}),e.jsx("input",{type:"date",value:((v=t.deadline)==null?void 0:v.split("T")[0])||"",onChange:a=>s("deadline",a.target.value),required:!0,className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Data Esame"}),e.jsx("input",{type:"date",value:t.exam_date||"",onChange:a=>s("exam_date",a.target.value||null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]})]})}),e.jsx(i,{title:"Posti e Contratto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Posti Totali"}),e.jsx("input",{type:"number",value:t.seats_total||"",onChange:a=>s("seats_total",a.target.value?parseInt(a.target.value):null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Posti Riservati"}),e.jsx("input",{type:"number",value:t.seats_reserved||"",onChange:a=>s("seats_reserved",a.target.value?parseInt(a.target.value):null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tipo Contratto"}),e.jsxs("select",{value:t.contract_type||"",onChange:a=>s("contract_type",a.target.value||null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"",children:"Seleziona..."}),A.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Range Stipendio"}),e.jsx("input",{type:"text",value:t.salary_range||"",onChange:a=>s("salary_range",a.target.value||null),placeholder:"Es: €1.500 - €2.000",className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]})]})}),e.jsx(i,{title:"Località",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Regione"}),e.jsxs("select",{value:t.region||"",onChange:a=>s("region",a.target.value||null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"",children:"Seleziona regione..."}),R.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Provincia"}),e.jsx("input",{type:"text",value:t.province||"",onChange:a=>s("province",a.target.value||null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Città"}),e.jsx("input",{type:"text",value:t.city||"",onChange:a=>s("city",a.target.value||null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 mt-7",children:[e.jsx("input",{type:"checkbox",checked:t.is_remote||!1,onChange:a=>s("is_remote",a.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Lavoro da remoto"})]})})]})}),e.jsx(i,{title:"Requisiti",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Titolo di Studio"}),e.jsx("div",{className:"space-y-2",children:O.map(a=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:(t.education_level||[]).includes(a.value),onChange:d=>{const n=t.education_level||[];d.target.checked?s("education_level",[...n,a.value]):s("education_level",n.filter(m=>m!==a.value))},className:"rounded"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:a.label})]},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Età Minima"}),e.jsx("input",{type:"number",value:t.age_min||"",onChange:a=>s("age_min",a.target.value?parseInt(a.target.value):null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Età Massima"}),e.jsx("input",{type:"number",value:t.age_max||"",onChange:a=>s("age_max",a.target.value?parseInt(a.target.value):null),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]})]})}),e.jsx(i,{title:"Candidatura",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"URL Candidatura"}),e.jsx("input",{type:"url",value:t.application_url||"",onChange:a=>s("application_url",a.target.value||null),placeholder:"https://...",className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Metodo Candidatura"}),e.jsx("input",{type:"text",value:t.application_method||"",onChange:a=>s("application_method",a.target.value||null),placeholder:"Es: Online tramite portale inPA",className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]})]})}),e.jsx(i,{title:"Contenuto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Descrizione Breve"}),e.jsx("textarea",{value:t.short_description||"",onChange:a=>s("short_description",a.target.value||null),rows:2,placeholder:"Breve riassunto per le card...",className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Descrizione Completa"}),e.jsx("textarea",{value:t.description||"",onChange:a=>s("description",a.target.value||null),rows:6,placeholder:"Descrizione dettagliata del bando...",className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800"})]})]})}),e.jsx(i,{title:"Fonte",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"URL Fonte (uno per riga)"}),e.jsx("textarea",{value:(t.source_urls||[]).join(`
`),onChange:a=>s("source_urls",a.target.value.split(`
`).filter(Boolean)),rows:3,placeholder:"https://www.gazzettaufficiale.it/...",className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 font-mono text-sm"})]})})]})})]})}function i({title:r,children:u}){return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-4",children:r}),u]})}export{W as default};
