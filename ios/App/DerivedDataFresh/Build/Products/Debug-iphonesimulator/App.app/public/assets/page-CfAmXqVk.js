import{j as r}from"./framer-CcO5Kjcw.js";import{r as a,L as x}from"./router-ClfHAwMg.js";import{s as o}from"./index-Z19V86or.js";import{A as K}from"./AdminLayout-D8QxpNpO.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";import"./icons-Dvxa2Qho.js";const b=i=>i.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"");function re(){const[i,P]=a.useState([]),[h,I]=a.useState([]),[N,M]=a.useState([]),[s,w]=a.useState(null),[d,p]=a.useState(null),[v,T]=a.useState(!1),[f,D]=a.useState(!1),[y,E]=a.useState(!1),[L,_]=a.useState(!0),[u,C]=a.useState(""),[S,k]=a.useState(""),[g,A]=a.useState(""),[$,j]=a.useState("");a.useEffect(()=>{l()},[]);const l=async()=>{_(!0);const[e,t,m]=await Promise.all([o.from("categories").select("*").order("title"),o.from("roles").select("*").order("order_index"),o.from("quizzes").select("id, title, slug, year, is_official, role_id, is_archived").order("created_at",{ascending:!1})]);e.data&&P(e.data),t.data&&I(t.data),m.data&&M(m.data),_(!1)},Q=async()=>{if(!u)return;const e=S||b(u),{error:t}=await o.from("categories").insert({title:u,slug:e});t?alert(t.message):(C(""),k(""),l())},G=async e=>{confirm("Cancella categoria e tutto il contenuto?")&&(await o.from("categories").delete().eq("id",e),s===e&&w(null),l())},B=async(e,t)=>{await o.from("categories").update({is_archived:t}).eq("id",e),l()},O=async()=>{if(!g||!s)return;const e=$||b(g),{error:t}=await o.from("roles").insert({title:g,slug:e,category_id:s,order_index:h.filter(m=>m.category_id===s).length+1});t?alert(t.message):(A(""),j(""),l())},V=async e=>{confirm("Cancella ruolo?")&&(await o.from("roles").delete().eq("id",e),d===e&&p(null),l())},F=async(e,t)=>{await o.from("roles").update({is_archived:t}).eq("id",e),l()},H=async(e,t)=>{await o.from("quizzes").update({is_archived:t}).eq("id",e),l()},J=a.useMemo(()=>i.filter(e=>v?!0:!e.is_archived),[i,v]),z=a.useMemo(()=>h.filter(e=>e.category_id===s&&(f?!0:!e.is_archived)),[h,s,f]),R=a.useMemo(()=>N.filter(e=>e.role_id===d&&(y?!0:!e.is_archived)),[N,d,y]),n=i.find(e=>e.id===s),c=h.find(e=>e.id===d);return L?r.jsx("div",{className:"p-8 text-center text-slate-400 animate-pulse",children:"Caricamento struttura..."}):r.jsxs(K,{children:[r.jsx("div",{className:"flex justify-between items-center mb-6",children:r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-black text-[var(--foreground)] tracking-tight",children:"Gestione Struttura"}),r.jsx("p",{className:"text-[var(--foreground)] opacity-50 text-sm mt-1",children:"Organizza categorie, ruoli e concorsi in una gerarchia chiara."})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 h-[calc(100vh-200px)]",children:[r.jsxs("div",{className:"flex flex-col bg-[var(--card)] border border-[var(--card-border)] rounded-[20px] shadow-[0_4px_16px_rgba(0,0,0,0.04)] overflow-hidden",children:[r.jsxs("div",{className:"p-5 border-b border-[var(--card-border)] bg-slate-50/50 dark:bg-slate-900/50 flex justify-between items-center",children:[r.jsxs("h2",{className:"font-bold text-[var(--foreground)] flex items-center gap-2",children:[r.jsx("span",{className:"w-6 h-6 rounded-lg bg-emerald-100 dark:bg-emerald-500/20 text-emerald-600 dark:text-emerald-400 flex items-center justify-center text-xs font-bold",children:"1"}),"Categorie"]}),r.jsxs("label",{className:"flex items-center gap-1.5 text-[10px] text-[var(--foreground)] opacity-50 cursor-pointer hover:opacity-70",children:[r.jsx("input",{type:"checkbox",checked:v,onChange:e=>T(e.target.checked),className:"w-3 h-3 rounded"}),"Archiviati"]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:J.map(e=>r.jsxs("div",{onClick:()=>{w(e.id),p(null)},className:`p-4 rounded-2xl cursor-pointer border transition-all flex justify-between group ${e.is_archived?"opacity-50":""} ${s===e.id?"bg-emerald-50 dark:bg-emerald-500/10 border-emerald-200 dark:border-emerald-500/30 ring-1 ring-emerald-100 dark:ring-emerald-500/20 shadow-sm":"bg-slate-50/50 dark:bg-slate-900/50 border-transparent hover:bg-slate-100 dark:hover:bg-slate-800 hover:border-slate-200 dark:hover:border-slate-700"}`,children:[r.jsxs("div",{children:[r.jsx("div",{className:`font-semibold text-sm ${e.is_archived?"line-through":""} ${s===e.id?"text-emerald-700 dark:text-emerald-400":"text-[var(--foreground)] opacity-70"}`,children:e.title}),r.jsxs("div",{className:"text-[10px] text-[var(--foreground)] opacity-30 font-mono mt-0.5",children:["/",e.slug]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(x,{to:`/admin/structure/categories/${e.id}`,className:"text-emerald-600 dark:text-emerald-400 hover:text-emerald-500 p-1.5 rounded-lg hover:bg-emerald-50 dark:hover:bg-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all text-xs font-bold",title:"Modifica Banner",children:"EDIT"}),r.jsx("button",{onClick:t=>{t.stopPropagation(),B(e.id,!e.is_archived)},className:`opacity-0 group-hover:opacity-100 p-1.5 rounded-lg transition-all text-xs ${e.is_archived?"text-emerald-500 hover:bg-emerald-50 dark:hover:bg-emerald-500/10":"text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-500/10"}`,title:e.is_archived?"Ripristina":"Archivia",children:e.is_archived?"â†©":"ðŸ“¦"}),r.jsx("button",{onClick:t=>{t.stopPropagation(),G(e.id)},className:"text-rose-500 opacity-0 group-hover:opacity-100 hover:text-rose-400 hover:bg-rose-50 dark:hover:bg-rose-500/10 p-1.5 rounded-lg transition-all",children:"Ã—"})]})]},e.id))}),r.jsx("div",{className:"p-4 border-t border-[var(--card-border)] bg-slate-50/30 dark:bg-slate-900/30 space-y-3",children:r.jsxs("div",{className:"space-y-2",children:[r.jsx("input",{className:"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2.5 text-sm text-[var(--foreground)] placeholder:text-[var(--foreground)]/30 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all",placeholder:"Nuova Categoria...",value:u,onChange:e=>{C(e.target.value),k(b(e.target.value))}}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{className:"w-full bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2 text-xs text-[var(--foreground)] opacity-50 font-mono placeholder:text-[var(--foreground)]/30 focus:outline-none focus:border-slate-300 dark:focus:border-slate-600",placeholder:"slug-automatico",value:S,onChange:e=>k(e.target.value)}),r.jsx("button",{onClick:Q,className:"bg-emerald-500 hover:bg-emerald-600 text-white p-2.5 rounded-xl shadow-sm transition-colors font-bold",children:"+"})]})]})})]}),r.jsxs("div",{className:`flex flex-col bg-[var(--card)] border border-[var(--card-border)] rounded-[20px] shadow-[0_4px_16px_rgba(0,0,0,0.04)] overflow-hidden transition-all duration-300 ${s?"opacity-100":"opacity-40 grayscale pointer-events-none"}`,children:[r.jsxs("div",{className:"p-5 border-b border-[var(--card-border)] bg-slate-50/50 dark:bg-slate-900/50 flex justify-between items-center",children:[r.jsxs("h2",{className:"font-bold text-[var(--foreground)] flex items-center gap-2",children:[r.jsx("span",{className:"w-6 h-6 rounded-lg bg-sky-100 dark:bg-sky-500/20 text-sky-600 dark:text-sky-400 flex items-center justify-center text-xs font-bold",children:"2"}),"Ruoli"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[n&&r.jsx("span",{className:"text-[10px] bg-slate-100 dark:bg-slate-800 text-[var(--foreground)] opacity-60 font-medium px-2 py-1 rounded-full",children:n.title}),r.jsxs("label",{className:"flex items-center gap-1.5 text-[10px] text-[var(--foreground)] opacity-50 cursor-pointer hover:opacity-70",children:[r.jsx("input",{type:"checkbox",checked:f,onChange:e=>D(e.target.checked),className:"w-3 h-3 rounded"}),"Archiviati"]})]})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:[z.length===0&&r.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 opacity-50",children:[r.jsx("span",{className:"text-2xl mb-2",children:"ðŸ‘¤"}),r.jsx("p",{className:"text-sm text-[var(--foreground)] opacity-50",children:"Nessun ruolo"})]}),z.map(e=>r.jsxs("div",{onClick:()=>p(e.id),className:`p-4 rounded-2xl cursor-pointer border transition-all flex justify-between group ${e.is_archived?"opacity-50":""} ${d===e.id?"bg-sky-50 dark:bg-sky-500/10 border-sky-200 dark:border-sky-500/30 ring-1 ring-sky-100 dark:ring-sky-500/20 shadow-sm":"bg-slate-50/50 dark:bg-slate-900/50 border-transparent hover:bg-slate-100 dark:hover:bg-slate-800 hover:border-slate-200 dark:hover:border-slate-700"}`,children:[r.jsxs("div",{children:[r.jsx("div",{className:`font-semibold text-sm ${e.is_archived?"line-through":""} ${d===e.id?"text-sky-700 dark:text-sky-400":"text-[var(--foreground)] opacity-70"}`,children:e.title}),r.jsxs("div",{className:"text-[10px] text-[var(--foreground)] opacity-30 font-mono mt-0.5",children:["/",e.slug]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(x,{to:`/admin/structure/roles/${e.id}`,className:"text-sky-600 dark:text-sky-400 hover:text-sky-500 p-1.5 rounded-lg hover:bg-sky-50 dark:hover:bg-sky-500/10 opacity-0 group-hover:opacity-100 transition-all text-xs font-bold",title:"Modifica Info e Risorse",children:"EDIT"}),r.jsx("button",{onClick:t=>{t.stopPropagation(),F(e.id,!e.is_archived)},className:`opacity-0 group-hover:opacity-100 p-1.5 rounded-lg transition-all text-xs ${e.is_archived?"text-emerald-500 hover:bg-emerald-50 dark:hover:bg-emerald-500/10":"text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-500/10"}`,title:e.is_archived?"Ripristina":"Archivia",children:e.is_archived?"â†©":"ðŸ“¦"}),r.jsx("button",{onClick:t=>{t.stopPropagation(),V(e.id)},className:"text-rose-500 opacity-0 group-hover:opacity-100 hover:text-rose-400 hover:bg-rose-50 dark:hover:bg-rose-500/10 p-1.5 rounded-lg transition-all",children:"Ã—"})]})]},e.id))]}),r.jsx("div",{className:"p-4 border-t border-[var(--card-border)] bg-slate-50/30 dark:bg-slate-900/30 space-y-3",children:r.jsxs("div",{className:"space-y-2",children:[r.jsx("input",{className:"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2.5 text-sm text-[var(--foreground)] placeholder:text-[var(--foreground)]/30 focus:outline-none focus:ring-2 focus:ring-sky-500/20 focus:border-sky-500 transition-all",placeholder:"Nuovo Ruolo...",value:g,onChange:e=>{A(e.target.value),j(b(e.target.value))}}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-xs text-slate-500 font-mono placeholder:text-slate-400 focus:outline-none focus:border-slate-300",placeholder:"slug",value:$,onChange:e=>j(e.target.value)}),r.jsx("button",{onClick:O,className:"bg-sky-500 hover:bg-sky-600 text-white p-2.5 rounded-xl shadow-sm transition-colors font-bold",children:"+"})]})]})})]}),r.jsxs("div",{className:`flex flex-col bg-[var(--card)] border border-[var(--card-border)] rounded-[20px] shadow-[0_4px_16px_rgba(0,0,0,0.04)] overflow-hidden transition-all duration-300 ${d?"opacity-100":"opacity-40 grayscale pointer-events-none"}`,children:[r.jsxs("div",{className:"p-5 border-b border-[var(--card-border)] bg-slate-50/50 dark:bg-slate-900/50 flex justify-between items-center",children:[r.jsxs("h2",{className:"font-bold text-[var(--foreground)] flex items-center gap-2",children:[r.jsx("span",{className:"w-6 h-6 rounded-lg bg-amber-100 dark:bg-amber-500/20 text-amber-600 dark:text-amber-400 flex items-center justify-center text-xs font-bold",children:"3"}),"Concorsi"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[c&&r.jsx("span",{className:"text-[10px] bg-slate-100 dark:bg-slate-800 text-[var(--foreground)] opacity-60 font-medium px-2 py-1 rounded-full",children:c.title}),r.jsxs("label",{className:"flex items-center gap-1.5 text-[10px] text-[var(--foreground)] opacity-50 cursor-pointer hover:opacity-70",children:[r.jsx("input",{type:"checkbox",checked:y,onChange:e=>E(e.target.checked),className:"w-3 h-3 rounded"}),"Archiviati"]})]})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:[R.length===0&&r.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 opacity-50",children:[r.jsx("span",{className:"text-2xl mb-2",children:"ðŸ“š"}),r.jsx("p",{className:"text-sm text-[var(--foreground)] opacity-50",children:"Nessun concorso"})]}),R.map(e=>r.jsxs("div",{className:`p-4 rounded-2xl border border-slate-200 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50 shadow-sm flex flex-col gap-2 hover:border-amber-300 dark:hover:border-amber-500/30 hover:bg-amber-50/30 dark:hover:bg-amber-500/5 transition-all group ${e.is_archived?"opacity-50":""}`,children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsx("h4",{className:`font-semibold text-sm text-[var(--foreground)] opacity-80 leading-tight group-hover:text-amber-700 dark:group-hover:text-amber-400 transition-colors ${e.is_archived?"line-through":""}`,children:e.title}),r.jsxs("div",{className:"flex items-center gap-1.5",children:[e.year&&r.jsx("span",{className:"text-[10px] bg-slate-200 dark:bg-slate-800 text-[var(--foreground)] opacity-50 font-bold px-1.5 py-0.5 rounded-md",children:e.year}),r.jsx("button",{onClick:t=>{t.stopPropagation(),H(e.id,!e.is_archived)},className:`opacity-0 group-hover:opacity-100 p-1 rounded-lg transition-all text-xs ${e.is_archived?"text-emerald-500 hover:bg-emerald-50 dark:hover:bg-emerald-500/10":"text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-500/10"}`,title:e.is_archived?"Ripristina":"Archivia",children:e.is_archived?"â†©":"ðŸ“¦"})]})]}),r.jsxs("div",{className:"flex justify-between items-end mt-1",children:[r.jsx("span",{className:"text-[10px] text-[var(--foreground)] opacity-30 font-mono",children:e.slug||"no-slug"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(x,{to:`/concorsi/${n==null?void 0:n.slug}/${c==null?void 0:c.slug}/${e.slug||e.id}`,target:"_blank",className:"text-[10px] text-emerald-600 dark:text-emerald-400 font-bold hover:underline bg-emerald-50 dark:bg-emerald-500/10 px-2 py-0.5 rounded-full border border-emerald-200 dark:border-emerald-500/20",children:"Preview â†—"}),r.jsx(x,{to:"/admin/quiz",className:"text-[10px] text-amber-600 dark:text-amber-400 font-bold hover:underline bg-amber-50 dark:bg-amber-500/10 px-2 py-0.5 rounded-full border border-amber-200 dark:border-amber-500/20",children:"Modifica"})]})]})]},e.id))]}),r.jsxs("div",{className:"p-4 border-t border-[var(--card-border)] bg-slate-50/30 dark:bg-slate-900/30",children:[r.jsx(x,{to:"/admin/quiz",children:r.jsx("button",{className:"w-full bg-white dark:bg-slate-900 hover:bg-slate-50 dark:hover:bg-slate-800 text-[var(--foreground)] opacity-70 border border-slate-200 dark:border-slate-700 text-xs py-3 rounded-xl font-bold transition-all shadow-sm",children:"Gestisci / Crea Concorsi"})}),r.jsx("p",{className:"text-[10px] text-[var(--foreground)] opacity-30 text-center mt-2 px-4",children:"Vai al pannello completo per creare concorsi e collegarli a questo ruolo."})]})]})]})]})}export{re as default};
