import{u as I,a as O,j as e,m as r,A as k}from"./framer-CcO5Kjcw.js";import{u as B,r as c,L as M}from"./router-ClfHAwMg.js";import{u as q,s as p}from"./index-BcNl-kiB.js";import{b as G,I as F}from"./bandiService-CPkRW1ZN.js";import{a2 as v,R as _,i as A,a3 as Y,b as Q,a4 as y,k as V,a5 as T,M as z,a6 as W,a7 as J,W as C,h as K}from"./icons-Dvxa2Qho.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";const P=[{value:1,label:"1 giorno",short:"1g"},{value:3,label:"3 giorni",short:"3g"},{value:7,label:"1 settimana",short:"7g"},{value:14,label:"2 settimane",short:"14g"},{value:30,label:"1 mese",short:"30g"}];function oe(){const s=B(),{user:i}=q(),o=c.useRef(null),{scrollY:l}=I({container:o}),d=O(l,[0,60],[0,1]),[b,u]=c.useState(!0),[h,a]=c.useState([]),[m,D]=c.useState([]),[E,g]=c.useState(!1),[j,w]=c.useState({notify_days_before:7,notify_on_new:!0}),N=c.useCallback(async()=>{if(i){u(!0);try{const[t,n]=await Promise.all([p.from("user_bandi_alerts").select("*, category:bandi_categories(*)").eq("user_id",i.id).order("created_at",{ascending:!1}),G()]);t.data&&a(t.data),D(n)}catch(t){console.error("Error loading alerts:",t)}finally{u(!1)}}},[i]);c.useEffect(()=>{N()},[N]);const L=async t=>{const{error:n}=await p.from("user_bandi_alerts").update({is_active:!t.is_active}).eq("id",t.id);n||a(f=>f.map(x=>x.id===t.id?{...x,is_active:!x.is_active}:x))},$=async t=>{if(!confirm("Eliminare questo avviso?"))return;const{error:n}=await p.from("user_bandi_alerts").delete().eq("id",t);n||a(f=>f.filter(x=>x.id!==t))},H=async t=>{if(!i)return;const{data:n,error:f}=await p.from("user_bandi_alerts").insert({user_id:i.id,...t,is_active:!0}).select("*, category:bandi_categories(*)").single();!f&&n?(a(x=>[n,...x]),g(!1)):alert("Errore durante la creazione")};return i?e.jsxs("div",{className:"min-h-screen bg-canvas-light dark:bg-slate-950 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 bg-brand-cyan/10 rounded-full blur-3xl animate-float"}),e.jsx("div",{className:"absolute top-1/2 -left-20 w-72 h-72 bg-brand-blue/10 rounded-full blur-3xl animate-float",style:{animationDelay:"-2s"}}),e.jsx("div",{className:"absolute bottom-20 right-10 w-48 h-48 bg-brand-purple/10 rounded-full blur-3xl animate-float",style:{animationDelay:"-4s"}})]}),e.jsx(r.div,{style:{opacity:d},className:"fixed top-0 left-0 right-0 z-30 bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border-b border-slate-200/50 dark:border-slate-700/50",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 h-14 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>s(-1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors",children:e.jsx(_,{className:"w-5 h-5 text-slate-600 dark:text-slate-300"})}),e.jsx("span",{className:"font-semibold text-slate-900 dark:text-white",children:"Notifiche"})]})}),e.jsxs("div",{ref:o,className:"relative z-10 pb-24 safe-area-top",children:[e.jsx("div",{className:"px-4 pt-4 pb-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("button",{onClick:()=>s(-1),className:"p-2 hover:bg-white/50 dark:hover:bg-slate-800/50 rounded-xl transition-colors",children:e.jsx(_,{className:"w-5 h-5 text-slate-600 dark:text-slate-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Notifiche Bandi"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Ricevi aggiornamenti sui concorsi"})]}),e.jsx(r.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>g(!0),className:"p-3 bg-gradient-to-r from-brand-cyan to-brand-blue text-white rounded-2xl shadow-lg shadow-brand-cyan/30",children:e.jsx(A,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 space-y-6",children:[e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative overflow-hidden rounded-3xl bg-white dark:bg-slate-900/80 backdrop-blur-xl border border-slate-200/50 dark:border-slate-700/50 shadow-xl",children:[e.jsx("div",{className:"relative p-5 bg-gradient-to-r from-brand-cyan/10 via-brand-blue/5 to-transparent dark:from-brand-cyan/20 dark:via-brand-blue/10",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-[22%] bg-gradient-to-br from-brand-cyan to-brand-blue flex items-center justify-center shadow-lg shadow-brand-cyan/30",children:e.jsx(Y,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"Impostazioni Generali"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Valide per tutti i bandi salvati"})]})]})}),e.jsxs("div",{className:"p-5 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-semantic-success/10 flex items-center justify-center",children:e.jsx(Q,{className:"w-5 h-5 text-semantic-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-800 dark:text-white",children:"Nuovi bandi"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Notifica pubblicazioni"})]})]}),e.jsx(R,{checked:j.notify_on_new,onChange:()=>w(t=>({...t,notify_on_new:!t.notify_on_new}))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(y,{className:"w-4 h-4 text-brand-blue"}),e.jsx("p",{className:"font-semibold text-sm text-slate-700 dark:text-slate-300",children:"Promemoria scadenza"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(t=>e.jsx(r.button,{whileHover:{scale:1.03},whileTap:{scale:.97},onClick:()=>w(n=>({...n,notify_days_before:t.value})),className:`px-4 py-2 rounded-xl text-sm font-semibold transition-all ${j.notify_days_before===t.value?"bg-gradient-to-r from-brand-cyan to-brand-blue text-white shadow-lg shadow-brand-cyan/20":"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:t.label},t.value))})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-1",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:"Avvisi Personalizzati"}),e.jsxs("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:[h.length," ",h.length===1?"avviso":"avvisi"]})]}),b?e.jsx(Z,{}):h.length===0?e.jsx(X,{onCreateClick:()=>g(!0)}):e.jsx("div",{className:"space-y-3",children:e.jsx(k,{mode:"popLayout",children:h.map((t,n)=>e.jsx(U,{alert:t,index:n,onToggle:()=>L(t),onDelete:()=>$(t.id)},t.id))})})]})]})]}),e.jsx(k,{children:E&&e.jsx(ee,{categories:m,onSave:H,onClose:()=>g(!1)})})]}):e.jsx("div",{className:"min-h-screen bg-canvas-light dark:bg-slate-950 flex items-center justify-center p-6",children:e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center max-w-sm",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-[22%] bg-gradient-to-br from-brand-cyan/20 to-brand-blue/20 flex items-center justify-center",children:e.jsx(v,{className:"w-10 h-10 text-brand-cyan"})}),e.jsx("h2",{className:"text-2xl font-bold text-text-primary dark:text-white mb-2",children:"Accedi per continuare"}),e.jsx("p",{className:"text-text-secondary dark:text-slate-400 mb-6",children:"Crea avvisi personalizzati per non perdere nessun bando importante."}),e.jsx(M,{to:"/login",className:"inline-flex px-6 py-3 bg-gradient-to-r from-brand-cyan to-brand-blue text-white rounded-2xl font-semibold shadow-lg shadow-brand-cyan/20",children:"Accedi ora"})]})})}function R({checked:s,onChange:i}){return e.jsx("button",{onClick:i,className:`relative w-14 h-8 rounded-full transition-all duration-300 ${s?"bg-gradient-to-r from-brand-cyan to-brand-blue shadow-lg shadow-brand-cyan/30":"bg-slate-200 dark:bg-slate-700"}`,children:e.jsx(r.div,{layout:!0,transition:{type:"spring",stiffness:500,damping:30},className:`absolute top-1 w-6 h-6 rounded-full bg-white shadow-md flex items-center justify-center ${s?"left-7":"left-1"}`,children:s&&e.jsx(V,{className:"w-3.5 h-3.5 text-brand-cyan"})})})}function U({alert:s,index:i,onToggle:o,onDelete:l}){var d,b;return e.jsxs(r.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,x:-100,scale:.9},transition:{delay:i*.05},className:`relative overflow-hidden rounded-2xl bg-white dark:bg-slate-900/80 backdrop-blur-xl border transition-all ${s.is_active?"border-brand-cyan/30 shadow-lg shadow-brand-cyan/5":"border-slate-200/50 dark:border-slate-700/50 opacity-60"}`,children:[s.is_active&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-brand-cyan to-brand-blue"}),e.jsxs("div",{className:"p-4 pl-5 flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-[18%] flex items-center justify-center text-xl shrink-0 ${s.is_active?"bg-gradient-to-br from-brand-cyan/20 to-brand-blue/20":"bg-slate-100 dark:bg-slate-800"}`,children:((d=s.category)==null?void 0:d.icon)||"ðŸ“‹"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white truncate",children:((b=s.category)==null?void 0:b.name)||"Tutti i bandi"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-1.5",children:[s.region&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-0.5 bg-brand-blue/10 text-brand-blue rounded-lg font-medium",children:[e.jsx(z,{className:"w-3 h-3"}),s.region]}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-0.5 bg-brand-orange/10 text-brand-orange rounded-lg font-medium",children:[e.jsx(y,{className:"w-3 h-3"}),s.notify_days_before,"g prima"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(r.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:o,className:`p-2.5 rounded-xl transition-all ${s.is_active?"bg-brand-cyan/10 text-brand-cyan":"bg-slate-100 dark:bg-slate-800 text-slate-400"}`,children:s.is_active?e.jsx(v,{className:"w-5 h-5"}):e.jsx(T,{className:"w-5 h-5"})}),e.jsx(r.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:l,className:"p-2.5 rounded-xl text-semantic-error bg-semantic-error/10 hover:bg-semantic-error/20 transition-colors",children:e.jsx(W,{className:"w-5 h-5"})})]})]})]})}function X({onCreateClick:s}){return e.jsxs(r.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative overflow-hidden rounded-3xl bg-white dark:bg-slate-900/80 backdrop-blur-xl border border-dashed border-slate-300 dark:border-slate-700 p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-[22%] bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-800 dark:to-slate-700 flex items-center justify-center",children:e.jsx(T,{className:"w-8 h-8 text-slate-400"})}),e.jsx("h4",{className:"font-semibold text-slate-700 dark:text-slate-300 mb-1",children:"Nessun avviso personalizzato"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-5",children:"Crea avvisi per categorie o regioni specifiche"}),e.jsxs(r.button,{whileHover:{scale:1.03},whileTap:{scale:.97},onClick:s,className:"inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-brand-cyan to-brand-blue text-white rounded-xl font-semibold shadow-lg shadow-brand-cyan/20",children:[e.jsx(A,{className:"w-4 h-4"}),"Crea il primo avviso"]})]})}function Z(){return e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsx("div",{className:"h-20 rounded-2xl bg-slate-200/50 dark:bg-slate-800/50 animate-pulse"},s))})}function ee({categories:s,onSave:i,onClose:o}){const[l,d]=c.useState({category_id:"",region:"",notify_days_before:7,notify_on_new:!0,notify_on_update:!1}),[b,u]=c.useState(!1),h=async()=>{u(!0),await i({category_id:l.category_id||void 0,region:l.region||void 0,notify_days_before:l.notify_days_before,notify_on_new:l.notify_on_new,notify_on_update:l.notify_on_update}),u(!1)};return e.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",children:[e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:o}),e.jsxs(r.div,{initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:"relative bg-white dark:bg-slate-900 rounded-t-[28px] sm:rounded-3xl w-full sm:max-w-md max-h-[85vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"relative p-5 border-b border-slate-100 dark:border-slate-800",children:[e.jsx("div",{className:"w-10 h-1 bg-slate-200 dark:bg-slate-700 rounded-full mx-auto mb-4 sm:hidden"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-[18%] bg-gradient-to-br from-brand-cyan to-brand-blue flex items-center justify-center",children:e.jsx(v,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Nuovo Avviso"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Personalizza le tue notifiche"})]})]})]}),e.jsxs("div",{className:"p-5 space-y-5 overflow-y-auto max-h-[50vh]",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(J,{className:"w-4 h-4 text-brand-cyan"}),"Categoria"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:l.category_id,onChange:a=>d(m=>({...m,category_id:a.target.value})),className:"w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white appearance-none font-medium focus:ring-2 focus:ring-brand-cyan focus:border-transparent transition-all",children:[e.jsx("option",{value:"",children:"âœ¨ Tutte le categorie"}),s.map(a=>e.jsxs("option",{value:a.id,children:[a.icon," ",a.name]},a.id))]}),e.jsx(C,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(z,{className:"w-4 h-4 text-brand-blue"}),"Regione"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:l.region,onChange:a=>d(m=>({...m,region:a.target.value})),className:"w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white appearance-none font-medium focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",children:[e.jsx("option",{value:"",children:"ðŸ‡®ðŸ‡¹ Tutte le regioni"}),e.jsx("option",{value:"nazionale",children:"ðŸ›ï¸ Nazionale"}),F.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx(C,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3",children:[e.jsx(y,{className:"w-4 h-4 text-brand-orange"}),"Notifica prima della scadenza"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:P.map(a=>e.jsx(r.button,{type:"button",whileHover:{scale:1.03},whileTap:{scale:.97},onClick:()=>d(m=>({...m,notify_days_before:a.value})),className:`px-4 py-2 rounded-xl text-sm font-semibold transition-all ${l.notify_days_before===a.value?"bg-gradient-to-r from-brand-cyan to-brand-blue text-white shadow-md":"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300"}`,children:a.label},a.value))})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsx(S,{label:"Notifica nuovi bandi",description:"Quando viene pubblicato un bando",checked:l.notify_on_new,onChange:()=>d(a=>({...a,notify_on_new:!a.notify_on_new}))}),e.jsx(S,{label:"Notifica aggiornamenti",description:"Modifiche, proroghe, risultati",checked:l.notify_on_update,onChange:()=>d(a=>({...a,notify_on_update:!a.notify_on_update}))})]})]}),e.jsxs("div",{className:"p-5 border-t border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/50 flex gap-3 safe-area-bottom",children:[e.jsx("button",{onClick:o,className:"flex-1 py-3.5 border border-slate-200 dark:border-slate-700 rounded-2xl font-semibold text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:"Annulla"}),e.jsxs(r.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:h,disabled:b,className:"flex-1 py-3.5 bg-gradient-to-r from-brand-cyan to-brand-blue text-white rounded-2xl font-bold shadow-lg shadow-brand-cyan/30 disabled:opacity-50 flex items-center justify-center gap-2",children:[b&&e.jsx(K,{className:"w-4 h-4 animate-spin"}),"Crea Avviso"]})]})]})]})}function S({label:s,description:i,checked:o,onChange:l}){return e.jsxs("div",{onClick:l,className:`flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all ${o?"bg-brand-cyan/5 border border-brand-cyan/30":"bg-slate-50 dark:bg-slate-800 border border-transparent"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:s}),e.jsx("p",{className:"text-xs text-slate-500",children:i})]}),e.jsx(R,{checked:o,onChange:l})]})}export{oe as default};
