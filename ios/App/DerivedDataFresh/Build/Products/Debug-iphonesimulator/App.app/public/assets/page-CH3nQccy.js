import{j as e}from"./framer-BdaCTGm4.js";import{r as t,L as c}from"./router-ClfHAwMg.js";import{s as l}from"./index-DBMi1b3R.js";import{A as M}from"./AdminLayout-Bws632pn.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";import"./icons-DIoLbN6D.js";const p=x=>x.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"");function F(){const[x,R]=t.useState([]),[u,$]=t.useState([]),[y,I]=t.useState([]),[s,k]=t.useState(null),[o,f]=t.useState(null),[T,j]=t.useState(!0),[g,N]=t.useState(""),[w,h]=t.useState(""),[b,C]=t.useState(""),[_,v]=t.useState("");t.useEffect(()=>{d()},[]);const d=async()=>{j(!0);const[r,a,m]=await Promise.all([l.from("categories").select("*").order("title"),l.from("roles").select("*").order("order_index"),l.from("quizzes").select("id, title, slug, year, is_official, role_id").order("created_at",{ascending:!1})]);r.data&&R(r.data),a.data&&$(a.data),m.data&&I(m.data),j(!1)},A=async()=>{if(!g)return;const r=w||p(g),{error:a}=await l.from("categories").insert({title:g,slug:r});a?alert(a.message):(N(""),h(""),d())},D=async r=>{confirm("Cancella categoria e tutto il contenuto?")&&(await l.from("categories").delete().eq("id",r),s===r&&k(null),d())},E=async()=>{if(!b||!s)return;const r=_||p(b),{error:a}=await l.from("roles").insert({title:b,slug:r,category_id:s,order_index:u.filter(m=>m.category_id===s).length+1});a?alert(a.message):(C(""),v(""),d())},L=async r=>{confirm("Cancella ruolo?")&&(await l.from("roles").delete().eq("id",r),o===r&&f(null),d())},S=t.useMemo(()=>u.filter(r=>r.category_id===s),[u,s]),z=t.useMemo(()=>y.filter(r=>r.role_id===o),[y,o]),n=x.find(r=>r.id===s),i=u.find(r=>r.id===o);return T?e.jsx("div",{className:"p-8 text-center text-slate-400 animate-pulse",children:"Caricamento struttura..."}):e.jsxs(M,{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-black text-[var(--foreground)] tracking-tight",children:"Gestione Struttura"}),e.jsx("p",{className:"text-[var(--foreground)] opacity-50 text-sm mt-1",children:"Organizza categorie, ruoli e concorsi in una gerarchia chiara."})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 h-[calc(100vh-200px)]",children:[e.jsxs("div",{className:"flex flex-col bg-[var(--card)] border border-[var(--card-border)] rounded-[20px] shadow-[0_4px_16px_rgba(0,0,0,0.04)] overflow-hidden",children:[e.jsx("div",{className:"p-5 border-b border-[var(--card-border)] bg-slate-50/50 dark:bg-slate-900/50 flex justify-between items-center",children:e.jsxs("h2",{className:"font-bold text-[var(--foreground)] flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-lg bg-emerald-100 dark:bg-emerald-500/20 text-emerald-600 dark:text-emerald-400 flex items-center justify-center text-xs font-bold",children:"1"}),"Categorie"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:x.map(r=>e.jsxs("div",{onClick:()=>{k(r.id),f(null)},className:`p-4 rounded-2xl cursor-pointer border transition-all flex justify-between group ${s===r.id?"bg-emerald-50 dark:bg-emerald-500/10 border-emerald-200 dark:border-emerald-500/30 ring-1 ring-emerald-100 dark:ring-emerald-500/20 shadow-sm":"bg-slate-50/50 dark:bg-slate-900/50 border-transparent hover:bg-slate-100 dark:hover:bg-slate-800 hover:border-slate-200 dark:hover:border-slate-700"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:`font-semibold text-sm ${s===r.id?"text-emerald-700 dark:text-emerald-400":"text-[var(--foreground)] opacity-70"}`,children:r.title}),e.jsxs("div",{className:"text-[10px] text-[var(--foreground)] opacity-30 font-mono mt-0.5",children:["/",r.slug]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{to:`/admin/structure/categories/${r.id}`,className:"text-emerald-600 dark:text-emerald-400 hover:text-emerald-500 p-1.5 rounded-lg hover:bg-emerald-50 dark:hover:bg-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all text-xs font-bold",title:"Modifica Banner",children:"EDIT"}),e.jsx("button",{onClick:a=>{a.stopPropagation(),D(r.id)},className:"text-rose-500 opacity-0 group-hover:opacity-100 hover:text-rose-400 hover:bg-rose-50 dark:hover:bg-rose-500/10 p-1.5 rounded-lg transition-all",children:"Ã—"})]})]},r.id))}),e.jsx("div",{className:"p-4 border-t border-[var(--card-border)] bg-slate-50/30 dark:bg-slate-900/30 space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2.5 text-sm text-[var(--foreground)] placeholder:text-[var(--foreground)]/30 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all",placeholder:"Nuova Categoria...",value:g,onChange:r=>{N(r.target.value),h(p(r.target.value))}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"w-full bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2 text-xs text-[var(--foreground)] opacity-50 font-mono placeholder:text-[var(--foreground)]/30 focus:outline-none focus:border-slate-300 dark:focus:border-slate-600",placeholder:"slug-automatico",value:w,onChange:r=>h(r.target.value)}),e.jsx("button",{onClick:A,className:"bg-emerald-500 hover:bg-emerald-600 text-white p-2.5 rounded-xl shadow-sm transition-colors font-bold",children:"+"})]})]})})]}),e.jsxs("div",{className:`flex flex-col bg-[var(--card)] border border-[var(--card-border)] rounded-[20px] shadow-[0_4px_16px_rgba(0,0,0,0.04)] overflow-hidden transition-all duration-300 ${s?"opacity-100":"opacity-40 grayscale pointer-events-none"}`,children:[e.jsxs("div",{className:"p-5 border-b border-[var(--card-border)] bg-slate-50/50 dark:bg-slate-900/50 flex justify-between items-center",children:[e.jsxs("h2",{className:"font-bold text-[var(--foreground)] flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-lg bg-sky-100 dark:bg-sky-500/20 text-sky-600 dark:text-sky-400 flex items-center justify-center text-xs font-bold",children:"2"}),"Ruoli"]}),n&&e.jsx("span",{className:"text-[10px] bg-slate-100 dark:bg-slate-800 text-[var(--foreground)] opacity-60 font-medium px-2 py-1 rounded-full",children:n.title})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:[S.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 opacity-50",children:[e.jsx("span",{className:"text-2xl mb-2",children:"ðŸ‘¤"}),e.jsx("p",{className:"text-sm text-[var(--foreground)] opacity-50",children:"Nessun ruolo"})]}),S.map(r=>e.jsxs("div",{onClick:()=>f(r.id),className:`p-4 rounded-2xl cursor-pointer border transition-all flex justify-between group ${o===r.id?"bg-sky-50 dark:bg-sky-500/10 border-sky-200 dark:border-sky-500/30 ring-1 ring-sky-100 dark:ring-sky-500/20 shadow-sm":"bg-slate-50/50 dark:bg-slate-900/50 border-transparent hover:bg-slate-100 dark:hover:bg-slate-800 hover:border-slate-200 dark:hover:border-slate-700"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:`font-semibold text-sm ${o===r.id?"text-sky-700 dark:text-sky-400":"text-[var(--foreground)] opacity-70"}`,children:r.title}),e.jsxs("div",{className:"text-[10px] text-[var(--foreground)] opacity-30 font-mono mt-0.5",children:["/",r.slug]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{to:`/admin/structure/roles/${r.id}`,className:"text-sky-600 dark:text-sky-400 hover:text-sky-500 p-1.5 rounded-lg hover:bg-sky-50 dark:hover:bg-sky-500/10 opacity-0 group-hover:opacity-100 transition-all text-xs font-bold",title:"Modifica Info e Risorse",children:"EDIT"}),e.jsx("button",{onClick:a=>{a.stopPropagation(),L(r.id)},className:"text-rose-500 opacity-0 group-hover:opacity-100 hover:text-rose-400 hover:bg-rose-50 dark:hover:bg-rose-500/10 p-1.5 rounded-lg transition-all",children:"Ã—"})]})]},r.id))]}),e.jsx("div",{className:"p-4 border-t border-[var(--card-border)] bg-slate-50/30 dark:bg-slate-900/30 space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2.5 text-sm text-[var(--foreground)] placeholder:text-[var(--foreground)]/30 focus:outline-none focus:ring-2 focus:ring-sky-500/20 focus:border-sky-500 transition-all",placeholder:"Nuovo Ruolo...",value:b,onChange:r=>{C(r.target.value),v(p(r.target.value))}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-xs text-slate-500 font-mono placeholder:text-slate-400 focus:outline-none focus:border-slate-300",placeholder:"slug",value:_,onChange:r=>v(r.target.value)}),e.jsx("button",{onClick:E,className:"bg-sky-500 hover:bg-sky-600 text-white p-2.5 rounded-xl shadow-sm transition-colors font-bold",children:"+"})]})]})})]}),e.jsxs("div",{className:`flex flex-col bg-[var(--card)] border border-[var(--card-border)] rounded-[20px] shadow-[0_4px_16px_rgba(0,0,0,0.04)] overflow-hidden transition-all duration-300 ${o?"opacity-100":"opacity-40 grayscale pointer-events-none"}`,children:[e.jsxs("div",{className:"p-5 border-b border-[var(--card-border)] bg-slate-50/50 dark:bg-slate-900/50 flex justify-between items-center",children:[e.jsxs("h2",{className:"font-bold text-[var(--foreground)] flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-lg bg-amber-100 dark:bg-amber-500/20 text-amber-600 dark:text-amber-400 flex items-center justify-center text-xs font-bold",children:"3"}),"Concorsi"]}),i&&e.jsx("span",{className:"text-[10px] bg-slate-100 dark:bg-slate-800 text-[var(--foreground)] opacity-60 font-medium px-2 py-1 rounded-full",children:i.title})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:[z.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 opacity-50",children:[e.jsx("span",{className:"text-2xl mb-2",children:"ðŸ“š"}),e.jsx("p",{className:"text-sm text-[var(--foreground)] opacity-50",children:"Nessun concorso"})]}),z.map(r=>e.jsxs("div",{className:"p-4 rounded-2xl border border-slate-200 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50 shadow-sm flex flex-col gap-2 hover:border-amber-300 dark:hover:border-amber-500/30 hover:bg-amber-50/30 dark:hover:bg-amber-500/5 transition-all group",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-semibold text-sm text-[var(--foreground)] opacity-80 leading-tight group-hover:text-amber-700 dark:group-hover:text-amber-400 transition-colors",children:r.title}),r.year&&e.jsx("span",{className:"text-[10px] bg-slate-200 dark:bg-slate-800 text-[var(--foreground)] opacity-50 font-bold px-1.5 py-0.5 rounded-md",children:r.year})]}),e.jsxs("div",{className:"flex justify-between items-end mt-1",children:[e.jsx("span",{className:"text-[10px] text-[var(--foreground)] opacity-30 font-mono",children:r.slug||"no-slug"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{to:`/concorsi/${n==null?void 0:n.slug}/${i==null?void 0:i.slug}/${r.slug||r.id}`,target:"_blank",className:"text-[10px] text-emerald-600 dark:text-emerald-400 font-bold hover:underline bg-emerald-50 dark:bg-emerald-500/10 px-2 py-0.5 rounded-full border border-emerald-200 dark:border-emerald-500/20",children:"Preview â†—"}),e.jsx(c,{to:"/admin/quiz",className:"text-[10px] text-amber-600 dark:text-amber-400 font-bold hover:underline bg-amber-50 dark:bg-amber-500/10 px-2 py-0.5 rounded-full border border-amber-200 dark:border-amber-500/20",children:"Modifica"})]})]})]},r.id))]}),e.jsxs("div",{className:"p-4 border-t border-[var(--card-border)] bg-slate-50/30 dark:bg-slate-900/30",children:[e.jsx(c,{to:"/admin/quiz",children:e.jsx("button",{className:"w-full bg-white dark:bg-slate-900 hover:bg-slate-50 dark:hover:bg-slate-800 text-[var(--foreground)] opacity-70 border border-slate-200 dark:border-slate-700 text-xs py-3 rounded-xl font-bold transition-all shadow-sm",children:"Gestisci / Crea Concorsi"})}),e.jsx("p",{className:"text-[10px] text-[var(--foreground)] opacity-30 text-center mt-2 px-4",children:"Vai al pannello completo per creare concorsi e collegarli a questo ruolo."})]})]})]})]})}export{F as default};
