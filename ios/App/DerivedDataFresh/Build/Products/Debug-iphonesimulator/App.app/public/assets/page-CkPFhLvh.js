import{j as t}from"./framer-BdaCTGm4.js";import{u as B,r}from"./router-ClfHAwMg.js";import{s as i}from"./index-DBMi1b3R.js";import{S as D}from"./blog-CvfiCAga.js";import{A as P}from"./AdminLayout-Bws632pn.js";import{A as T}from"./AdminPageHeader-CVyPYYOb.js";import{A as z,E}from"./EmptyState-Br3Szc18.js";import{S as L}from"./StatusBadge-CYGANFXg.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";import"./icons-DIoLbN6D.js";function X(){const o=B(),[m,f]=r.useState([]),[p,x]=r.useState([]),[h,g]=r.useState(!0),[l,v]=r.useState("all"),[n,y]=r.useState("all"),[s,j]=r.useState("");r.useEffect(()=>{d()},[]);const d=async()=>{g(!0);const{data:e}=await i.from("blog_categories").select("*").order("sort_order");e&&x(e);const{data:a}=await i.from("blog_posts").select(`
                *,
                category:blog_categories(*),
                author:blog_authors(*)
            `).order("created_at",{ascending:!1});a&&f(a),g(!1)},w=m.filter(e=>!(l!=="all"&&e.status!==l||n!=="all"&&e.category_id!==n||s&&!e.title.toLowerCase().includes(s.toLowerCase()))),k=async(e,a)=>{confirm(`Sei sicuro di voler eliminare "${a}"?

Questa azione Ã¨ irreversibile!`)&&(await i.from("blog_posts").delete().eq("id",e),d())},c=async(e,a)=>{const u={status:a};a==="published"&&(u.published_at=new Date().toISOString()),await i.from("blog_posts").update(u).eq("id",e),d()},C=async e=>{const{id:a,created_at:u,updated_at:$,published_at:G,view_count:I,...F}=e,A={...F,title:`${e.title} (Copia)`,slug:`${e.slug}-copia-${Date.now()}`,status:"draft",is_featured:!1},{data:b}=await i.from("blog_posts").insert(A).select().single();b&&o(`/admin/blog/${b.id}`)},_=e=>e?new Date(e).toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric"}):"-",S=[{key:"title",label:"Titolo",render:e=>t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-[var(--foreground)]",children:e.title}),t.jsxs("div",{className:"text-xs text-[var(--foreground)] opacity-30 font-mono",children:["/blog/",e.slug]})]})},{key:"status",label:"Stato",width:"120px",render:e=>t.jsx(L,{label:D[e.status].label,variant:e.status==="published"?"success":e.status==="draft"?"neutral":e.status==="scheduled"?"info":"warning"})},{key:"category",label:"Categoria",width:"150px",render:e=>{var a;return t.jsx("span",{className:"text-sm text-[var(--foreground)] opacity-40",children:((a=e.category)==null?void 0:a.name)||"-"})}},{key:"date",label:"Data",width:"120px",render:e=>t.jsx("span",{className:"text-sm text-[var(--foreground)] opacity-40",children:_(e.published_at||e.created_at)})},{key:"views",label:"Views",width:"80px",align:"right",render:e=>t.jsx("span",{className:"text-sm text-[var(--foreground)] opacity-40 font-mono",children:e.view_count})}],N=e=>[{label:"Modifica",icon:"âœï¸",onClick:()=>o(`/admin/blog/${e.id}`)},{label:"Duplica",icon:"ðŸ“‹",onClick:()=>C(e)},...e.status==="published"?[{label:"Archivia",icon:"ðŸ“¦",onClick:()=>c(e.id,"archived")}]:e.status==="archived"?[{label:"Ripristina a Bozza",icon:"ðŸ“",onClick:()=>c(e.id,"draft")}]:[{label:"Pubblica",icon:"ðŸš€",onClick:()=>c(e.id,"published")}],{label:"Elimina",icon:"ðŸ—‘ï¸",onClick:()=>k(e.id,e.title),variant:"destructive"}];return t.jsxs(P,{children:[t.jsx(T,{title:"Blog - Articoli",subtitle:"Gestisci articoli, notizie e aggiornamenti",breadcrumb:[{label:"Admin",path:"/admin"},{label:"Blog"}],action:{label:"Nuovo Articolo",icon:"+",onClick:()=>o("/admin/blog/nuovo")}}),t.jsxs("div",{className:"flex gap-4 mb-6",children:[t.jsx("button",{onClick:()=>o("/admin/blog/categorie"),className:"px-4 py-2 bg-[var(--card)] hover:bg-slate-50 dark:hover:bg-slate-800 border border-[var(--card-border)] rounded-xl text-[var(--foreground)] opacity-70 text-sm font-medium transition-colors shadow-sm",children:"Gestisci Categorie"}),t.jsx("button",{onClick:()=>o("/admin/blog/tag"),className:"px-4 py-2 bg-[var(--card)] hover:bg-slate-50 dark:hover:bg-slate-800 border border-[var(--card-border)] rounded-xl text-[var(--foreground)] opacity-70 text-sm font-medium transition-colors shadow-sm",children:"Gestisci Tag"})]}),t.jsxs("div",{className:"mb-6 p-4 bg-[var(--card)] border border-[var(--card-border)] rounded-[20px] flex flex-col md:flex-row gap-4 shadow-[0_4px_16px_rgba(0,0,0,0.04)]",children:[t.jsx("div",{className:"flex-1",children:t.jsx("input",{type:"text",placeholder:"Cerca per titolo...",value:s,onChange:e=>j(e.target.value),className:"w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl text-[var(--foreground)] placeholder-[var(--foreground)]/30 focus:outline-none focus:ring-2 focus:ring-[#00B1FF]/50 focus:border-[#00B1FF]"})}),t.jsxs("select",{value:l,onChange:e=>v(e.target.value),className:"px-4 py-2.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl text-[var(--foreground)] opacity-70 focus:outline-none focus:ring-2 focus:ring-[#00B1FF]/50 focus:border-[#00B1FF]",children:[t.jsx("option",{value:"all",children:"Tutti gli stati"}),t.jsx("option",{value:"draft",children:"Bozze"}),t.jsx("option",{value:"scheduled",children:"Programmati"}),t.jsx("option",{value:"published",children:"Pubblicati"}),t.jsx("option",{value:"archived",children:"Archiviati"})]}),t.jsxs("select",{value:n,onChange:e=>y(e.target.value),className:"px-4 py-2.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl text-[var(--foreground)] opacity-70 focus:outline-none focus:ring-2 focus:ring-[#00B1FF]/50 focus:border-[#00B1FF]",children:[t.jsx("option",{value:"all",children:"Tutte le categorie"}),p.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),t.jsx(z,{columns:S,data:w,loading:h,rowKey:e=>e.id,rowActions:N,emptyState:t.jsx(E,{icon:"âœï¸",title:"Nessun articolo trovato",description:s?"Nessun articolo corrisponde ai criteri di ricerca.":"Inizia a scrivere il tuo primo articolo!",action:{label:"Scrivi articolo",onClick:()=>o("/admin/blog/nuovo")}})})]})}export{X as default};
