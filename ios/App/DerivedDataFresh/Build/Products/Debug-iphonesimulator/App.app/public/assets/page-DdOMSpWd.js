import{j as e}from"./framer-CcO5Kjcw.js";import{u as L,r as a,L as u}from"./router-ClfHAwMg.js";import{f as T,r as $,d as D,b as R,a as _,p as M,c as O}from"./adminBandiService-CBjgCHko.js";import{h as U,al as q,i as F,x as Q,am as G,ac as X,k as H,X as J,a6 as K}from"./icons-Dvxa2Qho.js";import"./react-vendor-B--z-fyW.js";import"./index-BcNl-kiB.js";import"./supabase-CIvuJI4W.js";const V={draft:"bg-slate-100 text-slate-600",review:"bg-amber-100 text-amber-700",published:"bg-emerald-100 text-emerald-700",closed:"bg-slate-200 text-slate-500",suspended:"bg-red-100 text-red-700"},W={draft:"Bozza",review:"In Revisione",published:"Pubblicato",closed:"Chiuso",suspended:"Sospeso"};function re(){L();const[i,j]=a.useState([]),[f,p]=a.useState(!0),[x,N]=a.useState(""),[m,y]=a.useState("all"),[l,n]=a.useState(new Set),[o,v]=a.useState(0),[d,b]=a.useState(0),[k,w]=a.useState(!1),[h,g]=a.useState(!1),c=50,S=async()=>{g(!0);try{const t=await $();alert(`Importazione completata!
Bandi importati: ${t.imported}
Errori: ${t.errors}`),r()}catch{alert("Errore durante l'esecuzione dell'agent")}finally{g(!1)}},r=a.useCallback(async()=>{p(!0);try{const{data:t,count:s}=await T({status:m,search:x||void 0,limit:c,offset:d*c});j(t),v(s)}catch(t){console.error("Error loading bandi:",t)}finally{p(!1)}},[m,x,d]);a.useEffect(()=>{r()},[r]),a.useEffect(()=>{w(l.size>0)},[l]);const C=()=>{l.size===i.length?n(new Set):n(new Set(i.map(t=>t.id)))},z=t=>{const s=new Set(l);s.has(t)?s.delete(t):s.add(t),n(s)},B=async t=>{if(confirm("Sei sicuro di voler eliminare questo bando?"))try{await D(t),r()}catch{alert("Errore durante l'eliminazione")}},A=async()=>{if(confirm(`Sei sicuro di voler eliminare ${l.size} bandi?`))try{await R(Array.from(l)),n(new Set),r()}catch{alert("Errore durante l'eliminazione")}},E=async()=>{try{await _(Array.from(l),"published"),n(new Set),r()}catch{alert("Errore durante la pubblicazione")}},I=async t=>{try{await M(t),r()}catch{alert("Errore durante la pubblicazione")}},P=async t=>{try{await O(t),r()}catch{alert("Errore durante la chiusura")}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Gestione Bandi"}),e.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[o," bandi totali"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:S,disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-indigo-500 text-white rounded-lg font-medium hover:bg-indigo-600 disabled:opacity-50",children:[h?e.jsx(U,{className:"w-4 h-4 animate-spin"}):e.jsx(q,{className:"w-4 h-4"}),h?"Import in corso...":"Auto Import Agent"]}),e.jsxs(u,{to:"/admin/bandi/nuovo",className:"flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-lg font-medium hover:bg-emerald-600",children:[e.jsx(F,{className:"w-4 h-4"}),"Nuovo Bando"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 mb-4 flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",value:x,onChange:t=>N(t.target.value),placeholder:"Cerca bandi...",className:"w-full pl-10 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-transparent"})]}),e.jsxs("select",{value:m,onChange:t=>y(t.target.value),className:"px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800",children:[e.jsx("option",{value:"all",children:"Tutti gli stati"}),e.jsx("option",{value:"draft",children:"Bozza"}),e.jsx("option",{value:"review",children:"In Revisione"}),e.jsx("option",{value:"published",children:"Pubblicati"}),e.jsx("option",{value:"closed",children:"Chiusi"})]})]}),k&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 rounded-xl p-3 mb-4 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:[l.size," selezionati"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:E,className:"px-3 py-1.5 bg-emerald-500 text-white rounded-lg text-sm font-medium",children:"Pubblica"}),e.jsx("button",{onClick:A,className:"px-3 py-1.5 bg-red-500 text-white rounded-lg text-sm font-medium",children:"Elimina"}),e.jsx("button",{onClick:()=>n(new Set),className:"px-3 py-1.5 bg-slate-200 dark:bg-slate-700 rounded-lg text-sm",children:"Annulla"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl overflow-hidden",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:l.size===i.length&&i.length>0,onChange:C,className:"rounded"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-500",children:"Titolo"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-500",children:"Ente"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-500",children:"Scadenza"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-500",children:"Stato"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-500",children:"Posti"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-slate-500",children:"Azioni"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-slate-500",children:"Caricamento..."})}):i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-slate-500",children:"Nessun bando trovato"})}):i.map(t=>{var s;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:l.has(t.id),onChange:()=>z(t.id),className:"rounded"})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white line-clamp-1",children:t.title}),e.jsx("div",{className:"text-xs text-slate-400",children:t.slug})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-300",children:((s=t.ente)==null?void 0:s.name)||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-300",children:new Date(t.deadline).toLocaleDateString("it-IT")}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex px-2 py-1 rounded-lg text-xs font-medium ${V[t.status]}`,children:W[t.status]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-300",children:t.seats_total||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(u,{to:`/bandi/${t.slug}`,target:"_blank",className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-600 rounded-lg",title:"Anteprima",children:e.jsx(G,{className:"w-4 h-4 text-slate-400"})}),e.jsx(u,{to:`/admin/bandi/${t.id}`,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-600 rounded-lg",title:"Modifica",children:e.jsx(X,{className:"w-4 h-4 text-slate-400"})}),t.status==="draft"&&e.jsx("button",{onClick:()=>I(t.id),className:"p-2 hover:bg-emerald-100 dark:hover:bg-emerald-500/20 rounded-lg",title:"Pubblica",children:e.jsx(H,{className:"w-4 h-4 text-emerald-500"})}),t.status==="published"&&e.jsx("button",{onClick:()=>P(t.id),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-600 rounded-lg",title:"Chiudi",children:e.jsx(J,{className:"w-4 h-4 text-slate-400"})}),e.jsx("button",{onClick:()=>B(t.id),className:"p-2 hover:bg-red-100 dark:hover:bg-red-500/20 rounded-lg",title:"Elimina",children:e.jsx(K,{className:"w-4 h-4 text-red-400"})})]})})]},t.id)})})]}),o>c&&e.jsxs("div",{className:"px-4 py-3 border-t border-slate-100 dark:border-slate-700 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-slate-500",children:["Pagina ",d+1," di ",Math.ceil(o/c)]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(t=>Math.max(0,t-1)),disabled:d===0,className:"px-3 py-1 rounded border border-slate-200 dark:border-slate-600 disabled:opacity-50",children:"Precedente"}),e.jsx("button",{onClick:()=>b(t=>t+1),disabled:(d+1)*c>=o,className:"px-3 py-1 rounded border border-slate-200 dark:border-slate-600 disabled:opacity-50",children:"Successiva"})]})]})]})]})}export{re as default};
