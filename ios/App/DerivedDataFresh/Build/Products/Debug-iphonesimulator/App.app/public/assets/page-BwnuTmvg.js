import{j as e}from"./framer-CcO5Kjcw.js";import{r as i}from"./router-ClfHAwMg.js";import{g as N,j as v,k}from"./adminBandiService-DeXwNcbQ.js";import{s as w}from"./index-Z19V86or.js";import{i as C,h as p,ao as y,ac as S,a6 as E,X as _}from"./icons-Dvxa2Qho.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";function O(){const[s,c]=i.useState([]),[u,n]=i.useState(!0),[r,d]=i.useState(!1),[m,x]=i.useState(null),[h,t]=i.useState(!1),l=i.useCallback(async()=>{n(!0);const a=await N();c(a),n(!1)},[]);i.useEffect(()=>{l()},[l]);const f=async a=>{if(confirm("Sei sicuro di voler eliminare questa categoria? I bandi associati perderanno il riferimento."))try{const{error:o}=await w.from("bandi_categories").delete().eq("id",a);if(o)throw o;l()}catch{alert("Errore durante l'eliminazione")}},g=a=>{x(a),d(!0)},b=()=>{x(null),d(!0)},j=async a=>{t(!0);try{m?await v(m.id,a):await k(a),d(!1),l()}catch{alert("Errore durante il salvataggio")}finally{t(!1)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Categorie Bandi"}),e.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[s.length," categorie"]})]}),e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-lg font-medium hover:bg-emerald-600",children:[e.jsx(C,{className:"w-4 h-4"}),"Nuova Categoria"]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl overflow-hidden",children:u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(p,{className:"w-8 h-8 animate-spin text-emerald-500"})}):s.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-500",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-3 text-slate-300"}),e.jsx("p",{children:"Nessuna categoria creata"}),e.jsx("button",{onClick:b,className:"mt-4 text-emerald-500 font-medium hover:underline",children:"Crea la prima categoria"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-500 w-12",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-500",children:"Nome"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-500",children:"Slug"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-500",children:"Icona"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-500",children:"Colore"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-slate-500",children:"Azioni"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:s.map((a,o)=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-400",children:a.sort_order||o+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white text-sm",style:{backgroundColor:a.color||"#6366f1"},children:a.icon||"ðŸ“"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:a.name})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-500 font-mono",children:a.slug}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-500",children:a.icon||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:a.color||"#6366f1"}}),e.jsx("span",{className:"text-sm text-slate-500 font-mono",children:a.color||"-"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx("button",{onClick:()=>g(a),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-600 rounded-lg",children:e.jsx(S,{className:"w-4 h-4 text-slate-400"})}),e.jsx("button",{onClick:()=>f(a.id),className:"p-2 hover:bg-red-100 dark:hover:bg-red-500/20 rounded-lg",children:e.jsx(E,{className:"w-4 h-4 text-red-400"})})]})})]},a.id))})]})}),r&&e.jsx(A,{category:m,saving:h,onSave:j,onClose:()=>d(!1)})]})}function A({category:s,saving:c,onSave:u,onClose:n}){const[r,d]=i.useState({name:(s==null?void 0:s.name)||"",slug:(s==null?void 0:s.slug)||"",icon:(s==null?void 0:s.icon)||"",color:(s==null?void 0:s.color)||"#6366f1",sort_order:(s==null?void 0:s.sort_order)||0}),m=t=>{if(t.preventDefault(),!r.name){alert("Il nome Ã¨ obbligatorio");return}r.slug||(r.slug=r.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")),u(r)},x=["#ef4444","#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899"],h=["ðŸ›ï¸","ðŸ‘®","ðŸŽ–ï¸","âš–ï¸","ðŸ¥","ðŸ“š","ðŸŽ“","ðŸ¢","ðŸŒ","ðŸ’¼","ðŸ”¬","ðŸ“Š","ðŸš—","âœˆï¸","ðŸš‚","ðŸ—ï¸"];return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:n}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-800 rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-800 p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:s?"Modifica Categoria":"Nuova Categoria"}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx(_,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("form",{onSubmit:m,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:r.name,onChange:t=>d(l=>({...l,name:t.target.value})),required:!0,placeholder:"Es: Forze Armate",className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Slug"}),e.jsx("input",{type:"text",value:r.slug,onChange:t=>d(l=>({...l,slug:t.target.value})),placeholder:"Autogenerato se vuoto",className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-900 font-mono text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Icona"}),e.jsx("div",{className:"grid grid-cols-8 gap-2 mb-2",children:h.map(t=>e.jsx("button",{type:"button",onClick:()=>d(l=>({...l,icon:t})),className:`w-9 h-9 rounded-lg text-xl flex items-center justify-center transition-all ${r.icon===t?"bg-slate-200 dark:bg-slate-600 ring-2 ring-emerald-500":"bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:t},t))}),e.jsx("input",{type:"text",value:r.icon,onChange:t=>d(l=>({...l,icon:t.target.value})),placeholder:"Emoji o testo",className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Colore"}),e.jsx("div",{className:"grid grid-cols-8 gap-2 mb-2",children:x.map(t=>e.jsx("button",{type:"button",onClick:()=>d(l=>({...l,color:t})),className:`w-9 h-9 rounded-lg transition-all ${r.color===t?"ring-2 ring-offset-2 ring-slate-400":""}`,style:{backgroundColor:t}},t))}),e.jsx("input",{type:"color",value:r.color,onChange:t=>d(l=>({...l,color:t.target.value})),className:"w-full h-10 rounded-lg border border-slate-200 dark:border-slate-600 cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Ordine"}),e.jsx("input",{type:"number",value:r.sort_order,onChange:t=>d(l=>({...l,sort_order:parseInt(t.target.value)||0})),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-900"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"flex-1 py-2 px-4 border border-slate-200 dark:border-slate-600 rounded-lg font-medium",children:"Annulla"}),e.jsxs("button",{type:"submit",disabled:c,className:"flex-1 py-2 px-4 bg-emerald-500 text-white rounded-lg font-medium hover:bg-emerald-600 disabled:opacity-50 flex items-center justify-center gap-2",children:[c&&e.jsx(p,{className:"w-4 h-4 animate-spin"}),"Salva"]})]})]})]})]})}export{O as default};
