import{j as e}from"./framer-CcO5Kjcw.js";import{r as i}from"./router-ClfHAwMg.js";import{e as k,l as y,m as E,n as S}from"./adminBandiService-CBjgCHko.js";import{I as C}from"./bandiService-CPkRW1ZN.js";import{i as z,x as L,h as p,B as A,M,a1 as P,ac as _,a6 as I,X as T}from"./icons-Dvxa2Qho.js";import"./react-vendor-B--z-fyW.js";import"./index-BcNl-kiB.js";import"./supabase-CIvuJI4W.js";const D=[{value:"comune",label:"Comune"},{value:"provincia",label:"Provincia"},{value:"regione",label:"Regione"},{value:"ministero",label:"Ministero"},{value:"forze_armate",label:"Forze Armate"},{value:"forze_ordine",label:"Forze dell'Ordine"},{value:"universita",label:"Università"},{value:"asl",label:"ASL/Azienda Sanitaria"},{value:"agenzia",label:"Agenzia"},{value:"ente_pubblico",label:"Ente Pubblico"},{value:"altro",label:"Altro"}];function X(){const[a,c]=i.useState([]),[x,o]=i.useState(!0),[r,d]=i.useState(""),[u,s]=i.useState(!1),[t,b]=i.useState(null),[v,h]=i.useState(!1),m=i.useCallback(async()=>{o(!0);const l=await k();c(l),o(!1)},[]);i.useEffect(()=>{m()},[m]);const g=r?a.filter(l=>{var n;return l.name.toLowerCase().includes(r.toLowerCase())||((n=l.slug)==null?void 0:n.toLowerCase().includes(r.toLowerCase()))}):a,f=async l=>{if(confirm("Sei sicuro di voler eliminare questo ente? I bandi associati perderanno il riferimento."))try{await y(l),m()}catch{alert("Errore durante l'eliminazione")}},j=l=>{b(l),s(!0)},N=()=>{b(null),s(!0)},w=async l=>{h(!0);try{t?await E(t.id,l):await S(l),s(!1),m()}catch{alert("Errore durante il salvataggio")}finally{h(!1)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Gestione Enti"}),e.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[a.length," enti totali"]})]}),e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-4 py-2 bg-emerald-500 text-white rounded-lg font-medium hover:bg-emerald-600",children:[e.jsx(z,{className:"w-4 h-4"}),"Nuovo Ente"]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",value:r,onChange:l=>d(l.target.value),placeholder:"Cerca enti...",className:"w-full pl-10 pr-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-transparent"})]})}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:x?e.jsx("div",{className:"col-span-full flex items-center justify-center py-12",children:e.jsx(p,{className:"w-8 h-8 animate-spin text-emerald-500"})}):g.length===0?e.jsx("div",{className:"col-span-full text-center py-12 text-slate-500",children:"Nessun ente trovato"}):g.map(l=>{var n;return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 flex flex-col",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-700 flex items-center justify-center shrink-0",children:e.jsx(A,{className:"w-5 h-5 text-slate-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white truncate",children:l.name}),e.jsx("p",{className:"text-xs text-slate-400",children:l.slug})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 mb-4",children:[e.jsx("span",{className:"capitalize",children:(n=l.type)==null?void 0:n.replace("_"," ")}),l.region&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),l.region]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-auto",children:[l.website&&e.jsx("a",{href:l.website,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx(P,{className:"w-4 h-4 text-slate-400"})}),e.jsx("button",{onClick:()=>j(l),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx(_,{className:"w-4 h-4 text-slate-400"})}),e.jsx("button",{onClick:()=>f(l.id),className:"p-2 hover:bg-red-100 dark:hover:bg-red-500/20 rounded-lg",children:e.jsx(I,{className:"w-4 h-4 text-red-400"})})]})]},l.id)})}),u&&e.jsx(R,{ente:t,saving:v,onSave:w,onClose:()=>s(!1)})]})}function R({ente:a,saving:c,onSave:x,onClose:o}){const[r,d]=i.useState({name:(a==null?void 0:a.name)||"",slug:(a==null?void 0:a.slug)||"",type:(a==null?void 0:a.type)||"",region:(a==null?void 0:a.region)||"",province:(a==null?void 0:a.province)||"",city:(a==null?void 0:a.city)||"",website:(a==null?void 0:a.website)||""}),u=s=>{if(s.preventDefault(),!r.name){alert("Il nome è obbligatorio");return}x(r)};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:o}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-800 rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-800 p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:a?"Modifica Ente":"Nuovo Ente"}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:e.jsx(T,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("form",{onSubmit:u,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nome *"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>d(t=>({...t,name:s.target.value})),required:!0,className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Tipo"}),e.jsxs("select",{value:r.type,onChange:s=>d(t=>({...t,type:s.target.value})),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-900",children:[e.jsx("option",{value:"",children:"Seleziona..."}),D.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Regione"}),e.jsxs("select",{value:r.region,onChange:s=>d(t=>({...t,region:s.target.value})),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-900",children:[e.jsx("option",{value:"",children:"Seleziona..."}),C.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Città"}),e.jsx("input",{type:"text",value:r.city,onChange:s=>d(t=>({...t,city:s.target.value})),className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-900"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Sito Web"}),e.jsx("input",{type:"url",value:r.website,onChange:s=>d(t=>({...t,website:s.target.value})),placeholder:"https://...",className:"w-full px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-900"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 py-2 px-4 border border-slate-200 dark:border-slate-600 rounded-lg font-medium",children:"Annulla"}),e.jsxs("button",{type:"submit",disabled:c,className:"flex-1 py-2 px-4 bg-emerald-500 text-white rounded-lg font-medium hover:bg-emerald-600 disabled:opacity-50 flex items-center justify-center gap-2",children:[c&&e.jsx(p,{className:"w-4 h-4 animate-spin"}),"Salva"]})]})]})]})]})}export{X as default};
