import{j as e}from"./framer-BdaCTGm4.js";import{u as S,r as c,L as z}from"./router-ClfHAwMg.js";import{s as b}from"./index-BBBGEo7o.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";import"./icons-ByDj-hsa.js";function F(){const g=S(),[p,l]=c.useState(!0),[x,f]=c.useState([]),[m,h]=c.useState({totalTests:0,avgScore:0,avgAccuracy:0,totalTime:0}),[u,v]=c.useState([]);c.useEffect(()=>{j()},[]);const j=async()=>{l(!0);const{data:{user:t}}=await b.auth.getUser();if(!t){l(!1);return}const{data:s,error:d}=await b.from("quiz_attempts").select("*, quiz:quizzes(title)").eq("user_id",t.id).order("created_at",{ascending:!1});d?console.error(d):s&&N(s),l(!1)},N=t=>{f(t);const s=t.length,d=t.reduce((a,r)=>a+(r.score||0),0);let n=0;const y=t.reduce((a,r)=>r.total_questions?(n++,a+(r.correct||0)/r.total_questions):a,0);h({totalTests:s,avgScore:s?d/s:0,avgAccuracy:n?y/n*100:0,totalTime:0});const o={};t.forEach(a=>{Array.isArray(a.answers)&&a.answers.forEach(r=>{const i=r.subjectName||"Altro";o[i]||(o[i]={correct:0,total:0}),o[i].total++,r.isCorrect&&o[i].correct++})});const k=Object.entries(o).map(([a,r])=>({name:a,count:r.total,accuracy:r.correct/r.total*100})).sort((a,r)=>r.accuracy-a.accuracy);v(k)};return p?e.jsx("div",{className:"p-8 text-center",children:"Caricamento statistiche..."}):e.jsxs("div",{className:"min-h-screen bg-[var(--background)] text-[var(--foreground)] pb-20 transition-colors duration-500",children:[e.jsxs("div",{className:"bg-[var(--card)] px-6 py-6 rounded-b-3xl shadow-sm mb-6 border-b border-[var(--card-border)]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--foreground)]",children:"Le mie Statistiche"}),e.jsx("button",{onClick:()=>g("/"),className:"text-sm font-bold text-[var(--foreground)] opacity-50",children:"Chiudi"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-2xl border border-indigo-100 dark:border-indigo-800/30",children:[e.jsx("p",{className:"text-xs text-indigo-400 font-bold uppercase mb-1",children:"Test Completati"}),e.jsx("p",{className:"text-3xl font-black text-indigo-900 dark:text-indigo-300",children:m.totalTests})]}),e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-2xl border border-emerald-100 dark:border-emerald-800/30",children:[e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-bold uppercase mb-1",children:"Accuratezza Media"}),e.jsxs("p",{className:"text-3xl font-black text-emerald-900 dark:text-emerald-300",children:[m.avgAccuracy.toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"px-6 space-y-8",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"font-bold text-lg mb-4",children:"Punti di Forza e Debolezza"}),e.jsxs("div",{className:"space-y-3",children:[u.slice(0,5).map((t,s)=>e.jsxs("div",{className:"bg-[var(--card)] p-3 rounded-xl border border-[var(--card-border)] flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-[var(--foreground)]",children:t.name}),e.jsxs("p",{className:"text-[10px] text-[var(--foreground)] opacity-40",children:[t.count," domande"]})]}),e.jsxs("div",{className:`px-3 py-1 rounded-lg text-xs font-bold ${t.accuracy>70?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":t.accuracy<50?"bg-rose-100 dark:bg-rose-900/30 text-rose-700 dark:text-rose-400":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"}`,children:[t.accuracy.toFixed(0),"%"]})]},s)),u.length===0&&e.jsx("p",{className:"text-sm text-slate-400 italic",children:"Completa dei test per vedere i dati."})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"font-bold text-lg mb-4",children:"Cronologia"}),e.jsxs("div",{className:"space-y-3",children:[x.map(t=>{var s;return e.jsxs(z,{to:`/quiz/results/${t.id}`,className:"block bg-[var(--card)] p-4 rounded-xl border border-[var(--card-border)] hover:border-[#00B1FF] transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-sm text-[var(--foreground)]",children:((s=t.quiz)==null?void 0:s.title)||"Test"}),e.jsx("span",{className:"text-[10px] text-[var(--foreground)] opacity-40",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsxs("div",{className:"text-xs text-[var(--foreground)] opacity-50",children:["Punteggio: ",e.jsx("span",{className:"text-[var(--foreground)] font-bold",children:t.score.toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-[var(--foreground)] opacity-50",children:[t.correct,"/",t.total_questions]})]})]},t.id)}),x.length===0&&e.jsx("p",{className:"text-sm text-slate-400 italic",children:"Nessun test completato."})]})]})]})]})}export{F as default};
