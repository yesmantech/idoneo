import{j as e,m as O,A as ve}from"./framer-BdaCTGm4.js";import{r as d,u as V,L as je,b as ye}from"./router-ClfHAwMg.js";import{T as Ne}from"./TierSLoader-BJdwavnO.js";import{s as D}from"./index-BBBGEo7o.js";import{a as we,c as ke,b as Se,g as Ce}from"./statsService-COWP9RuX.js";import{R as ae,m as Y,E as re,w as I,a3 as le,O as X,X as Z,aG as ze,ag as $e,b as _e,s as K,Z as Te,aH as Fe,j as ee,y as oe,as as qe,N as De,q as Ie,l as Me}from"./icons-ByDj-hsa.js";import{A as Pe}from"./AttemptCard-BK0w5vjJ.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";function Ae({totalTests:t,bestScore:x,avgScore:g,accuracy:n,maxPossibleScore:c=100,scoreTrend:i,accuracyTrend:p,readiness:a,onOpenInfo:f}){const[r,o]=d.useState(null),s=V(),b={tests:{title:"Simulazioni fatte",description:"Indica il numero totale di simulazioni d'esame che hai completato per questo concorso.",icon:e.jsx(ae,{className:"w-6 h-6"}),color:"text-brand-purple bg-brand-purple/10"},best:{title:"Miglior Risultato",description:"Il punteggio piÃ¹ alto che hai ottenuto in una singola simulazione, rapportato al punteggio massimo possibile.",icon:e.jsx(Y,{className:"w-6 h-6"}),color:"text-brand-orange bg-brand-orange/10"},avg:{title:"Punti su 100",description:"La tua media dei voti normalizzata su una scala da 0 a 100, per darti un'idea chiara del tuo livello medio.",icon:e.jsx(re,{className:"w-6 h-6"}),color:"text-brand-blue bg-brand-blue/10"},accuracy:{title:"Risposte corrette",description:"La percentuale media di risposte esatte che dai durante i test. PiÃ¹ Ã¨ alta, piÃ¹ sei preciso.",icon:e.jsx(I,{className:"w-6 h-6"}),color:"text-semantic-success bg-semantic-success/10"}},u=()=>{var j,$,h,w;if(!a)s("/preparazione?hasData=false&level=low&score=0");else{const N=new URLSearchParams({hasData:"true",level:a.level,score:String(a.score||0),accuracy:String(((j=a.breakdown)==null?void 0:j.accuracy)||0),volume:String((($=a.breakdown)==null?void 0:$.volume)||0),coverage:String(((h=a.breakdown)==null?void 0:h.coverage)||0),reliability:String(((w=a.breakdown)==null?void 0:w.reliability)||0)});s(`/preparazione?${N.toString()}`)}};return e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(U,{icon:e.jsx(ae,{className:"w-5 h-5 text-brand-purple"}),iconBg:"bg-brand-purple/10",badgeColor:"bg-brand-purple/10 text-brand-purple",label:"Test fatti",value:t.toString(),subLabel:"Simulazioni fatte",onInfo:()=>o(b.tests)}),e.jsx(U,{icon:e.jsx(Y,{className:"w-5 h-5 text-brand-orange"}),iconBg:"bg-brand-orange/10",badgeColor:"bg-brand-orange/10 text-brand-orange",label:"Miglior voto",value:`${x.toFixed(0)}/${c}`,subLabel:"Miglior Risultato",onInfo:()=>o(b.best)}),e.jsx(U,{icon:e.jsx(re,{className:"w-5 h-5 text-brand-blue"}),iconBg:"bg-brand-blue/10",badgeColor:"bg-brand-blue/10 text-brand-blue",label:"Media voto",value:g.toFixed(1),subLabel:"Punti su 100",onInfo:()=>o(b.avg)}),e.jsx(U,{icon:e.jsx(I,{className:"w-5 h-5 text-semantic-success"}),iconBg:"bg-semantic-success/10",badgeColor:"bg-semantic-success/10 text-semantic-success",label:"Accuratezza",value:`${n.toFixed(0)}%`,subLabel:"Risposte corrette",onInfo:()=>o(b.accuracy)})]}),a&&e.jsxs("div",{onClick:u,className:"group relative bg-[var(--card)] p-6 rounded-[32px] shadow-soft flex items-center justify-between overflow-hidden border border-[var(--card-border)] cursor-pointer hover:border-[#00B1FF]/30 transition-all",children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-gradient-to-bl from-[#00B1FF] to-emerald-500 opacity-[0.05] rounded-bl-[100px] pointer-events-none"}),e.jsxs("div",{className:"flex-1 pr-4 z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`px-2.5 py-0.5 rounded-full text-[10px] font-black uppercase tracking-wider ${a.level==="high"?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400":a.level==="medium"?"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400":"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400"}`,children:a.label}),e.jsx("div",{className:"w-4 h-4 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400",children:e.jsx(le,{className:"w-2.5 h-2.5"})})]}),e.jsx("h3",{className:"text-xl font-black text-[var(--foreground)] mb-1 leading-tight",children:a.level==="high"?"Sei pronto!":a.level==="medium"?"A buon punto":"Sei all'inizio"}),e.jsx("p",{className:"text-[14px] text-slate-500 dark:text-slate-400 leading-snug",children:a.level==="high"?"Ottima costanza. Sei pronto per la prova ufficiale.":a.level==="medium"?"Continua cosÃ¬, manca poco per l'eccellenza.":"Serve piÃ¹ allenamento. Non mollare!"})]}),e.jsxs("div",{className:"relative w-20 h-20 flex-shrink-0 flex items-center justify-center z-10",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"40",cy:"40",r:"32",stroke:"currentColor",strokeWidth:"6",fill:"transparent",className:"text-slate-100 dark:text-slate-800"}),e.jsx(O.circle,{initial:{strokeDasharray:200,strokeDashoffset:200},animate:{strokeDashoffset:200-(a.score!==void 0?a.score:a.level==="high"?92:a.level==="medium"?65:35)/100*200},transition:{duration:1.5,ease:"easeOut"},cx:"40",cy:"40",r:"32",stroke:a.level==="high"?"#10B981":a.level==="medium"?"#F59E0B":"#EF4444",strokeWidth:"6",strokeLinecap:"round",fill:"transparent"})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:a.score!==void 0?e.jsx("span",{className:`text-lg font-black ${a.level==="high"?"text-emerald-600":a.level==="medium"?"text-amber-600":"text-red-600"}`,children:Math.round(a.score)}):e.jsx(e.Fragment,{children:a.level==="high"?e.jsx(Y,{className:"w-6 h-6 text-emerald-600 dark:text-emerald-400"}):a.level==="medium"?e.jsx(X,{className:"w-6 h-6 text-amber-600 dark:text-amber-400"}):e.jsx(I,{className:"w-6 h-6 text-red-600 dark:text-red-400"})})})]})]}),e.jsx(ve,{children:r&&e.jsxs("div",{className:"fixed inset-0 z-[110] flex items-center justify-center p-6",children:[e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>o(null),className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm"}),e.jsxs(O.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},className:"relative bg-[var(--card)] border border-[var(--card-border)] rounded-[32px] p-8 max-w-xs w-full shadow-2xl text-center overflow-y-auto max-h-[90vh] custom-scrollbar",children:[e.jsx("button",{onClick:()=>o(null),className:"absolute top-4 right-4 p-2 bg-slate-100 dark:bg-slate-800 rounded-full text-[var(--foreground)] opacity-40 hover:opacity-100 transition-colors",children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("div",{className:`w-16 h-16 rounded-[22px] ${r.color} flex items-center justify-center mx-auto mb-5`,children:r.icon}),e.jsx("h3",{className:"text-xl font-black text-[var(--foreground)] mb-2",children:r.title}),e.jsx("p",{className:"text-[var(--foreground)] opacity-50 text-sm font-medium leading-relaxed",children:r.description}),e.jsx("button",{onClick:()=>o(null),className:"w-full mt-8 py-3 bg-[var(--foreground)] text-[var(--background)] rounded-2xl font-bold hover:opacity-90 transition-opacity",children:"Ho capito"})]})]})})]})}function U({icon:t,iconBg:x,badgeColor:g,label:n,value:c,subLabel:i,onInfo:p}){return e.jsxs("div",{onClick:p,className:"bg-[var(--card)] p-4 rounded-[24px] shadow-soft border border-[var(--card-border)] hover:shadow-card transition-all duration-300 group flex flex-col justify-between h-[150px] relative overflow-hidden cursor-pointer active:scale-95",children:[e.jsx("div",{className:"flex justify-between items-start z-10 relative",children:e.jsx("div",{className:`w-10 h-10 rounded-[14px] flex items-center justify-center ${x} transition-transform group-hover:scale-110 duration-300`,children:t})}),e.jsxs("div",{className:"z-10 relative",children:[e.jsx("div",{className:"text-[32px] font-black text-[var(--foreground)] leading-none tracking-tight mb-1",children:c}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-[11px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-wide",children:i}),e.jsx("button",{onClick:a=>{a.stopPropagation(),p()},className:"p-1.5 rounded-full bg-slate-50 dark:bg-slate-800 text-[var(--foreground)] opacity-20 hover:opacity-100 hover:text-brand-blue hover:bg-brand-blue/5 transition-all",children:e.jsx(le,{className:"w-3.5 h-3.5"})})]})]})]})}function Re({data:t}){if(t.length<3)return e.jsx(Be,{data:t});const x=300,g=x/2,n=x/2-40,c=t.length,i=(r,o)=>{const s=Math.PI*2*o/c-Math.PI/2,b=g+n*(r/100)*Math.cos(s),u=g+n*(r/100)*Math.sin(s);return{x:b,y:u}},p=t.map((r,o)=>{const{x:s,y:b}=i(r.accuracy,o);return`${s},${b}`}).join(" "),a=t.map((r,o)=>{const{x:s,y:b}=i(100,o),u=Math.PI*2*o/c-Math.PI/2,j=g+(n+20)*Math.cos(u),$=g+(n+20)*Math.sin(u);return{x:s,y:b,lx:j,ly:$,label:r.subject}}),f=[20,40,60,80,100];return e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("svg",{width:x,height:x,className:"overflow-visible",children:[f.map(r=>{const o=t.map((s,b)=>{const{x:u,y:j}=i(r,b);return`${u},${j}`}).join(" ");return e.jsx("polygon",{points:o,fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"text-slate-100 dark:text-slate-800"},r)}),a.map((r,o)=>e.jsxs("g",{children:[e.jsx("line",{x1:g,y1:g,x2:r.x,y2:r.y,stroke:"currentColor",strokeWidth:"1.5",className:"text-slate-100 dark:text-slate-800"}),e.jsx("text",{x:r.lx,y:r.ly,textAnchor:"middle",dominantBaseline:"middle",className:"text-[10px] fill-[var(--foreground)] opacity-40 font-bold uppercase tracking-wider",children:r.label.substring(0,15)})]},o)),e.jsx("polygon",{points:p,fill:"rgba(6, 214, 211, 0.2)",stroke:"#06D6D3",strokeWidth:"3",strokeLinejoin:"round"}),t.map((r,o)=>{const{x:s,y:b}=i(r.accuracy,o);return e.jsx("circle",{cx:s,cy:b,r:"5",fill:"#06D6D3",stroke:"var(--card)",strokeWidth:"3"},o)})]})})}function Be({data:t}){return e.jsxs("div",{className:"space-y-4 w-full",children:[t.map(x=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-bold text-[var(--foreground)] opacity-60",children:x.subject}),e.jsxs("span",{className:"text-sm font-bold text-[var(--foreground)]",children:[x.accuracy.toFixed(0),"%"]})]}),e.jsx("div",{className:"h-2 w-full bg-slate-100 dark:bg-slate-800 rounded-pill overflow-hidden",children:e.jsx("div",{className:`h-full rounded-pill transition-all duration-500 ${x.accuracy>=70?"bg-emerald-500":x.accuracy>=50?"bg-amber-500":"bg-rose-500"}`,style:{width:`${x.accuracy}%`}})})]},x.subject)),t.length===0&&e.jsx("p",{className:"text-slate-400 text-sm text-center",children:"Nessun dato materia."})]})}function Le({attempts:t,quizId:x,onRepeatTest:g}){V();const[n,c]=d.useState("all"),[i,p]=d.useState("all"),[a,f]=d.useState(!1),r=d.useMemo(()=>t.filter(s=>{if(n!=="all"&&(n==="official"&&s.mode!=="official"||n==="custom"&&s.mode!=="custom"))return!1;if(i!=="all"){const b=s.total_questions>0?s.correct/s.total_questions*100:0;let u="fail";if(b>=60?u="pass":b>=50&&(u="near"),i!==u)return!1}return!0}),[t,n,i]);if(t.length===0)return e.jsxs("div",{className:"text-center py-12 text-[var(--foreground)] opacity-40",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ“"}),"Nessuna attivitÃ  recente."]});const o=n!=="all"||i!=="all";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>f(!a),className:"flex items-center gap-2 text-xs font-bold text-[var(--foreground)] opacity-50 hover:opacity-100 transition-opacity",children:["Filtri",o&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#00B1FF]"}),a?e.jsx(ze,{className:"w-4 h-4"}):e.jsx($e,{className:"w-4 h-4"})]}),a&&e.jsxs("div",{className:"flex flex-wrap gap-4 pb-2 p-4 bg-[var(--card)] rounded-2xl border border-[var(--card-border)] shadow-sm",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase mr-2 self-center",children:"Tipo:"}),[{value:"all",label:"Tutti"},{value:"official",label:"Esame"},{value:"custom",label:"Personalizzata"}].map(s=>e.jsx("button",{onClick:()=>c(s.value),className:`px-3 py-1 text-xs font-bold rounded-full transition-all ${n===s.value?"bg-[#00B1FF] text-white":"bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:s.label},s.value))]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase mr-2 self-center",children:"Risultato:"}),[{value:"all",label:"Tutti"},{value:"pass",label:"Idoneo"},{value:"near",label:"Quasi"},{value:"fail",label:"Non idoneo"}].map(s=>e.jsx("button",{onClick:()=>p(s.value),className:`px-3 py-1 text-xs font-bold rounded-full transition-all ${i===s.value?"bg-slate-900 dark:bg-slate-700 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:s.label},s.value))]})]}),o&&e.jsxs("p",{className:"text-xs text-[var(--foreground)] opacity-40",children:[r.length," risultat",r.length===1?"o":"i"," trovat",r.length===1?"o":"i"]}),e.jsx("div",{className:"space-y-3",children:r.map(s=>e.jsx(Pe,{attempt:s},s.id))}),r.length===0&&e.jsxs("div",{className:"text-center py-12 text-[var(--foreground)] opacity-40",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ”"}),"Nessun tentativo corrisponde ai filtri selezionati."]})]})}const J={score:{label:"Punteggio",unit:"pt",color:"#06D6D3"},accuracy:{label:"Accuratezza",unit:"%",color:"#22C55E"},responseTime:{label:"Tempo medio",unit:"s",color:"#F59E0B"}};function Ge({data:t,defaultMetric:x="score",defaultTimeRange:g="all"}){var B,H;const[n,c]=d.useState(x),[i,p]=d.useState(g),[a,f]=d.useState(null),r=d.useMemo(()=>{if(i==="all")return t;const l=new Date,k=i==="7d"?7:30,F=new Date(l.getTime()-k*24*60*60*1e3);return t.filter(L=>L.fullDate>=F)},[t,i]),o=l=>{switch(n){case"score":return l.score;case"accuracy":return l.accuracy;case"responseTime":return(l.responseTime||0)/1e3;default:return l.score}};if(r.length<2)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center",children:[e.jsx("div",{className:"flex gap-1",children:["score","accuracy"].map(l=>e.jsx("button",{onClick:()=>c(l),className:`px-3 py-1.5 text-xs font-bold rounded-pill transition-all ${n===l?"bg-brand-cyan text-white":"bg-slate-100 dark:bg-slate-800 text-text-secondary dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:J[l].label},l))}),e.jsx("div",{className:"flex gap-1",children:["7d","30d","all"].map(l=>e.jsx("button",{onClick:()=>p(l),className:`px-3 py-1.5 text-xs font-bold rounded-pill transition-all ${i===l?"bg-[var(--foreground)] text-[var(--background)]":"bg-slate-100 dark:bg-slate-800 text-text-secondary dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:l==="all"?"Tutto":l},l))})]}),e.jsx("div",{className:"h-48 flex items-center justify-center text-slate-400 italic text-sm",children:"Non ci sono abbastanza dati per questo periodo."})]});const s=600,b=200,u=30,j=r.map(o),$=Math.max(...j,10),h=Math.min(...j,0),w=$-h||1,N=l=>u+l/(r.length-1)*(s-u*2),R=l=>b-u-(l-h)/w*(b-u*2),Q=r.map((l,k)=>{const F=N(k),L=R(o(l));return`${k===0?"M":"L"} ${F} ${L}`}).join(" "),E=`${Q} L ${s-u} ${b-u} L ${u} ${b-u} Z`,M=J[n];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-between items-center",children:[e.jsx("div",{className:"flex gap-1",children:["score","accuracy"].map(l=>e.jsx("button",{onClick:()=>c(l),className:`px-3 py-1.5 text-xs font-bold rounded-pill transition-all ${n===l?"bg-brand-cyan text-white":"bg-slate-100 dark:bg-slate-800 text-text-secondary dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:J[l].label},l))}),e.jsx("div",{className:"flex gap-1",children:["7d","30d","all"].map(l=>e.jsx("button",{onClick:()=>p(l),className:`px-3 py-1.5 text-xs font-bold rounded-pill transition-all ${i===l?"bg-[var(--foreground)] text-[var(--background)]":"bg-slate-100 dark:bg-slate-800 text-text-secondary dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,children:l==="all"?"Tutto":l},l))})]}),e.jsxs("div",{className:"w-full overflow-hidden relative",children:[e.jsxs("svg",{viewBox:`0 0 ${s} ${b}`,className:"w-full h-auto",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${n}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:M.color,stopOpacity:"0.2"}),e.jsx("stop",{offset:"100%",stopColor:M.color,stopOpacity:"0"})]})}),[0,.5,1].map(l=>{const k=h+w*l,F=R(k);return e.jsxs("g",{children:[e.jsx("line",{x1:u,y1:F,x2:s-u,y2:F,stroke:"currentColor",className:"text-slate-200 dark:text-slate-800",strokeWidth:"1.5",strokeDasharray:"4"}),e.jsx("text",{x:u-8,y:F+4,textAnchor:"end",className:"text-[10px] fill-[var(--foreground)] opacity-40 font-medium",children:k.toFixed(0)})]},l)}),e.jsx("path",{d:E,fill:`url(#gradient-${n})`}),e.jsx("path",{d:Q,fill:"none",stroke:M.color,strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),r.map((l,k)=>e.jsx("g",{children:e.jsx("circle",{cx:N(k),cy:R(o(l)),r:a===k?8:5,fill:"var(--card)",stroke:M.color,strokeWidth:"3",className:"cursor-pointer transition-all",onMouseEnter:()=>f(k),onMouseLeave:()=>f(null)})},k))]}),a!==null&&r[a]&&e.jsxs("div",{className:"absolute bg-[var(--card)] rounded-xl shadow-lg border border-[var(--card-border)] p-3 z-10 pointer-events-none transition-colors",style:{left:`${N(a)/s*100}%`,top:`${R(o(r[a]))/b*100-20}%`,transform:"translateX(-50%)"},children:[e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-40 mb-1",children:r[a].date}),e.jsxs("p",{className:"text-sm font-bold text-[var(--foreground)]",children:[o(r[a]).toFixed(1)," ",M.unit]}),r[a].id&&e.jsx(je,{to:`/quiz/results/${r[a].id}`,className:"text-[10px] font-bold text-brand-cyan hover:underline pointer-events-auto",children:"Vedi dettagli â†’"})]})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-text-tertiary font-medium px-2",children:[e.jsx("span",{children:(B=r[0])==null?void 0:B.date}),e.jsx("span",{children:(H=r[r.length-1])==null?void 0:H.date})]})]})}const Oe={review:{icon:Fe,gradient:"from-amber-500 to-orange-500",bgGlow:"bg-gradient-to-br from-amber-500/10 to-orange-500/10",iconBg:"bg-gradient-to-br from-amber-500 to-orange-500",accentColor:"text-amber-600 dark:text-amber-400",borderHover:"hover:border-amber-300 dark:hover:border-amber-600"},practice:{icon:I,gradient:"from-rose-500 to-pink-500",bgGlow:"bg-gradient-to-br from-rose-500/10 to-pink-500/10",iconBg:"bg-gradient-to-br from-rose-500 to-pink-500",accentColor:"text-rose-600 dark:text-rose-400",borderHover:"hover:border-rose-300 dark:hover:border-rose-600"},simulation:{icon:Te,gradient:"from-[#00B1FF] to-cyan-400",bgGlow:"bg-gradient-to-br from-[#00B1FF]/10 to-cyan-400/10",iconBg:"bg-gradient-to-br from-[#00B1FF] to-cyan-400",accentColor:"text-[#00B1FF]",borderHover:"hover:border-cyan-300 dark:hover:border-cyan-600"},goal:{icon:K,gradient:"from-emerald-500 to-green-500",bgGlow:"bg-gradient-to-br from-emerald-500/10 to-green-500/10",iconBg:"bg-gradient-to-br from-emerald-500 to-green-500",accentColor:"text-emerald-600 dark:text-emerald-400",borderHover:"hover:border-emerald-300 dark:hover:border-emerald-600"}};function Ee({recommendations:t,onSetGoal:x}){const g=V();if(t.length===0)return null;const n=c=>{c.type==="goal"&&x?x():c.actionUrl&&g(c.actionUrl)};return e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative bg-[var(--card)] rounded-[32px] shadow-soft p-6 border border-[var(--card-border)] transition-colors overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-48 h-48 bg-gradient-to-bl from-[#00B1FF]/5 to-emerald-500/5 rounded-bl-[100px] pointer-events-none"}),e.jsxs("div",{className:"flex items-center justify-between mb-6 relative z-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-[var(--foreground)]",children:"Cosa fare adesso"}),e.jsx("p",{className:"text-[13px] text-slate-500 dark:text-slate-400 mt-0.5",children:"Suggerimenti personalizzati per te"})]}),e.jsx(O.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0,repeatDelay:3},className:"w-14 h-14 rounded-[18px] bg-gradient-to-br from-[#00B1FF] to-emerald-500 flex items-center justify-center shadow-lg",children:e.jsx(_e,{className:"w-7 h-7 text-white"})})]}),e.jsx("div",{className:"space-y-3 relative z-10",children:t.map((c,i)=>{const p=Oe[c.type],a=p.icon;return e.jsxs(O.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:i*.1},onClick:()=>n(c),className:`w-full flex items-center gap-4 p-4 rounded-[20px] bg-white dark:bg-slate-800/50 border border-slate-100 dark:border-slate-700/50 ${p.borderHover} hover:shadow-md active:scale-[0.98] transition-all text-left group relative overflow-hidden`,children:[e.jsx("div",{className:`absolute inset-0 ${p.bgGlow} opacity-0 group-hover:opacity-100 transition-opacity`}),e.jsx("div",{className:`relative w-12 h-12 rounded-2xl ${p.iconBg} flex items-center justify-center flex-shrink-0 shadow-md`,children:e.jsx(a,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0 relative z-10",children:[e.jsx("p",{className:"text-[15px] font-bold text-slate-900 dark:text-slate-100 leading-tight",children:c.title}),e.jsx("p",{className:"text-[13px] text-slate-500 dark:text-slate-400 mt-0.5 line-clamp-1",children:c.description})]}),e.jsx("div",{className:"relative z-10 w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center group-hover:bg-slate-200 dark:group-hover:bg-slate-600 transition-colors flex-shrink-0",children:e.jsx(ee,{className:"w-4 h-4 text-slate-500 dark:text-slate-400 group-hover:translate-x-0.5 transition-transform"})})]},c.id)})}),e.jsx("div",{className:"mt-5 pt-4 border-t border-slate-100 dark:border-slate-800 relative z-10",children:e.jsx("p",{className:"text-[12px] text-slate-400 dark:text-slate-500 text-center",children:"ðŸ’¡ Completa queste azioni per migliorare il tuo punteggio"})})]})}const Qe={score:{label:"Punteggio",unit:"punti",icon:I},accuracy:{label:"Accuratezza",unit:"%",icon:X},attempts:{label:"Simulazioni",unit:"",icon:K}};function He({goal:t,onCreateGoal:x,onDeleteGoal:g}){if(!t)return e.jsxs("div",{className:"bg-[var(--card)] rounded-card shadow-soft p-6 border border-[var(--card-border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--foreground)]",children:"Il tuo obiettivo"}),e.jsx("div",{className:"w-10 h-10 rounded-squircle bg-brand-cyan/10 flex items-center justify-center",children:e.jsx(K,{className:"w-5 h-5 text-brand-cyan"})})]}),e.jsxs("div",{className:"text-center py-8 bg-slate-50 dark:bg-slate-900/50 rounded-2xl border border-dashed border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-[var(--card)] shadow-sm flex items-center justify-center mx-auto mb-3",children:e.jsx(I,{className:"w-6 h-6 text-[var(--foreground)] opacity-30"})}),e.jsx("p",{className:"text-sm font-medium text-[var(--foreground)] opacity-50 mb-4",children:"Imposta un obiettivo per rimanere motivato"}),e.jsx("button",{onClick:x,className:"px-6 py-2.5 bg-brand-cyan text-white font-bold text-sm rounded-pill hover:bg-brand-cyan/90 active:scale-95 transition-all shadow-sm",children:"Imposta obiettivo"})]})]});const n=Qe[t.goal_type],c=n.icon,i=Math.min(t.current_value/t.target_value*100,100),p=t.deadline?Math.max(0,Math.ceil((new Date(t.deadline).getTime()-Date.now())/(1e3*60*60*24))):null,a={active:{label:"In corso",color:"text-brand-cyan bg-brand-cyan/10"},achieved:{label:"Raggiunto! ðŸŽ‰",color:"text-emerald-500 bg-emerald-500/10"},failed:{label:"Non raggiunto",color:"text-rose-500 bg-rose-500/10"},expired:{label:"Scaduto",color:"text-[var(--foreground)] opacity-40 bg-slate-100 dark:bg-slate-800"}},f=i>=100?"achieved":p!==null&&p<=3&&i<80?"at-risk":i>=60?"on-track":"behind",r={achieved:"Obiettivo raggiunto!","on-track":"Sei sulla buona strada",behind:"Devi accelerare","at-risk":"Obiettivo a rischio"};return e.jsxs("div",{className:"bg-[var(--card)] rounded-card shadow-soft p-6 border border-[var(--card-border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--foreground)]",children:"Il tuo obiettivo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2.5 py-1 rounded-pill text-[10px] font-bold uppercase tracking-wide ${a[t.status].color}`,children:a[t.status].label}),g&&t.status==="active"&&e.jsx("button",{onClick:()=>g(t.id),className:"p-1.5 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:e.jsx(Z,{className:"w-4 h-4 text-[var(--foreground)] opacity-40"})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-brand-cyan/10 flex items-center justify-center",children:e.jsx(c,{className:"w-6 h-6 text-brand-cyan"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--foreground)] opacity-50",children:n.label}),e.jsxs("p",{className:"text-2xl font-black text-[var(--foreground)]",children:[t.current_value.toFixed(0),e.jsxs("span",{className:"opacity-30",children:["/",t.target_value.toFixed(0)]}),e.jsx("span",{className:"text-sm font-bold opacity-30 ml-1",children:n.unit})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"h-3 bg-slate-100 dark:bg-slate-800 rounded-pill overflow-hidden",children:e.jsx("div",{className:`h-full rounded-pill transition-all duration-500 ${i>=100?"bg-emerald-500":f==="at-risk"?"bg-rose-500":f==="behind"?"bg-amber-500":"bg-brand-cyan"}`,style:{width:`${i}%`}})})}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:`font-bold ${f==="achieved"?"text-emerald-500":f==="at-risk"?"text-rose-500":f==="behind"?"text-amber-500":"text-[var(--foreground)] opacity-50"}`,children:r[f]}),p!==null&&e.jsxs("span",{className:"text-[var(--foreground)] opacity-30 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"}),p===0?"Scade oggi":`${p} giorni rimasti`]})]})]})}function We({subject:t,quizId:x,onClose:g,onPractice:n,onReviewErrors:c}){if(!t)return null;const i=t.trend==="improving"?X:t.trend==="declining"?qe:De,p=t.trend==="improving"?"text-emerald-500":t.trend==="declining"?"text-rose-500":"text-[var(--foreground)] opacity-30",f={good:{label:"Buono",color:"bg-emerald-500",bgColor:"bg-emerald-500/10",textColor:"text-emerald-500"},warning:{label:"Da migliorare",color:"bg-amber-500",bgColor:"bg-amber-500/10",textColor:"text-amber-500"},critical:{label:"Critico",color:"bg-rose-500",bgColor:"bg-rose-500/10",textColor:"text-rose-500"}}[t.status],r=t.totalQuestions-t.correctAnswers,o=()=>{n?n(t.subjectId):window.location.href=`/quiz/${x}/practice?subject=${t.subjectId}`},s=()=>{c?c(t.subjectId):window.location.href=`/quiz/${x}/review?subject=${t.subjectId}`};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:g}),e.jsxs("div",{className:"relative bg-[var(--card)] w-full max-w-lg rounded-t-3xl sm:rounded-3xl shadow-2xl max-h-[85vh] overflow-auto animate-in slide-in-from-bottom-4 duration-300 border-t sm:border border-[var(--card-border)]",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2 sm:hidden",children:e.jsx("div",{className:"w-10 h-1 bg-slate-200 dark:bg-slate-700 rounded-full"})}),e.jsxs("div",{className:"sticky top-0 bg-[var(--card)] px-6 py-4 border-b border-[var(--card-border)] flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${f.color}`}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-[var(--foreground)]",children:t.subjectName}),e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-40",children:"Analisi dettagliata"})]})]}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(Z,{className:"w-5 h-5 text-[var(--foreground)] opacity-40"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-2xl p-4 border border-slate-100 dark:border-slate-800",children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest mb-1",children:"Accuratezza"}),e.jsxs("p",{className:`text-3xl font-black ${f.textColor}`,children:[t.accuracy.toFixed(0),"%"]}),e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-xs font-bold ${p}`,children:[e.jsx(i,{className:"w-3 h-3"}),e.jsx("span",{children:t.trend==="improving"?"In miglioramento":t.trend==="declining"?"In calo":"Stabile"})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-2xl p-4 border border-slate-100 dark:border-slate-800",children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest mb-1",children:"Domande"}),e.jsx("p",{className:"text-3xl font-black text-[var(--foreground)]",children:t.totalQuestions}),e.jsxs("p",{className:"text-xs text-[var(--foreground)] opacity-40 mt-1",children:[t.correctAnswers," corrette Â· ",r," sbagliate"]})]})]}),e.jsxs("div",{className:`${f.bgColor} rounded-2xl p-4 flex items-center gap-3 border border-current opacity-90`,children:[e.jsx("div",{className:`w-10 h-10 rounded-xl ${f.color} flex items-center justify-center shadow-lg shadow-current/10`,children:e.jsx("span",{className:"text-white text-lg",children:t.status==="good"?"âœ“":t.status==="warning"?"!":"âœ—"})}),e.jsxs("div",{children:[e.jsxs("p",{className:`text-sm font-bold ${f.textColor}`,children:["Stato: ",f.label]}),e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-50",children:t.status==="good"?"Ottimo lavoro! Continua cosÃ¬.":t.status==="warning"?"Qualche errore di troppo. Ripassa questa materia.":"Attenzione! Questa materia richiede studio intensivo."})]})]}),t.avgResponseTimeMs&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-2xl p-4 border border-slate-100 dark:border-slate-800",children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest mb-1",children:"Tempo medio per risposta"}),e.jsxs("p",{className:"text-2xl font-black text-[var(--foreground)]",children:[(t.avgResponseTimeMs/1e3).toFixed(1),"s"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest",children:"Azioni consigliate"}),r>0&&e.jsxs("button",{onClick:s,className:"w-full flex items-center gap-4 p-4 rounded-2xl border border-amber-100 dark:border-amber-900/30 bg-amber-50 dark:bg-amber-900/10 hover:bg-amber-100/50 dark:hover:bg-amber-900/20 transition-all text-left group",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-bold text-[var(--foreground)]",children:["Ripassa ",r," errori"]}),e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-40",children:"Rivedi le domande sbagliate"})]}),e.jsx(ee,{className:"w-5 h-5 text-[var(--foreground)] opacity-20 group-hover:opacity-100 group-hover:translate-x-0.5 transition-all"})]}),e.jsxs("button",{onClick:o,className:"w-full flex items-center gap-4 p-4 rounded-2xl border border-brand-cyan/20 bg-brand-cyan/5 dark:bg-brand-cyan/10 hover:bg-brand-cyan/10 dark:hover:bg-brand-cyan/20 transition-all text-left group",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-brand-cyan/20 text-brand-cyan flex items-center justify-center flex-shrink-0",children:e.jsx(I,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-bold text-[var(--foreground)]",children:"Esercitati su questa materia"}),e.jsxs("p",{className:"text-xs text-[var(--foreground)] opacity-40",children:["Quiz focalizzato solo su ",t.subjectName]})]}),e.jsx(ee,{className:"w-5 h-5 text-[var(--foreground)] opacity-20 group-hover:opacity-100 group-hover:translate-x-0.5 transition-all"})]})]})]})]})]})}const se=[{value:"score",label:"Punteggio",description:"Raggiungi un punteggio target",icon:I,unit:"punti",placeholder:"75",min:0,max:100},{value:"accuracy",label:"Accuratezza",description:"Mantieni una percentuale di risposte corrette",icon:X,unit:"%",placeholder:"80",min:0,max:100},{value:"attempts",label:"Simulazioni",description:"Completa un numero di simulazioni",icon:K,unit:"test",placeholder:"10",min:1,max:100}];function Ue({isOpen:t,quizId:x,onClose:g,onSubmit:n}){const[c,i]=d.useState("score"),[p,a]=d.useState(""),[f,r]=d.useState(""),[o,s]=d.useState(!1),[b,u]=d.useState(""),j=se.find(h=>h.value===c),$=async h=>{h.preventDefault(),u("");const w=parseFloat(p);if(isNaN(w)||w<j.min||w>j.max){u(`Inserisci un valore tra ${j.min} e ${j.max}`);return}s(!0);try{await n({goal_type:c,target_value:w,deadline:f||null}),g()}catch{u("Errore nel salvare l'obiettivo. Riprova.")}finally{s(!1)}};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:g}),e.jsxs("div",{className:"relative bg-[var(--card)] w-full max-w-md rounded-3xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200 border border-[var(--card-border)]",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-[var(--card-border)] flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-[var(--foreground)]",children:"Nuovo obiettivo"}),e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-50 mt-0.5",children:"Imposta un traguardo per restare motivato"})]}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(Z,{className:"w-5 h-5 text-[var(--foreground)] opacity-40"})})]}),e.jsxs("form",{onSubmit:$,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest block mb-3",children:"Tipo di obiettivo"}),e.jsx("div",{className:"space-y-2",children:se.map(h=>{const w=h.icon,N=c===h.value;return e.jsxs("button",{type:"button",onClick:()=>{i(h.value),a("")},className:`w-full flex items-center gap-4 p-4 rounded-2xl border transition-all ${N?"border-brand-cyan bg-brand-cyan/5 dark:bg-brand-cyan/10":"border-slate-100 dark:border-slate-800 hover:border-slate-200 dark:hover:border-slate-700 bg-[var(--card)]"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${N?"bg-brand-cyan text-white":"bg-slate-100 dark:bg-slate-800 text-[var(--foreground)] opacity-40"}`,children:e.jsx(w,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:`text-sm font-bold ${N?"text-brand-cyan":"text-[var(--foreground)]"}`,children:h.label}),e.jsx("p",{className:"text-xs text-[var(--foreground)] opacity-50",children:h.description})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${N?"border-brand-cyan":"border-slate-200 dark:border-slate-700"}`,children:N&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-brand-cyan"})})]},h.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest block mb-2",children:"Valore target"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:p,onChange:h=>a(h.target.value),placeholder:j.placeholder,min:j.min,max:j.max,className:"w-full px-4 py-3 pr-16 rounded-xl border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 focus:border-brand-cyan dark:focus:border-brand-cyan focus:ring-2 focus:ring-brand-cyan/20 outline-none text-[var(--foreground)] font-bold text-lg transition-all",required:!0}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-[var(--foreground)] opacity-40 font-bold",children:j.unit})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-[var(--foreground)] opacity-40 uppercase tracking-widest block mb-2",children:"Scadenza (opzionale)"}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-[var(--foreground)] opacity-40"}),e.jsx("input",{type:"date",value:f,onChange:h=>r(h.target.value),min:new Date().toISOString().split("T")[0],className:"w-full pl-12 pr-4 py-3 rounded-xl border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 focus:border-brand-cyan dark:focus:border-brand-cyan focus:ring-2 focus:ring-brand-cyan/20 outline-none text-[var(--foreground)] font-medium transition-all"})]})]}),b&&e.jsx("p",{className:"text-sm text-semantic-error bg-semantic-error/10 px-4 py-2 rounded-xl",children:b}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:g,className:"flex-1 py-3 px-4 rounded-xl border border-slate-200 dark:border-slate-800 font-bold text-[var(--foreground)] opacity-60 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors",children:"Annulla"}),e.jsx("button",{type:"submit",disabled:o||!p,className:"flex-1 py-3 px-4 rounded-xl bg-brand-cyan text-white font-bold hover:bg-brand-cyan/90 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:o?"Salvataggio...":"Salva obiettivo"})]})]})]})]}):null}function rt(){const{quizId:t}=ye(),x=V(),[g,n]=d.useState(!0),[c,i]=d.useState([]),[p,a]=d.useState(!1),[f,r]=d.useState(!1),[o,s]=d.useState(null),[b,u]=d.useState(null),[j,$]=d.useState(null),[h,w]=d.useState({totalTests:0,avgScore:0,avgAccuracy:0,bestScore:0,maxPossibleScore:100}),[N,R]=d.useState([]),[Q,E]=d.useState(null),[M,B]=d.useState(!1),[H,l]=d.useState(null),[k,F]=d.useState([]),[L,ne]=d.useState([]),[ie,ce]=d.useState([]),[de,xe]=d.useState("Statistiche Corso");d.useEffect(()=>{t&&ue()},[t]);const ue=async()=>{n(!0);const{data:{user:m}}=await D.auth.getUser();if(!m){x("/login");return}try{const[C,_,z]=await Promise.all([D.from("quizzes").select("title, total_questions, points_correct, rule_id").eq("id",t).single(),D.from("quiz_attempts").select("*, quiz:quizzes(title), mode").eq("user_id",m.id).eq("quiz_id",t).order("created_at",{ascending:!1}),D.from("test_goals").select("*").eq("user_id",m.id).eq("quiz_id",t).eq("status","active").maybeSingle()]),y=C.data,P=_.data,G=_.error,W=z.data;let T=0;if(y){if(xe(y.title),y.rule_id){const{data:S}=await D.from("simulation_rules").select("total_questions, points_correct").eq("id",y.rule_id).single();S&&S.total_questions&&S.points_correct&&(T=S.total_questions*S.points_correct)}T===0&&y.total_questions&&y.points_correct&&(T=y.total_questions*y.points_correct)}if(!(y!=null&&y.rule_id)&&P&&P.length>0){const S=Math.max(...P.map(A=>A.total_questions||0));if(S>0){const A=(y==null?void 0:y.points_correct)||1;T=S*A}}if(T===0&&(T=100),G)console.error(G);else if(P){const{data:S}=await D.from("concorso_leaderboard").select("score, volume_factor, accuracy_weighted, recency_score, coverage_score, reliability").eq("user_id",m.id).eq("quiz_id",t).maybeSingle();me(P,T,S)}W&&E(W)}catch(C){console.error("Error loading stats:",C)}finally{n(!1)}},me=(m,C,_)=>{i(m);const z=m.length,y=m.reduce((v,q)=>v+(q.score||0),0),P=m.reduce((v,q)=>Math.max(v,q.score||0),0);let G=0;const W=m.reduce((v,q)=>q.total_questions?(G++,v+(q.correct||0)/q.total_questions):v,0),T=z?y/z:0,S=G?W/G*100:0;if(w({totalTests:z,avgScore:T,avgAccuracy:S,bestScore:P,maxPossibleScore:C}),z>=3){const v=we(m,7);s(v.scoreTrend),u(v.accuracyTrend)}if(z>=1){const v=ke(T,S,z,_);$(v)}const A=Se(m);F(A);const ge=A.map(v=>({subject:v.subjectName,accuracy:v.accuracy,total:v.totalQuestions}));ne(ge);const he=Ce(m,A,t||"");R(he);const fe=[...m].reverse().map(v=>{const q=v.total_questions>0?v.correct/v.total_questions*100:0;return{id:v.id,date:new Date(v.created_at).toLocaleDateString(),fullDate:new Date(v.created_at),score:v.score||0,accuracy:q}});ce(fe)},te=()=>{B(!0)},be=async m=>{const{data:{user:C}}=await D.auth.getUser();if(!C)return;const{data:_,error:z}=await D.from("test_goals").insert({user_id:C.id,quiz_id:t,goal_type:m.goal_type,target_value:m.target_value,deadline:m.deadline,status:"active"}).select().single();!z&&_&&(E(_),B(!1))},pe=async m=>{const{error:C}=await D.from("test_goals").delete().eq("id",m);C||E(null)};return g?e.jsx(Ne,{message:"Analisi performance in corso..."}):e.jsxs("div",{className:"min-h-screen bg-[var(--background)] text-text-primary pb-24 relative overflow-hidden transition-colors duration-300",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 px-4 md:px-8 pt-safe",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 py-4",children:[e.jsx("button",{onClick:()=>x("/profile"),className:"p-3 bg-white dark:bg-slate-800/50 rounded-full shadow-soft hover:shadow-card hover:scale-105 transition-all text-slate-400 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white border border-transparent hover:border-slate-100 dark:hover:border-slate-700",children:e.jsx(Me,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h1",{className:"text-xl font-black text-text-primary leading-tight line-clamp-1",children:de}),e.jsx("p",{className:"text-[10px] font-bold text-text-tertiary uppercase tracking-wider mt-0.5",children:"Statistiche Dettagliate"})]}),e.jsx("div",{className:"w-12"})," "]}),e.jsx(Ae,{totalTests:h.totalTests,bestScore:h.bestScore,avgScore:h.avgScore,accuracy:h.avgAccuracy,maxPossibleScore:h.maxPossibleScore,scoreTrend:o,accuracyTrend:b,readiness:j,onOpenInfo:()=>a(!0)}),N.length>0&&e.jsx(Ee,{recommendations:N,onSetGoal:te}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-5 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[var(--card)] p-6 rounded-card shadow-soft flex flex-col items-center",children:[e.jsx("h3",{className:"text-lg font-bold text-text-primary mb-6 w-full",children:"Performance per Materia"}),e.jsx(Re,{data:L}),e.jsxs("div",{className:"mt-8 w-full",children:[e.jsx("h4",{className:"text-[10px] font-bold text-text-tertiary uppercase tracking-widest mb-3",children:"Dettaglio Materie"}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto pr-2 scrollbar-thin",children:L.map((m,C)=>{const _=m.accuracy>=70?"good":m.accuracy>=50?"warning":"critical",z=_==="good"?"bg-semantic-success":_==="warning"?"bg-brand-orange":"bg-semantic-error",y=k[C];return e.jsxs("button",{onClick:()=>y&&l(y),className:"w-full flex justify-between items-center text-sm border-b border-canvas-light dark:border-slate-800 pb-2 group cursor-pointer hover:bg-canvas-light/50 dark:hover:bg-slate-800/50 -mx-2 px-2 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${z}`}),e.jsx("span",{className:"font-bold text-text-secondary dark:text-slate-400 truncate max-w-[120px]",title:m.subject,children:m.subject})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-text-tertiary",children:["(",m.total,")"]}),e.jsxs("span",{className:`font-black ${m.accuracy>70?"text-semantic-success":m.accuracy>50?"text-brand-orange":"text-semantic-error"}`,children:[m.accuracy.toFixed(0),"%"]})]})]},m.subject)})})]})]}),e.jsx(He,{goal:Q,onCreateGoal:te,onDeleteGoal:pe})]}),e.jsxs("div",{className:"lg:col-span-7 space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-[var(--card)] p-6 rounded-card shadow-soft",children:[e.jsx("h3",{className:"text-lg font-bold text-text-primary mb-4",children:"Andamento nel Tempo"}),e.jsx(Ge,{data:ie})]}),e.jsxs("div",{className:"bg-white dark:bg-[var(--card)] p-6 rounded-card shadow-soft",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-text-primary",children:"Cronologia Tentativi"}),e.jsx("span",{className:"text-[10px] font-bold bg-canvas-light dark:bg-slate-800 text-text-tertiary px-3 py-1.5 rounded-pill uppercase tracking-wider",children:"Ultimi 50"})]}),e.jsx(Le,{attempts:c,quizId:t})]})]})]})]}),e.jsx(We,{subject:H,quizId:t||"",onClose:()=>l(null)}),e.jsx(Ue,{isOpen:M,quizId:t||"",onClose:()=>B(!1),onSubmit:be})]})}export{rt as default};
