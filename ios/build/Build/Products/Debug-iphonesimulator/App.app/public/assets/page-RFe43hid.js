import{j as r}from"./framer-BdaCTGm4.js";import{u as _,r as s}from"./router-ClfHAwMg.js";import{s as b}from"./index-BBBGEo7o.js";import{A as F}from"./AdminLayout-kYIYYLNk.js";import{A as z}from"./AdminPageHeader-CVyPYYOb.js";import{A as C,E as S}from"./EmptyState-DbBsm3yu.js";import{S as E}from"./StatusBadge-CYGANFXg.js";import"./react-vendor-B--z-fyW.js";import"./supabase-CIvuJI4W.js";import"./icons-ByDj-hsa.js";function G(){const v=_(),[d,n]=s.useState([]),[g,u]=s.useState(!0),[m,x]=s.useState(null),[i,j]=s.useState(""),[c,y]=s.useState(!1),p=async()=>{u(!0),x(null);try{const{data:e,error:t}=await b.from("questions").select(`
          *,
          subjects(*),
          quizzes(*)
        `).order("created_at",{ascending:!1}).limit(300);if(t)throw t;n(e)}catch(e){const t=e instanceof Error?e.message:"Errore imprevisto.";console.error("Errore caricando domande:",e),t.includes("Failed to fetch")||x(t),n([])}finally{u(!1)}};s.useEffect(()=>{p()},[]);const w=async e=>{const t=!e.is_archived;try{const{error:a}=await b.from("questions").update({is_archived:t}).eq("id",e.id);if(a)throw a;n(l=>l.map(o=>o.id===e.id?{...o,is_archived:t}:o))}catch(a){console.error(a),alert("Errore nel cambiare lo stato della domanda.")}},k=s.useMemo(()=>{const e=i.trim().toLowerCase();return d.filter(t=>{var f,h;if(!c&&t.is_archived)return!1;if(!e)return!0;const a=(t.text||"").toLowerCase(),l=(((f=t.subjects)==null?void 0:f.name)||"").toLowerCase(),o=(((h=t.quizzes)==null?void 0:h.title)||"").toLowerCase();return a.includes(e)||l.includes(e)||o.includes(e)})},[d,i,c]),N=[{key:"id",label:"ID",width:"80px",render:e=>r.jsx("span",{className:"font-mono text-[10px] text-[var(--foreground)] opacity-40",children:e.id.slice(0,6)})},{key:"text",label:"Testo",render:e=>{const t=e.text&&e.text.length>120?`${e.text.slice(0,120)}...`:e.text||"(senza testo)",a=!e.correct_option;return r.jsxs("div",{className:"relative pr-4",children:[r.jsx("span",{className:"text-[var(--foreground)] opacity-80 font-medium block",children:t}),a&&r.jsx("span",{className:"absolute top-0 right-0 inline-flex items-center justify-center w-4 h-4 text-[9px] font-bold text-white bg-rose-600 rounded-full",title:"Risposta corretta mancante",children:"!"})]})}},{key:"subject",label:"Materia",width:"150px",render:e=>{var t;return r.jsx("span",{className:"text-[var(--foreground)] opacity-40 text-xs",children:((t=e.subjects)==null?void 0:t.name)||(e.subject_id?"...":"-")})}},{key:"quiz",label:"Concorso",width:"180px",render:e=>{var t,a;return r.jsx("span",{className:"text-[var(--foreground)] opacity-40 text-xs truncate max-w-[150px] block",title:(t=e.quizzes)==null?void 0:t.title,children:((a=e.quizzes)==null?void 0:a.title)||(e.quiz_id?"...":"-")})}},{key:"status",label:"Stato",width:"100px",render:e=>r.jsx(E,{label:e.is_archived?"Archiviata":"Attiva",variant:e.is_archived?"warning":"success"})}],A=e=>[{label:"Modifica",icon:"‚úèÔ∏è",onClick:()=>v(`/admin/questions/${e.id}`)},{label:e.is_archived?"Ripristina":"Archivia",icon:e.is_archived?"üì§":"üìÅ",onClick:()=>w(e)}];return r.jsxs(F,{children:[r.jsx(z,{title:"Domande",subtitle:"Gestione completa della banca dati domande",action:{label:"Nuova Domanda (WIP)",icon:"+",onClick:()=>alert("Funzionalit√† in arrivo!"),variant:"secondary"},breadcrumb:[{label:"Admin",path:"/admin"},{label:"Domande"}]}),r.jsxs("div",{className:"mb-8 p-4 bg-[var(--card)] border border-[var(--card-border)] rounded-[20px] shadow-[0_4px_16px_rgba(0,0,0,0.04)] flex flex-col md:flex-row gap-4 items-center justify-between transition-colors",children:[r.jsxs("div",{className:"flex-1 w-full md:max-w-md relative",children:[r.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-[var(--foreground)] opacity-40",children:"üîç"}),r.jsx("input",{className:"w-full pl-11 pr-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-xl text-sm text-[var(--foreground)] placeholder:text-[var(--foreground)] placeholder:opacity-40 focus:outline-none focus:bg-[var(--card)] focus:ring-2 focus:ring-[#00B1FF]/20 focus:border-[#00B1FF] transition-all",placeholder:"Cerca per testo, materia, concorso...",value:i,onChange:e=>j(e.target.value)})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm text-[var(--foreground)] opacity-50 font-medium cursor-pointer select-none hover:opacity-100 transition-all",children:[r.jsx("input",{type:"checkbox",className:"rounded-md bg-white dark:bg-slate-900 border-slate-300 dark:border-slate-700 text-[#00B1FF] focus:ring-[#00B1FF]",checked:c,onChange:e=>y(e.target.checked)}),"Mostra archiviate"]}),r.jsx("button",{onClick:p,className:"p-2.5 text-[var(--foreground)] opacity-40 hover:text-[#00B1FF] hover:opacity-100 hover:bg-[#00B1FF]/5 rounded-xl transition-all",title:"Ricarica",children:"üîÑ"})]})]}),m&&r.jsx("div",{className:"mb-4 p-4 bg-rose-50 dark:bg-rose-900/20 border border-rose-200 dark:border-rose-900/30 rounded-xl text-rose-600 dark:text-rose-400",children:m}),r.jsx(C,{columns:N,data:k,loading:g,rowKey:e=>e.id,rowActions:A,emptyState:r.jsx(S,{icon:"‚ùì",title:"Nessuna domanda trovata",description:i?"Prova a modificare i filtri di ricerca.":"Il database delle domande √® vuoto."})})]})}export{G as default};
